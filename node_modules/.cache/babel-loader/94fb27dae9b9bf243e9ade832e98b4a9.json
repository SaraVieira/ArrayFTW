{"ast":null,"code":"import _createForOfIteratorHelper from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _construct from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/construct\";\nimport _objectWithoutProperties from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _toArray from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray\";\nimport _slicedToArray from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Projects/arrayftw/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a) && typeof a !== 'function';\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n}; // Type guard to tell a store from a portal\n\nvar isStore = function isStore(def) {\n  return def && !!def.getState;\n};\n\nvar getContainer = function getContainer(container, child) {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nvar DEFAULT = '__default';\nvar EMPTY = {};\nvar FILTER = ['children', 'key', 'ref'];\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _objectSpread(_objectSpread({}, catalogue), objects));\n}; // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  var instance = object;\n\n  if (!instance.__r3f) {\n    instance.__r3f = _objectSpread({\n      root: null,\n      memoizedProps: {},\n      objects: []\n    }, state);\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  function applyProps(instance, newProps) {\n    var oldProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var accumulative = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    var _instance$__r3f, _root$getState, _instance$__r3f2; // Filter equals, events and reserved props\n\n\n    var localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    var root = localState.root;\n    var rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n    var sameProps = [];\n    var handlers = [];\n    var newMemoizedProps = {};\n    var i = 0;\n    Object.entries(newProps).forEach(function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 2),\n          key = _ref3[0],\n          entry = _ref3[1];\n\n      // we don't want children, ref or key in the memoized props\n      if (FILTER.indexOf(key) === -1) {\n        newMemoizedProps[key] = entry;\n      }\n    });\n\n    if (localState.memoizedProps && localState.memoizedProps.args) {\n      newMemoizedProps.args = localState.memoizedProps.args;\n    }\n\n    if (localState.memoizedProps && localState.memoizedProps.attach) {\n      newMemoizedProps.attach = localState.memoizedProps.attach;\n    }\n\n    if (instance.__r3f) {\n      instance.__r3f.memoizedProps = newMemoizedProps;\n    }\n\n    var objectKeys = Object.keys(newProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (is.equ(newProps[objectKeys[i]], oldProps[objectKeys[i]])) {\n        sameProps.push(objectKeys[i]);\n      } // Event-handlers ...\n      //   are functions, that\n      //   start with \"on\", and\n      //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n      if (is.fun(newProps[objectKeys[i]]) && /^on(Pointer|Click|ContextMenu|Wheel)/.test(objectKeys[i])) {\n        handlers.push(objectKeys[i]);\n      }\n    } // Catch props that existed, but now exist no more ...\n\n\n    var leftOvers = [];\n\n    if (accumulative) {\n      objectKeys = Object.keys(oldProps);\n\n      for (i = 0; i < objectKeys.length; i++) {\n        if (!newProps.hasOwnProperty(objectKeys[i])) {\n          leftOvers.push(objectKeys[i]);\n        }\n      }\n    }\n\n    var toFilter = [].concat(sameProps, FILTER); // Instances use \"object\" as a reserved identifier\n\n    if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.instance) toFilter.push('object');\n\n    var filteredProps = _objectSpread({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n    objectKeys = Object.keys(filteredProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (toFilter.indexOf(objectKeys[i]) > -1) {\n        delete filteredProps[objectKeys[i]];\n      }\n    } // Collect all new props\n\n\n    var filteredPropsEntries = Object.entries(filteredProps); // Prepend left-overs so they can be reset or removed\n    // Left-overs must come first!\n\n    for (i = 0; i < leftOvers.length; i++) {\n      if (leftOvers[i] !== 'children') {\n        filteredPropsEntries.unshift([leftOvers[i], DEFAULT + 'remove']);\n      }\n    }\n\n    if (filteredPropsEntries.length > 0) {\n      filteredPropsEntries.forEach(function (_ref4) {\n        var _ref5 = _slicedToArray(_ref4, 2),\n            key = _ref5[0],\n            value = _ref5[1];\n\n        if (!handlers.includes(key)) {\n          var currentInstance = instance;\n          var targetProp = currentInstance[key];\n\n          if (key.includes('-')) {\n            var entries = key.split('-');\n            targetProp = entries.reduce(function (acc, key) {\n              return acc[key];\n            }, instance); // If the target is atomic, it forces us to switch the root\n\n            if (!(targetProp && targetProp.set)) {\n              var _entries$reverse = entries.reverse(),\n                  _entries$reverse2 = _toArray(_entries$reverse),\n                  name = _entries$reverse2[0],\n                  reverseEntries = _entries$reverse2.slice(1);\n\n              currentInstance = reverseEntries.reverse().reduce(function (acc, key) {\n                return acc[key];\n              }, instance);\n              key = name;\n            }\n          } // https://github.com/mrdoob/three.js/issues/21209\n          // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n          // has no means to do this. Hence we curate a small collection of value-classes\n          // with their respective constructor/set arguments\n          // For removed props, try to set default values, if possible\n\n\n          if (value === DEFAULT + 'remove') {\n            if (targetProp && targetProp.constructor) {\n              // use the prop constructor to find the default it should be\n              value = new targetProp.constructor(newMemoizedProps.args);\n            } else if (currentInstance.constructor) {\n              // create a blank slate of the instance and copy the particular parameter.\n              // @ts-ignore\n              var defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n              value = defaultClassCall[targetProp]; // destory the instance\n\n              if (defaultClassCall.dispose) {\n                defaultClassCall.dispose();\n              }\n            } else {\n              // instance does not have constructor, just set it to 0\n              value = 0;\n            }\n          } // Special treatment for objects with support for set/copy\n\n\n          if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n            // If value is an array\n            if (Array.isArray(value)) {\n              if (targetProp.fromArray) {\n                targetProp.fromArray(value);\n              } else {\n                var _targetProp;\n\n                (_targetProp = targetProp).set.apply(_targetProp, _toConsumableArray(value));\n              }\n            } // Test again target.copy(class) next ...\n            else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) {\n                targetProp.copy(value);\n              } // If nothing else fits, just set the single value, ignore undefined\n              // https://github.com/react-spring/react-three-fiber/issues/274\n              else if (value !== undefined) {\n                  var isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n                  if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Otherwise just set ...\n                  else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n                  // https://github.com/react-spring/react-three-fiber/issues/344\n\n                  if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n                } // Else, just overwrite the value\n\n          } else {\n            currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n          }\n\n          invalidateInstance(instance);\n        }\n      }); // Preemptively delete the instance from the containers interaction\n\n      if (accumulative && root && instance.raycast && localState.handlers) {\n        localState.handlers = undefined;\n        var index = rootState.internal.interaction.indexOf(instance);\n        if (index > -1) rootState.internal.interaction.splice(index, 1);\n      } // Prep interaction handlers\n\n\n      if (handlers.length) {\n        if (accumulative && root && instance.raycast) {\n          rootState.internal.interaction.push(instance);\n        } // Add handlers to the instances handler-map\n\n\n        localState.handlers = handlers.reduce(function (acc, key) {\n          return _objectSpread(_objectSpread({}, acc), {}, {\n            [key]: newProps[key]\n          });\n        }, {});\n      } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n      if (instance.parent) updateInstance(instance);\n    }\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f3, _instance$__r3f3$root;\n\n    var state = (_instance$__r3f3 = instance.__r3f) == null ? void 0 : (_instance$__r3f3$root = _instance$__r3f3.root) == null ? void 0 : _instance$__r3f3$root.getState == null ? void 0 : _instance$__r3f3$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, _ref6, root, hostContext, internalInstanceHandle) {\n    var _ref6$args = _ref6.args,\n        args = _ref6$args === void 0 ? [] : _ref6$args,\n        props = _objectWithoutProperties(_ref6, [\"args\"]);\n\n    var name = \"\".concat(type[0].toUpperCase()).concat(type.slice(1));\n    var instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      var fn = function fn(node) {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw \"No valid root for \".concat(name, \"!\");\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw \"Primitives without 'object' are invalid!\";\n      var object = props.object;\n      instance = prepare(object, {\n        root: root,\n        instance: true\n      });\n    } else {\n      var target = catalogue[name] || THREE[name];\n      if (!target) throw \"\".concat(name, \" is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\");\n      var isArgsArr = is.arr(args); // Instanciate new object, link it to the root\n\n      instance = prepare(isArgsArr ? _construct(target, _toConsumableArray(args)) : new target(args), {\n        root: root,\n        // append memoized props with args so it's not forgotten\n        memoizedProps: {\n          args: isArgsArr && args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (name.endsWith('Geometry')) {\n      props = _objectSpread({\n        attach: 'geometry'\n      }, props);\n    } else if (name.endsWith('Material')) {\n      props = _objectSpread({\n        attach: 'material'\n      }, props);\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props, {});\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    if (child) {\n      if (child.isObject3D) {\n        parentInstance.add(child);\n      } else {\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n        if (child.attachArray) {\n          if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n          parentInstance[child.attachArray].push(child);\n        } else if (child.attachObject) {\n          if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n          parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n        } else if (child.attach) {\n          parentInstance[child.attach] = child;\n        }\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    if (child) {\n      if (child.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        var restSiblings = parentInstance.children.filter(function (sibling) {\n          return sibling !== child;\n        }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n        var index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [].concat(_toConsumableArray(restSiblings.slice(0, index)), [child], _toConsumableArray(restSiblings.slice(index)));\n        updateInstance(child);\n      } else {\n        appendChild(parentInstance, child);\n      } // TODO: order!!!\n\n\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent) {\n    var clone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n    if (array) {\n      // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n      var target = clone ? _toConsumableArray(array) : array;\n      target.forEach(function (child) {\n        return removeChild(parent, child);\n      });\n    }\n  }\n\n  function removeChild(parentInstance, child) {\n    if (child) {\n      if (child.isObject3D) {\n        parentInstance.remove(child);\n      } else {\n        child.parent = null;\n        if (parentInstance.__r3f.objects) parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(function (x) {\n          return x !== child;\n        }); // Remove attachment\n\n        if (child.attachArray) {\n          parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n            return x !== child;\n          });\n        } else if (child.attachObject) {\n          delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n        } else if (child.attach) {\n          parentInstance[child.attach] = null;\n        }\n      } // Remove interactivity\n\n\n      if (child.__r3f.root) {\n        var rootState = child.__r3f.root.getState();\n\n        rootState.internal.interaction = rootState.internal.interaction.filter(function (x) {\n          return x !== child;\n        });\n      }\n\n      invalidateInstance(parentInstance); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n\n      if (child.dispose && !child.__r3f.instance) {\n        var objects = child.__r3f.objects;\n        unstable_runWithPriority(unstable_IdlePriority, function () {\n          // Remove nested child objects\n          removeRecursive(objects, child);\n          removeRecursive(child.children, child, true); // Dispose item\n\n          if (child.dispose && child.type !== 'Scene') child.dispose();\n        });\n      } // Remove references\n\n\n      delete child.__r3f.root;\n      delete child.__r3f.objects;\n      delete child.__r3f.handlers;\n      delete child.__r3f.memoizedProps;\n      delete child.__r3f;\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    var parent = instance.parent;\n    if (!parent) return;\n    var newInstance = createInstance(type, newProps, instance.__r3f.root);\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(function (fiber) {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  var reconciler = Reconciler({\n    now: unstable_now,\n    createInstance: createInstance,\n    removeChild: removeChild,\n    appendChild: appendChild,\n    appendInitialChild: appendChild,\n    insertBefore: insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: function appendChildToContainer(parentInstance, child) {\n      var _getContainer = getContainer(parentInstance, child),\n          container = _getContainer.container,\n          root = _getContainer.root; // Link current root to the default scene\n\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: function removeChildFromContainer(parentInstance, child) {\n      var _getContainer2 = getContainer(parentInstance, child),\n          container = _getContainer2.container;\n\n      removeChild(container, child);\n    },\n    insertInContainerBefore: function insertInContainerBefore(parentInstance, child, beforeChild) {\n      var _getContainer3 = getContainer(parentInstance, child),\n          container = _getContainer3.container;\n\n      insertBefore(container, child, beforeChild);\n    },\n    commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n      if (instance.__r3f.instance && newProps.object && newProps.object !== instance) {\n        // <instance object={...} /> where the object reference has changed\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // This is a data object, let's extract critical information about it\n        var _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutProperties(newProps, [\"args\"]);\n\n        var _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutProperties(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n        var hasNewArgs = argsNew.some(function (value, index) {\n          return is.obj(value) ? Object.entries(value).some(function (_ref7) {\n            var _ref8 = _slicedToArray(_ref7, 2),\n                key = _ref8[0],\n                val = _ref8[1];\n\n            return val !== argsOld[index][key];\n          }) : value !== argsOld[index];\n        });\n\n        if (hasNewArgs) {\n          // Next we create a new instance and append it again\n          switchInstance(instance, type, newProps, fiber);\n        } else {\n          // Otherwise just overwrite props\n          applyProps(instance, restNew, restOld, true);\n        }\n      }\n    },\n    hideInstance: function hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n    unhideInstance: function unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n    hideTextInstance: function hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n    getPublicInstance: function getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n    getRootHostContext: function getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n    getChildHostContext: function getChildHostContext(parentHostContext) {\n      return EMPTY;\n    },\n    createTextInstance: function createTextInstance() {},\n    finalizeInitialChildren: function finalizeInitialChildren(instance) {\n      // https://github.com/facebook/react/issues/20271\n      // Returning true will trigger commitMount\n      return !!instance.__r3f.handlers;\n    },\n    commitMount: function commitMount(instance)\n    /*, type, props*/\n    {\n      // https://github.com/facebook/react/issues/20271\n      // This will make sure events are only added once to the central container\n      if (instance.raycast && instance.__r3f.handlers) instance.__r3f.root.getState().internal.interaction.push(instance);\n    },\n    prepareUpdate: function prepareUpdate() {\n      return EMPTY;\n    },\n    shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n      return false;\n    },\n    prepareForCommit: function prepareForCommit() {\n      return null;\n    },\n    preparePortalMount: function preparePortalMount() {// noop\n    },\n    resetAfterCommit: function resetAfterCommit() {// noop\n    },\n    shouldSetTextContent: function shouldSetTextContent() {\n      return false;\n    },\n    clearContainer: function clearContainer() {\n      return false;\n    }\n  });\n  return {\n    reconciler: reconciler,\n    applyProps: applyProps\n  };\n}\n\nvar isRenderer = function isRenderer(def) {\n  return def && !!def.render;\n};\n\nvar isOrthographicCamera = function isOrthographicCamera(def) {\n  return def && def.isOrthographicCamera;\n};\n\nvar context = /*#__PURE__*/React.createContext(null);\n\nvar createStore = function createStore(applyProps, _invalidate, _advance, props) {\n  var gl = props.gl,\n      size = props.size,\n      _props$shadows = props.shadows,\n      shadows = _props$shadows === void 0 ? false : _props$shadows,\n      _props$linear = props.linear,\n      linear = _props$linear === void 0 ? false : _props$linear,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$orthographic = props.orthographic,\n      orthographic = _props$orthographic === void 0 ? false : _props$orthographic,\n      _props$frameloop = props.frameloop,\n      frameloop = _props$frameloop === void 0 ? 'always' : _props$frameloop,\n      _props$dpr = props.dpr,\n      dpr = _props$dpr === void 0 ? 1 : _props$dpr,\n      performance = props.performance,\n      _props$clock = props.clock,\n      clock = _props$clock === void 0 ? new THREE.Clock() : _props$clock,\n      raycastOptions = props.raycaster,\n      cameraOptions = props.camera,\n      onPointerMissed = props.onPointerMissed; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) {\n    gl.toneMapping = THREE.ACESFilmicToneMapping;\n    gl.outputEncoding = THREE.sRGBEncoding;\n  }\n\n  var rootState = create(function (set, get) {\n    // Create custom raycaster\n    var raycaster = new THREE.Raycaster();\n    applyProps(raycaster, _objectSpread({\n      enabled: true\n    }, raycastOptions), {}); // Create default camera\n\n    var isCamera = cameraOptions instanceof THREE.Camera;\n    var camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (orthographic) camera.zoom = 100;\n      if (cameraOptions) applyProps(camera, cameraOptions, {}); // Always look at center by default\n\n      camera.lookAt(0, 0, 0);\n    }\n\n    function _setDpr(dpr) {\n      return Array.isArray(dpr) ? Math.max(Math.min(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n    }\n\n    var initialDpr = _setDpr(dpr);\n\n    var position = new THREE.Vector3();\n    var defaultTarget = new THREE.Vector3();\n\n    function getCurrentViewport() {\n      var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : get().camera;\n      var target = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultTarget;\n      var size = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : get().size;\n      var width = size.width,\n          height = size.height;\n      var aspect = width / height;\n      var distance = camera.getWorldPosition(position).distanceTo(target);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance: distance,\n          aspect: aspect\n        };\n      } else {\n        var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        var w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance: distance,\n          aspect: aspect\n        };\n      }\n    }\n\n    var performanceTimeout = undefined;\n\n    var setPerformanceCurrent = function setPerformanceCurrent(current) {\n      return set(function (state) {\n        return {\n          performance: _objectSpread(_objectSpread({}, state.performance), {}, {\n            current: current\n          })\n        };\n      });\n    };\n\n    return {\n      gl: gl,\n      set: set,\n      get: get,\n      invalidate: function invalidate() {\n        return _invalidate(get());\n      },\n      advance: function advance(timestamp, runGlobalEffects) {\n        return _advance(timestamp, runGlobalEffects, get());\n      },\n      linear: linear,\n      scene: prepare(new THREE.Scene()),\n      camera: camera,\n      raycaster: raycaster,\n      clock: clock,\n      mouse: new THREE.Vector2(),\n      vr: vr,\n      frameloop: frameloop,\n      onPointerMissed: onPointerMissed,\n      performance: _objectSpread(_objectSpread({\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200\n      }, performance), {}, {\n        regress: function regress() {\n          var state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(function () {\n            return setPerformanceCurrent(get().performance.max);\n          }, state.performance.debounce);\n        }\n      }),\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr: initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport: getCurrentViewport\n      },\n      setSize: function setSize(width, height) {\n        var size = {\n          width: width,\n          height: height\n        };\n        set(function (state) {\n          return {\n            size: size,\n            viewport: _objectSpread(_objectSpread({}, state.viewport), getCurrentViewport(camera, defaultTarget, size))\n          };\n        });\n      },\n      setDpr: function setDpr(dpr) {\n        return set(function (state) {\n          return {\n            viewport: _objectSpread(_objectSpread({}, state.viewport), {}, {\n              dpr: _setDpr(dpr)\n            })\n          };\n        });\n      },\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        subscribers: [],\n        captured: undefined,\n        initialClick: [0, 0],\n        initialHits: [],\n        subscribe: function subscribe(ref) {\n          var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n          var internal = get().internal; // If this subscription was given a priority, it takes rendering into its own hands\n          // For that reason we switch off automatic rendering and increase the manual flag\n          // As long as this flag is positive (there could be multiple render subscription)\n          // ..there can be no internal rendering at all\n\n          if (priority) internal.priority++; // Register subscriber\n\n          internal.subscribers.push({\n            ref: ref,\n            priority: priority\n          }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n          internal.subscribers = internal.subscribers.sort(function (a, b) {\n            return a.priority - b.priority;\n          });\n          return function () {\n            if (internal != null && internal.subscribers) {\n              // Decrease manual flag if this subscription had a priority\n              if (priority) internal.priority--;\n              internal.subscribers = internal.subscribers.filter(function (s) {\n                return s.ref !== ref;\n              });\n            }\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(function () {\n    var _rootState$getState = rootState.getState(),\n        camera = _rootState$getState.camera,\n        size = _rootState$getState.size,\n        viewport = _rootState$getState.viewport,\n        internal = _rootState$getState.internal; // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, function (state) {\n    return [state.viewport.dpr, state.size];\n  }, shallow);\n  var state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(function (state) {\n    return _invalidate(state);\n  }); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar i;\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) {\n    effects[i](timestamp);\n  }\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  var delta = state.clock.getDelta(); // Call subscribers (useFrame)\n\n  for (i = 0; i < state.internal.subscribers.length; i++) {\n    state.internal.subscribers[i].ref.current(state, delta);\n  } // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  var running = false;\n  var repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(function (root) {\n      var state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(function (root) {\n      return invalidate(root.store.getState());\n    });\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp) {\n    var runGlobalEffects = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    var state = arguments.length > 2 ? arguments[2] : undefined;\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(function (root) {\n      return render$1(timestamp, root.store.getState());\n    });else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop: loop,\n    invalidate: invalidate,\n    advance: advance\n  };\n}\n\nfunction createEvents(store) {\n  var hovered = new Map();\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        mouse = state.mouse,\n        camera = state.camera,\n        size = state.size; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    var _ref9 = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event,\n        offsetX = _ref9.offsetX,\n        offsetY = _ref9.offsetY;\n\n    var width = size.width,\n        height = size.height;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    var _store$getState = store.getState(),\n        internal = _store$getState.internal;\n\n    var dx = event.offsetX - internal.initialClick[0];\n    var dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(function (obj) {\n      return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n        var _r3f$handlers;\n\n        return (_r3f$handlers = obj.__r3f.handlers) == null ? void 0 : _r3f$handlers['onPointer' + name];\n      });\n    });\n  }\n\n  function makeId(event) {\n    return (event.eventObject || event.object).uuid + '/' + event.index;\n  }\n\n  function intersect(filter) {\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        internal = state.internal; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    var seen = new Set();\n    var intersections = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = raycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    var _iterator = _createForOfIteratorHelper(intersects),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _intersect = _step.value;\n        var eventObject = _intersect.object; // Bubble event up\n\n        while (eventObject) {\n          var _r3f;\n\n          var handlers = (_r3f = eventObject.__r3f) == null ? void 0 : _r3f.handlers;\n          if (handlers) intersections.push(_objectSpread(_objectSpread({}, _intersect), {}, {\n            eventObject: eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    var _store$getState2 = store.getState(),\n        internal = _store$getState2.internal; // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n\n    if (internal.captured && event.type !== 'click' && event.type !== 'wheel') {\n      internal.captured.forEach(function (captured) {\n        if (!intersections.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, callback) {\n    var _store$getState3 = store.getState(),\n        raycaster = _store$getState3.raycaster,\n        mouse = _store$getState3.mouse,\n        camera = _store$getState3.camera,\n        internal = _store$getState3.internal; // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false,\n          captured: false\n        };\n\n        var _iterator2 = _createForOfIteratorHelper(intersections),\n            _step2;\n\n        try {\n          var _loop = function _loop() {\n            var hit = _step2.value;\n\n            var setPointerCapture = function setPointerCapture(id) {\n              // If the hit is going to be captured flag that we're in captured state\n              if (!localState.captured) {\n                localState.captured = true; // The captured hit array is reset to collect hits\n\n                internal.captured = [];\n              } // Push hits to the array\n\n\n              if (internal.captured) internal.captured.push(hit) // Call the original event now\n              ;\n              event.target.setPointerCapture(id);\n            }; // Add native event props\n\n\n            var extractEventProps = {};\n\n            for (var prop in Object.getPrototypeOf(event)) {\n              extractEventProps[prop] = event[prop];\n            }\n\n            var raycastEvent = _objectSpread(_objectSpread(_objectSpread({}, hit), extractEventProps), {}, {\n              intersections: intersections,\n              stopped: localState.stopped,\n              delta: delta,\n              unprojectedPoint: unprojectedPoint,\n              ray: raycaster.ray,\n              camera: camera,\n              // Hijack stopPropagation, which just sets a flag\n              stopPropagation: function stopPropagation() {\n                // https://github.com/pmndrs/react-three-fiber/issues/596\n                // Events are not allowed to stop propagation if the pointer has been captured\n                var cap = internal.captured;\n\n                if (!cap || cap.find(function (h) {\n                  return h.eventObject.id === hit.eventObject.id;\n                })) {\n                  raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                  // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                  if (hovered.size && Array.from(hovered.values()).find(function (i) {\n                    return i.eventObject === hit.eventObject;\n                  })) {\n                    // Objects cannot flush out higher up objects that have already caught the event\n                    var higher = intersections.slice(0, intersections.indexOf(hit));\n                    cancelPointer([].concat(_toConsumableArray(higher), [hit]));\n                  }\n                }\n              },\n              target: _objectSpread(_objectSpread({}, event.target), {}, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              currentTarget: _objectSpread(_objectSpread({}, event.currentTarget), {}, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              sourceEvent: event\n            }); // Call subscribers\n\n\n            callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n            if (localState.stopped === true) return \"break\";\n          };\n\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _ret = _loop();\n\n            if (_ret === \"break\") break;\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      })();\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    Array.from(hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index;\n      })) {\n        var eventObject = hoveredObj.eventObject;\n        var handlers = eventObject.__r3f.handlers;\n        hovered.delete(makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          var data = _objectSpread(_objectSpread({}, hoveredObj), {}, {\n            intersections: hits || []\n          });\n\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  var handlePointer = function handlePointer(name) {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return function () {\n          return cancelPointer([]);\n        };\n\n      case 'onLostPointerCapture':\n        return function () {\n          return store.getState().internal.captured = undefined, cancelPointer([]);\n        };\n    } // Any other pointer goes here ...\n\n\n    return function (event) {\n      var _store$getState4 = store.getState(),\n          onPointerMissed = _store$getState4.onPointerMissed,\n          internal = _store$getState4.internal;\n\n      prepareRay(event); // Get fresh intersects\n\n      var isPointerMove = name === 'onPointerMove';\n      var filter = isPointerMove ? filterPointerEvents : undefined;\n      var hits = patchIntersects(intersect(filter), event); // Take care of unhover\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__r3f.handlers; // Check presence of handlers\n\n        if (!handlers) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            var id = makeId(data);\n            var hoveredItem = hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          var handler = handlers == null ? void 0 : handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              handler(data);\n              pointerMissed(event, internal.interaction.filter(function (object) {\n                return object !== eventObject;\n              }));\n            }\n          }\n        }\n      }); // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      } // If a click yields no results, pass it back to the user as a miss\n\n\n      if ((name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed();\n        }\n      }\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(function (object) {\n      var _r3f$handlers2;\n\n      return (_r3f$handlers2 = object.__r3f.handlers) == null ? void 0 : _r3f$handlers2.onPointerMissed == null ? void 0 : _r3f$handlers2.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer: handlePointer\n  };\n}\n\nfunction createPointerEvents(store) {\n  var _createEvents = createEvents(store),\n      handlePointer = _createEvents.handlePointer;\n\n  var names = {\n    onClick: 'click',\n    onContextMenu: 'contextmenu',\n    onDoubleClick: 'dblclick',\n    onWheel: 'wheel',\n    onPointerDown: 'pointerdown',\n    onPointerUp: 'pointerup',\n    onPointerLeave: 'pointerleave',\n    onPointerMove: 'pointermove',\n    onPointerCancel: 'pointercancel',\n    onLostPointerCapture: 'lostpointercapture'\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce(function (acc, key) {\n      return _objectSpread(_objectSpread({}, acc), {}, {\n        [key]: handlePointer(key)\n      });\n    }, {}),\n    connect: function connect(target) {\n      var _events$handlers;\n\n      var _store$getState5 = store.getState(),\n          set = _store$getState5.set,\n          events = _store$getState5.events;\n\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(function (state) {\n        return {\n          events: _objectSpread(_objectSpread({}, state.events), {}, {\n            connected: target\n          })\n        };\n      });\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(function (_ref10) {\n        var _ref11 = _slicedToArray(_ref10, 2),\n            name = _ref11[0],\n            event = _ref11[1];\n\n        return target.addEventListener(names[name], event, {\n          passive: true\n        });\n      });\n    },\n    disconnect: function disconnect() {\n      var _store$getState6 = store.getState(),\n          set = _store$getState6.set,\n          events = _store$getState6.events;\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(function (_ref12) {\n          var _ref13 = _slicedToArray(_ref12, 2),\n              name = _ref13[0],\n              event = _ref13[1];\n\n          if (events && events.connected instanceof HTMLElement) {\n            events.connected.removeEventListener(names[name], event);\n          }\n        });\n        set(function (state) {\n          return {\n            events: _objectSpread(_objectSpread({}, state.events), {}, {\n              connected: false\n            })\n          };\n        });\n      }\n    }\n  };\n} // React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\n\n\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction Canvas(_ref14) {\n  var children = _ref14.children,\n      resize = _ref14.resize,\n      style = _ref14.style,\n      className = _ref14.className,\n      events = _ref14.events,\n      props = _objectWithoutProperties(_ref14, [\"children\", \"resize\", \"style\", \"className\", \"events\"]);\n\n  var _useMeasure = useMeasure(_objectSpread({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      _useMeasure2 = _slicedToArray(_useMeasure, 2),\n      ref = _useMeasure2[0],\n      size = _useMeasure2[1];\n\n  var canvas = React.useRef(null);\n  useIsomorphicLayoutEffect(function () {\n    if (size.width > 0 && size.height > 0) {\n      render(children, canvas.current, _objectSpread(_objectSpread({}, props), {}, {\n        size: size,\n        events: events || createPointerEvents\n      }));\n    }\n  }, [size, children]);\n  React.useEffect(function () {\n    var container = canvas.current;\n    return function () {\n      return unmountComponentAtNode(container);\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: ref,\n    className: className,\n    style: _objectSpread({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvas,\n    style: {\n      display: 'block'\n    }\n  }));\n}\n\nfunction useThree() {\n  var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function (state) {\n    return state;\n  };\n  var equalityFn = arguments.length > 1 ? arguments[1] : undefined;\n  var useStore = React.useContext(context);\n  if (!useStore) throw \"R3F hooks can only be used within the Canvas component!\";\n  return useStore(selector, equalityFn);\n}\n\nfunction useFrame(callback) {\n  var renderPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var subscribe = React.useContext(context).getState().internal.subscribe; // Update ref\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len = arguments.length, input = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      input[_key - 1] = arguments[_key];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          var _error$message;\n\n          return reject((_error$message = error.message) != null ? _error$message : \"failure loading \".concat(input));\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(_toConsumableArray(keys))); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload.apply(useAsset, [loadingFn(extensions), Proto].concat(_toConsumableArray(keys)));\n};\n\nvar roots = new Map();\nvar modes = ['legacy', 'blocking', 'concurrent'];\n\nvar _createLoop = createLoop(roots),\n    invalidate = _createLoop.invalidate,\n    advance = _createLoop.advance;\n\nvar _createRenderer = createRenderer(),\n    reconciler = _createRenderer.reconciler,\n    applyProps = _createRenderer.applyProps;\n\nvar createRendererInstance = function createRendererInstance(gl, canvas) {\n  return isRenderer(gl) ? gl : new THREE.WebGLRenderer(_objectSpread({\n    powerPreference: 'high-performance',\n    canvas: canvas,\n    antialias: true,\n    alpha: true\n  }, gl));\n};\n\nfunction render(element, canvas) {\n  var _ref15 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      gl = _ref15.gl,\n      size = _ref15.size,\n      _ref15$mode = _ref15.mode,\n      mode = _ref15$mode === void 0 ? modes[1] : _ref15$mode,\n      events = _ref15.events,\n      onCreated = _ref15.onCreated,\n      props = _objectWithoutProperties(_ref15, [\"gl\", \"size\", \"mode\", \"events\", \"onCreated\"]);\n\n  var _store; // Allow size to take on container bounds initially\n\n\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n  var store = root == null ? void 0 : root.store;\n  var state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    var lastProps = state.internal.lastProps; // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n\n    if (props.dpr !== undefined && !is.equ(lastProps.dpr, props.dpr)) state.setDpr(props.dpr); // Check size\n\n    if (size !== undefined && !is.equ(lastProps.size, size)) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    var linearChanged = props.linear !== lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    var glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(function (timestamp) {\n        return advance(timestamp, true);\n      });\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, _objectSpread({\n      gl: glRenderer,\n      size: size\n    }, props));\n\n    var _state = store.getState();\n\n    _state.get; // Create renderer\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber: fiber,\n      store: store\n    }); // Store events internally\n\n    if (events) _state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, function () {\n      return undefined;\n    });\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider(_ref16) {\n  var store = _ref16.store,\n      element = _ref16.element,\n      onCreated = _ref16.onCreated,\n      target = _ref16.target;\n  React.useEffect(function () {\n    var state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(function (state) {\n      return {\n        internal: _objectSpread(_objectSpread({}, state.internal), {}, {\n          active: true\n        })\n      };\n    }); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    var state = root == null ? void 0 : root.store.getState();\n    if (state) state.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, function () {\n      if (state) {\n        setTimeout(function () {\n          var _state$gl, _state$gl$renderLists, _state$gl2;\n\n          state.events.disconnect == null ? void 0 : state.events.disconnect();\n          (_state$gl = state.gl) == null ? void 0 : (_state$gl$renderLists = _state$gl.renderLists) == null ? void 0 : _state$gl$renderLists.dispose == null ? void 0 : _state$gl$renderLists.dispose();\n          (_state$gl2 = state.gl) == null ? void 0 : _state$gl2.forceContextLoss == null ? void 0 : _state$gl2.forceContextLoss();\n          dispose(state);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    var _dispose, _ref;\n\n    (_dispose = (_ref = p).dispose) == null ? void 0 : _dispose.call(_ref);\n    delete obj[p];\n  }\n}\n\nvar act = reconciler.act;\nvar hasSymbol = is.fun(Symbol) && Symbol.for;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, container, implementation) {\n  var key = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: prepare(container),\n    implementation: implementation\n  };\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  // @ts-ignore\n  version: \"0.0.0\"\n});\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useThree };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/@react-three/fiber/dist/react-three-fiber.esm.js"],"names":["THREE","React","create","shallow","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","useAsset","useMeasure","threeTypes","Object","freeze","__proto__","is","obj","a","arr","fun","str","num","und","Array","isArray","equ","b","i","isStore","def","getState","getContainer","container","child","_container$__r3f$root","_container$__r3f","root","__r3f","scene","DEFAULT","EMPTY","FILTER","catalogue","extend","objects","prepare","object","state","instance","memoizedProps","createRenderer","roots","applyProps","newProps","oldProps","accumulative","_instance$__r3f","_root$getState","_instance$__r3f2","localState","rootState","sameProps","handlers","newMemoizedProps","entries","forEach","key","entry","indexOf","args","attach","objectKeys","keys","length","push","test","leftOvers","hasOwnProperty","toFilter","filteredProps","filteredPropsEntries","unshift","value","includes","currentInstance","targetProp","split","reduce","acc","set","reverse","name","reverseEntries","constructor","defaultClassCall","dispose","copy","Layers","fromArray","undefined","isColor","Color","setScalar","linear","convertSRGBToLinear","Texture","encoding","sRGBEncoding","invalidateInstance","raycast","index","internal","interaction","splice","parent","updateInstance","_instance$__r3f3","_instance$__r3f3$root","frames","invalidate","onUpdate","createInstance","type","hostContext","internalInstanceHandle","props","toUpperCase","slice","fn","node","return","stateNode","containerInfo","target","isArgsArr","endsWith","appendChild","parentInstance","isObject3D","add","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","filter","sibling","removeRecursive","array","clone","removeChild","remove","x","switchInstance","fiber","newInstance","alternate","ref","current","reconciler","now","appendInitialChild","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","rootContainer","getChildHostContext","parentHostContext","createTextInstance","finalizeInitialChildren","commitMount","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","isRenderer","render","isOrthographicCamera","context","createContext","createStore","advance","gl","size","shadows","vr","orthographic","frameloop","dpr","performance","clock","Clock","raycastOptions","raycaster","cameraOptions","camera","onPointerMissed","shadowMap","enabled","assign","PCFSoftShadowMap","toneMapping","ACESFilmicToneMapping","outputEncoding","get","Raycaster","isCamera","Camera","OrthographicCamera","PerspectiveCamera","position","z","zoom","lookAt","setDpr","Math","max","min","window","devicePixelRatio","initialDpr","Vector3","defaultTarget","getCurrentViewport","width","height","aspect","distance","getWorldPosition","distanceTo","factor","fov","PI","h","tan","w","performanceTimeout","setPerformanceCurrent","timestamp","runGlobalEffects","Scene","mouse","Vector2","debounce","regress","viewport","setSize","events","connected","active","priority","lastProps","subscribers","captured","initialClick","initialHits","subscribe","sort","s","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setPixelRatio","createSubs","callback","subs","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","run","effects","render$1","delta","getDelta","createLoop","running","repeat","loop","store","requestAnimationFrame","createEvents","hovered","Map","temp","prepareRay","event","_raycaster$computeOff","computeOffsets","offsetX","offsetY","setFromCamera","calculateDistance","dx","dy","round","sqrt","filterPointerEvents","_r3f$handlers","makeId","eventObject","uuid","intersect","seen","Set","intersections","eventsObjects","intersects","intersectObjects","item","id","has","_r3f","patchIntersects","find","hit","handleIntersects","unprojectedPoint","y","unproject","releasePointerCapture","stopped","setPointerCapture","extractEventProps","prop","getPrototypeOf","raycastEvent","ray","stopPropagation","cap","from","values","higher","cancelPointer","currentTarget","sourceEvent","hits","hoveredObj","delete","data","onPointerOut","onPointerLeave","handlePointer","isPointerMove","onPointerOver","onPointerEnter","hoveredItem","onPointerMove","handler","pointerMissed","map","_r3f$handlers2","createPointerEvents","names","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerCancel","onLostPointerCapture","connect","_events$handlers","disconnect","addEventListener","passive","_events$handlers2","HTMLElement","removeEventListener","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","Canvas","resize","style","className","scroll","canvas","useRef","unmountComponentAtNode","createElement","overflow","display","useThree","selector","equalityFn","useStore","useContext","useFrame","renderPriority","unsubscribe","buildGraph","nodes","materials","traverse","material","useGraph","useMemo","loadingFn","extensions","onProgress","Proto","loader","input","Promise","all","res","reject","load","error","_error$message","message","useLoader","results","preload","modes","createRendererInstance","WebGLRenderer","powerPreference","antialias","alpha","element","mode","onCreated","_store","_canvas$parentElement","_canvas$parentElement2","_canvas$parentElement3","_canvas$parentElement4","parentElement","clientWidth","clientHeight","linearChanged","glRenderer","xr","setAnimationLoop","createContainer","updateContainer","Provider","_state$gl","_state$gl$renderLists","_state$gl2","renderLists","forceContextLoss","p","_dispose","_ref","call","act","hasSymbol","Symbol","for","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","version","ReactThreeFiber","_roots"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\n\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a) && typeof a !== 'function',\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\n// Type guard to tell a store from a portal\nconst isStore = def => def && !!def.getState;\n\nconst getContainer = (container, child) => {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nconst DEFAULT = '__default';\nconst EMPTY = {};\nconst FILTER = ['children', 'key', 'ref'];\nlet catalogue = {};\n\nlet extend = objects => void (catalogue = { ...catalogue,\n  ...objects\n}); // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  const instance = object;\n\n  if (!instance.__r3f) {\n    instance.__r3f = {\n      root: null,\n      memoizedProps: {},\n      objects: [],\n      ...state\n    };\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  function applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n    var _instance$__r3f, _root$getState, _instance$__r3f2;\n\n    // Filter equals, events and reserved props\n    const localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    const root = localState.root;\n    const rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n    const sameProps = [];\n    const handlers = [];\n    const newMemoizedProps = {};\n    let i = 0;\n    Object.entries(newProps).forEach(([key, entry]) => {\n      // we don't want children, ref or key in the memoized props\n      if (FILTER.indexOf(key) === -1) {\n        newMemoizedProps[key] = entry;\n      }\n    });\n\n    if (localState.memoizedProps && localState.memoizedProps.args) {\n      newMemoizedProps.args = localState.memoizedProps.args;\n    }\n\n    if (localState.memoizedProps && localState.memoizedProps.attach) {\n      newMemoizedProps.attach = localState.memoizedProps.attach;\n    }\n\n    if (instance.__r3f) {\n      instance.__r3f.memoizedProps = newMemoizedProps;\n    }\n\n    let objectKeys = Object.keys(newProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (is.equ(newProps[objectKeys[i]], oldProps[objectKeys[i]])) {\n        sameProps.push(objectKeys[i]);\n      } // Event-handlers ...\n      //   are functions, that\n      //   start with \"on\", and\n      //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n      if (is.fun(newProps[objectKeys[i]]) && /^on(Pointer|Click|ContextMenu|Wheel)/.test(objectKeys[i])) {\n        handlers.push(objectKeys[i]);\n      }\n    } // Catch props that existed, but now exist no more ...\n\n\n    const leftOvers = [];\n\n    if (accumulative) {\n      objectKeys = Object.keys(oldProps);\n\n      for (i = 0; i < objectKeys.length; i++) {\n        if (!newProps.hasOwnProperty(objectKeys[i])) {\n          leftOvers.push(objectKeys[i]);\n        }\n      }\n    }\n\n    const toFilter = [...sameProps, ...FILTER]; // Instances use \"object\" as a reserved identifier\n\n    if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.instance) toFilter.push('object');\n    const filteredProps = { ...newProps\n    }; // Removes sameProps and reserved props from newProps\n\n    objectKeys = Object.keys(filteredProps);\n\n    for (i = 0; i < objectKeys.length; i++) {\n      if (toFilter.indexOf(objectKeys[i]) > -1) {\n        delete filteredProps[objectKeys[i]];\n      }\n    } // Collect all new props\n\n\n    const filteredPropsEntries = Object.entries(filteredProps); // Prepend left-overs so they can be reset or removed\n    // Left-overs must come first!\n\n    for (i = 0; i < leftOvers.length; i++) {\n      if (leftOvers[i] !== 'children') {\n        filteredPropsEntries.unshift([leftOvers[i], DEFAULT + 'remove']);\n      }\n    }\n\n    if (filteredPropsEntries.length > 0) {\n      filteredPropsEntries.forEach(([key, value]) => {\n        if (!handlers.includes(key)) {\n          let currentInstance = instance;\n          let targetProp = currentInstance[key];\n\n          if (key.includes('-')) {\n            const entries = key.split('-');\n            targetProp = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n            if (!(targetProp && targetProp.set)) {\n              const [name, ...reverseEntries] = entries.reverse();\n              currentInstance = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n              key = name;\n            }\n          } // https://github.com/mrdoob/three.js/issues/21209\n          // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n          // has no means to do this. Hence we curate a small collection of value-classes\n          // with their respective constructor/set arguments\n          // For removed props, try to set default values, if possible\n\n\n          if (value === DEFAULT + 'remove') {\n            if (targetProp && targetProp.constructor) {\n              // use the prop constructor to find the default it should be\n              value = new targetProp.constructor(newMemoizedProps.args);\n            } else if (currentInstance.constructor) {\n              // create a blank slate of the instance and copy the particular parameter.\n              // @ts-ignore\n              const defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n              value = defaultClassCall[targetProp]; // destory the instance\n\n              if (defaultClassCall.dispose) {\n                defaultClassCall.dispose();\n              }\n            } else {\n              // instance does not have constructor, just set it to 0\n              value = 0;\n            }\n          } // Special treatment for objects with support for set/copy\n\n\n          if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n            // If value is an array\n            if (Array.isArray(value)) {\n              if (targetProp.fromArray) {\n                targetProp.fromArray(value);\n              } else {\n                targetProp.set(...value);\n              }\n            } // Test again target.copy(class) next ...\n            else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) {\n                targetProp.copy(value);\n              } // If nothing else fits, just set the single value, ignore undefined\n              // https://github.com/react-spring/react-three-fiber/issues/274\n              else if (value !== undefined) {\n                  const isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n                  if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Otherwise just set ...\n                  else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n                  // https://github.com/react-spring/react-three-fiber/issues/344\n\n                  if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n                } // Else, just overwrite the value\n\n          } else {\n            currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n          }\n\n          invalidateInstance(instance);\n        }\n      }); // Preemptively delete the instance from the containers interaction\n\n      if (accumulative && root && instance.raycast && localState.handlers) {\n        localState.handlers = undefined;\n        const index = rootState.internal.interaction.indexOf(instance);\n        if (index > -1) rootState.internal.interaction.splice(index, 1);\n      } // Prep interaction handlers\n\n\n      if (handlers.length) {\n        if (accumulative && root && instance.raycast) {\n          rootState.internal.interaction.push(instance);\n        } // Add handlers to the instances handler-map\n\n\n        localState.handlers = handlers.reduce((acc, key) => ({ ...acc,\n          [key]: newProps[key]\n        }), {});\n      } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n      if (instance.parent) updateInstance(instance);\n    }\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f3, _instance$__r3f3$root;\n\n    const state = (_instance$__r3f3 = instance.__r3f) == null ? void 0 : (_instance$__r3f3$root = _instance$__r3f3.root) == null ? void 0 : _instance$__r3f3$root.getState == null ? void 0 : _instance$__r3f3$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, {\n    args = [],\n    ...props\n  }, root, hostContext, internalInstanceHandle) {\n    let name = `${type[0].toUpperCase()}${type.slice(1)}`;\n    let instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      const fn = node => {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw `No valid root for ${name}!`;\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw `Primitives without 'object' are invalid!`;\n      const object = props.object;\n      instance = prepare(object, {\n        root,\n        instance: true\n      });\n    } else {\n      const target = catalogue[name] || THREE[name];\n      if (!target) throw `${name} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;\n      const isArgsArr = is.arr(args); // Instanciate new object, link it to the root\n\n      instance = prepare(isArgsArr ? new target(...args) : new target(args), {\n        root,\n        // append memoized props with args so it's not forgotten\n        memoizedProps: {\n          args: isArgsArr && args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (name.endsWith('Geometry')) {\n      props = {\n        attach: 'geometry',\n        ...props\n      };\n    } else if (name.endsWith('Material')) {\n      props = {\n        attach: 'material',\n        ...props\n      };\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props, {});\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    if (child) {\n      if (child.isObject3D) {\n        parentInstance.add(child);\n      } else {\n        parentInstance.__r3f.objects.push(child);\n\n        child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n        if (child.attachArray) {\n          if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n          parentInstance[child.attachArray].push(child);\n        } else if (child.attachObject) {\n          if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n          parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n        } else if (child.attach) {\n          parentInstance[child.attach] = child;\n        }\n      }\n\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    if (child) {\n      if (child.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n        const index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n        updateInstance(child);\n      } else {\n        appendChild(parentInstance, child);\n      } // TODO: order!!!\n\n\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent, clone = false) {\n    if (array) {\n      // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n      const target = clone ? [...array] : array;\n      target.forEach(child => removeChild(parent, child));\n    }\n  }\n\n  function removeChild(parentInstance, child) {\n    if (child) {\n      if (child.isObject3D) {\n        parentInstance.remove(child);\n      } else {\n        child.parent = null;\n        if (parentInstance.__r3f.objects) parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(x => x !== child); // Remove attachment\n\n        if (child.attachArray) {\n          parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);\n        } else if (child.attachObject) {\n          delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n        } else if (child.attach) {\n          parentInstance[child.attach] = null;\n        }\n      } // Remove interactivity\n\n\n      if (child.__r3f.root) {\n        const rootState = child.__r3f.root.getState();\n\n        rootState.internal.interaction = rootState.internal.interaction.filter(x => x !== child);\n      }\n\n      invalidateInstance(parentInstance); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n\n      if (child.dispose && !child.__r3f.instance) {\n        const objects = child.__r3f.objects;\n        unstable_runWithPriority(unstable_IdlePriority, () => {\n          // Remove nested child objects\n          removeRecursive(objects, child);\n          removeRecursive(child.children, child, true); // Dispose item\n\n          if (child.dispose && child.type !== 'Scene') child.dispose();\n        });\n      } // Remove references\n\n\n      delete child.__r3f.root;\n      delete child.__r3f.objects;\n      delete child.__r3f.handlers;\n      delete child.__r3f.memoizedProps;\n      delete child.__r3f;\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    const parent = instance.parent;\n    if (!parent) return;\n    const newInstance = createInstance(type, newProps, instance.__r3f.root);\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(fiber => {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  const reconciler = Reconciler({\n    now: unstable_now,\n    createInstance,\n    removeChild,\n    appendChild,\n    appendInitialChild: appendChild,\n    insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: (parentInstance, child) => {\n      const {\n        container,\n        root\n      } = getContainer(parentInstance, child); // Link current root to the default scene\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: (parentInstance, child) => {\n      const {\n        container\n      } = getContainer(parentInstance, child);\n      removeChild(container, child);\n    },\n    insertInContainerBefore: (parentInstance, child, beforeChild) => {\n      const {\n        container\n      } = getContainer(parentInstance, child);\n      insertBefore(container, child, beforeChild);\n    },\n\n    commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n      if (instance.__r3f.instance && newProps.object && newProps.object !== instance) {\n        // <instance object={...} /> where the object reference has changed\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // This is a data object, let's extract critical information about it\n        const {\n          args: argsNew = [],\n          ...restNew\n        } = newProps;\n        const {\n          args: argsOld = [],\n          ...restOld\n        } = oldProps; // If it has new props or arguments, then it needs to be re-instanciated\n\n        const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n        if (hasNewArgs) {\n          // Next we create a new instance and append it again\n          switchInstance(instance, type, newProps, fiber);\n        } else {\n          // Otherwise just overwrite props\n          applyProps(instance, restNew, restOld, true);\n        }\n      }\n    },\n\n    hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n\n    unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n\n    hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n\n    getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n\n    getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n\n    getChildHostContext(parentHostContext) {\n      return EMPTY;\n    },\n\n    createTextInstance() {},\n\n    finalizeInitialChildren(instance) {\n      // https://github.com/facebook/react/issues/20271\n      // Returning true will trigger commitMount\n      return !!instance.__r3f.handlers;\n    },\n\n    commitMount(instance)\n    /*, type, props*/\n    {\n      // https://github.com/facebook/react/issues/20271\n      // This will make sure events are only added once to the central container\n      if (instance.raycast && instance.__r3f.handlers) instance.__r3f.root.getState().internal.interaction.push(instance);\n    },\n\n    prepareUpdate() {\n      return EMPTY;\n    },\n\n    shouldDeprioritizeSubtree() {\n      return false;\n    },\n\n    prepareForCommit() {\n      return null;\n    },\n\n    preparePortalMount(...args) {// noop\n    },\n\n    resetAfterCommit() {// noop\n    },\n\n    shouldSetTextContent() {\n      return false;\n    },\n\n    clearContainer() {\n      return false;\n    }\n\n  });\n  return {\n    reconciler,\n    applyProps\n  };\n}\n\nconst isRenderer = def => def && !!def.render;\nconst isOrthographicCamera = def => def && def.isOrthographicCamera;\nconst context = /*#__PURE__*/React.createContext(null);\n\nconst createStore = (applyProps, invalidate, advance, props) => {\n  const {\n    gl,\n    size,\n    shadows = false,\n    linear = false,\n    vr = false,\n    orthographic = false,\n    frameloop = 'always',\n    dpr = 1,\n    performance,\n    clock = new THREE.Clock(),\n    raycaster: raycastOptions,\n    camera: cameraOptions,\n    onPointerMissed\n  } = props; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) {\n    gl.toneMapping = THREE.ACESFilmicToneMapping;\n    gl.outputEncoding = THREE.sRGBEncoding;\n  }\n\n  const rootState = create((set, get) => {\n    // Create custom raycaster\n    const raycaster = new THREE.Raycaster();\n    applyProps(raycaster, {\n      enabled: true,\n      ...raycastOptions\n    }, {}); // Create default camera\n\n    const isCamera = cameraOptions instanceof THREE.Camera;\n    const camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (orthographic) camera.zoom = 100;\n      if (cameraOptions) applyProps(camera, cameraOptions, {}); // Always look at center by default\n\n      camera.lookAt(0, 0, 0);\n    }\n\n    function setDpr(dpr) {\n      return Array.isArray(dpr) ? Math.max(Math.min(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n    }\n\n    const initialDpr = setDpr(dpr);\n    const position = new THREE.Vector3();\n    const defaultTarget = new THREE.Vector3();\n\n    function getCurrentViewport(camera = get().camera, target = defaultTarget, size = get().size) {\n      const {\n        width,\n        height\n      } = size;\n      const aspect = width / height;\n      const distance = camera.getWorldPosition(position).distanceTo(target);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance,\n          aspect\n        };\n      } else {\n        const fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        const h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        const w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance,\n          aspect\n        };\n      }\n    }\n\n    let performanceTimeout = undefined;\n\n    const setPerformanceCurrent = current => set(state => ({\n      performance: { ...state.performance,\n        current\n      }\n    }));\n\n    return {\n      gl,\n      set,\n      get,\n      invalidate: () => invalidate(get()),\n      advance: (timestamp, runGlobalEffects) => advance(timestamp, runGlobalEffects, get()),\n      linear,\n      scene: prepare(new THREE.Scene()),\n      camera,\n      raycaster,\n      clock,\n      mouse: new THREE.Vector2(),\n      vr,\n      frameloop,\n      onPointerMissed,\n      performance: {\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200,\n        ...performance,\n        regress: () => {\n          const state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(() => setPerformanceCurrent(get().performance.max), state.performance.debounce);\n        }\n      },\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport\n      },\n      setSize: (width, height) => {\n        const size = {\n          width,\n          height\n        };\n        set(state => ({\n          size,\n          viewport: { ...state.viewport,\n            ...getCurrentViewport(camera, defaultTarget, size)\n          }\n        }));\n      },\n      setDpr: dpr => set(state => ({\n        viewport: { ...state.viewport,\n          dpr: setDpr(dpr)\n        }\n      })),\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        subscribers: [],\n        captured: undefined,\n        initialClick: [0, 0],\n        initialHits: [],\n        subscribe: (ref, priority = 0) => {\n          const internal = get().internal; // If this subscription was given a priority, it takes rendering into its own hands\n          // For that reason we switch off automatic rendering and increase the manual flag\n          // As long as this flag is positive (there could be multiple render subscription)\n          // ..there can be no internal rendering at all\n\n          if (priority) internal.priority++; // Register subscriber\n\n          internal.subscribers.push({\n            ref,\n            priority\n          }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n          internal.subscribers = internal.subscribers.sort((a, b) => a.priority - b.priority);\n          return () => {\n            if (internal != null && internal.subscribers) {\n              // Decrease manual flag if this subscription had a priority\n              if (priority) internal.priority--;\n              internal.subscribers = internal.subscribers.filter(s => s.ref !== ref);\n            }\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(() => {\n    const {\n      camera,\n      size,\n      viewport,\n      internal\n    } = rootState.getState(); // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, state => [state.viewport.dpr, state.size], shallow);\n  const state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(state => invalidate(state)); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet i;\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) effects[i](timestamp);\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  const delta = state.clock.getDelta(); // Call subscribers (useFrame)\n\n  for (i = 0; i < state.internal.subscribers.length; i++) state.internal.subscribers[i].ref.current(state, delta); // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  let running = false;\n  let repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(root => {\n      const state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(root => invalidate(root.store.getState()));\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp, runGlobalEffects = true, state) {\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(root => render$1(timestamp, root.store.getState()));else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop,\n    invalidate,\n    advance\n  };\n}\n\nfunction createEvents(store) {\n  const hovered = new Map();\n  const temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    const state = store.getState();\n    const {\n      raycaster,\n      mouse,\n      camera,\n      size\n    } = state; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    const {\n      offsetX,\n      offsetY\n    } = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event;\n    const {\n      width,\n      height\n    } = size;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    const {\n      internal\n    } = store.getState();\n    const dx = event.offsetX - internal.initialClick[0];\n    const dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => {\n      var _r3f$handlers;\n\n      return (_r3f$handlers = obj.__r3f.handlers) == null ? void 0 : _r3f$handlers['onPointer' + name];\n    }));\n  }\n\n  function makeId(event) {\n    return (event.eventObject || event.object).uuid + '/' + event.index;\n  }\n\n  function intersect(filter) {\n    const state = store.getState();\n    const {\n      raycaster,\n      internal\n    } = state; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    const seen = new Set();\n    const intersections = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = raycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    for (const intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var _r3f;\n\n        const handlers = (_r3f = eventObject.__r3f) == null ? void 0 : _r3f.handlers;\n        if (handlers) intersections.push({ ...intersect,\n          eventObject\n        });\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    const {\n      internal\n    } = store.getState(); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (internal.captured && event.type !== 'click' && event.type !== 'wheel') {\n      internal.captured.forEach(captured => {\n        if (!intersections.find(hit => hit.eventObject === captured.eventObject)) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, callback) {\n    const {\n      raycaster,\n      mouse,\n      camera,\n      internal\n    } = store.getState(); // If anything has been found, forward it to the event listeners\n\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (const hit of intersections) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            internal.captured = [];\n          } // Push hits to the array\n\n\n          if (internal.captured) internal.captured.push(hit) // Call the original event now\n          ;\n          event.target.setPointerCapture(id);\n        }; // Add native event props\n\n\n        let extractEventProps = {};\n\n        for (let prop in Object.getPrototypeOf(event)) {\n          extractEventProps[prop] = event[prop];\n        }\n\n        let raycastEvent = { ...hit,\n          ...extractEventProps,\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: raycaster.ray,\n          camera: camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/pmndrs/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const cap = internal.captured;\n\n            if (!cap || cap.find(h => h.eventObject.id === hit.eventObject.id)) {\n              raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n\n              if (hovered.size && Array.from(hovered.values()).find(i => i.eventObject === hit.eventObject)) {\n                // Objects cannot flush out higher up objects that have already caught the event\n                const higher = intersections.slice(0, intersections.indexOf(hit));\n                cancelPointer([...higher, hit]);\n              }\n            }\n          },\n          target: { ...event.target,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          currentTarget: { ...event.currentTarget,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          sourceEvent: event\n        }; // Call subscribers\n\n        callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n        if (localState.stopped === true) break;\n      }\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    Array.from(hovered.values()).forEach(hoveredObj => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(hit => hit.object === hoveredObj.object && hit.index === hoveredObj.index)) {\n        const eventObject = hoveredObj.eventObject;\n        const handlers = eventObject.__r3f.handlers;\n        hovered.delete(makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          const data = { ...hoveredObj,\n            intersections: hits || []\n          };\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  const handlePointer = name => {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return () => cancelPointer([]);\n\n      case 'onLostPointerCapture':\n        return () => (store.getState().internal.captured = undefined, cancelPointer([]));\n    } // Any other pointer goes here ...\n\n\n    return event => {\n      const {\n        onPointerMissed,\n        internal\n      } = store.getState();\n      prepareRay(event); // Get fresh intersects\n\n      const isPointerMove = name === 'onPointerMove';\n      const filter = isPointerMove ? filterPointerEvents : undefined;\n      const hits = patchIntersects(intersect(filter), event); // Take care of unhover\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, data => {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__r3f.handlers; // Check presence of handlers\n\n        if (!handlers) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            const id = makeId(data);\n            const hoveredItem = hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          const handler = handlers == null ? void 0 : handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              handler(data);\n              pointerMissed(event, internal.interaction.filter(object => object !== eventObject));\n            }\n          }\n        }\n      }); // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(hit => hit.eventObject);\n      } // If a click yields no results, pass it back to the user as a miss\n\n\n      if ((name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed();\n        }\n      }\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(object => {\n      var _r3f$handlers2;\n\n      return (_r3f$handlers2 = object.__r3f.handlers) == null ? void 0 : _r3f$handlers2.onPointerMissed == null ? void 0 : _r3f$handlers2.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer\n  };\n}\n\nfunction createPointerEvents(store) {\n  const {\n    handlePointer\n  } = createEvents(store);\n  const names = {\n    onClick: 'click',\n    onContextMenu: 'contextmenu',\n    onDoubleClick: 'dblclick',\n    onWheel: 'wheel',\n    onPointerDown: 'pointerdown',\n    onPointerUp: 'pointerup',\n    onPointerLeave: 'pointerleave',\n    onPointerMove: 'pointermove',\n    onPointerCancel: 'pointercancel',\n    onLostPointerCapture: 'lostpointercapture'\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce((acc, key) => ({ ...acc,\n      [key]: handlePointer(key)\n    }), {}),\n    connect: target => {\n      var _events$handlers;\n\n      const {\n        set,\n        events\n      } = store.getState();\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(state => ({\n        events: { ...state.events,\n          connected: target\n        }\n      }));\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(([name, event]) => target.addEventListener(names[name], event, {\n        passive: true\n      }));\n    },\n    disconnect: () => {\n      const {\n        set,\n        events\n      } = store.getState();\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(([name, event]) => {\n          if (events && events.connected instanceof HTMLElement) {\n            events.connected.removeEventListener(names[name], event);\n          }\n        });\n        set(state => ({\n          events: { ...state.events,\n            connected: false\n          }\n        }));\n      }\n    }\n  };\n}\n\n// React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\nfunction Canvas({\n  children,\n  resize,\n  style,\n  className,\n  events,\n  ...props\n}) {\n  const [ref, size] = useMeasure({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    ...resize\n  });\n  const canvas = React.useRef(null);\n  useIsomorphicLayoutEffect(() => {\n    if (size.width > 0 && size.height > 0) {\n      render(children, canvas.current, { ...props,\n        size,\n        events: events || createPointerEvents\n      });\n    }\n  }, [size, children]);\n  React.useEffect(() => {\n    const container = canvas.current;\n    return () => unmountComponentAtNode(container);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: ref,\n    className: className,\n    style: {\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden',\n      ...style\n    }\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvas,\n    style: {\n      display: 'block'\n    }\n  }));\n}\n\nfunction useThree(selector = state => state, equalityFn) {\n  const useStore = React.useContext(context);\n  if (!useStore) throw `R3F hooks can only be used within the Canvas component!`;\n  return useStore(selector, equalityFn);\n}\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = React.useContext(context).getState().internal; // Update ref\n\n  const ref = React.useRef(callback);\n  React.useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  React.useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  const data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(obj => {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(() => buildGraph(object), [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, ...input) {\n    // Construct new loader and run extensions\n    const loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    return Promise.all(input.map(input => new Promise((res, reject) => loader.load(input, data => {\n      if (data.scene) Object.assign(data, buildGraph(data.scene));\n      res(data);\n    }, onProgress, error => {\n      var _error$message;\n\n      return reject((_error$message = error.message) != null ? _error$message : `failure loading ${input}`);\n    }))));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  const keys = Array.isArray(input) ? input : [input];\n  const results = useAsset(loadingFn(extensions, onProgress), Proto, ...keys); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  const keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload(loadingFn(extensions), Proto, ...keys);\n};\n\nconst roots = new Map();\nconst modes = ['legacy', 'blocking', 'concurrent'];\nconst {\n  invalidate,\n  advance\n} = createLoop(roots);\nconst {\n  reconciler,\n  applyProps\n} = createRenderer();\n\nconst createRendererInstance = (gl, canvas) => isRenderer(gl) ? gl : new THREE.WebGLRenderer({\n  powerPreference: 'high-performance',\n  canvas: canvas,\n  antialias: true,\n  alpha: true,\n  ...gl\n});\n\nfunction render(element, canvas, {\n  gl,\n  size,\n  mode = modes[1],\n  events,\n  onCreated,\n  ...props\n} = {}) {\n  var _store;\n\n  // Allow size to take on container bounds initially\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  let root = roots.get(canvas);\n  let fiber = root == null ? void 0 : root.fiber;\n  let store = root == null ? void 0 : root.store;\n  let state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    const lastProps = state.internal.lastProps; // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n\n    if (props.dpr !== undefined && !is.equ(lastProps.dpr, props.dpr)) state.setDpr(props.dpr); // Check size\n\n    if (size !== undefined && !is.equ(lastProps.size, size)) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    const linearChanged = props.linear !== lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    const glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(timestamp => advance(timestamp, true));\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, {\n      gl: glRenderer,\n      size,\n      ...props\n    });\n    const state = store.getState();\n    state.get; // Create renderer\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber,\n      store\n    }); // Store events internally\n\n    if (events) state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, () => undefined);\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider({\n  store,\n  element,\n  onCreated,\n  target\n}) {\n  React.useEffect(() => {\n    const state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(state => ({\n      internal: { ...state.internal,\n        active: true\n      }\n    })); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  const root = roots.get(canvas);\n  const fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    const state = root == null ? void 0 : root.store.getState();\n    if (state) state.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, () => {\n      if (state) {\n        setTimeout(() => {\n          var _state$gl, _state$gl$renderLists, _state$gl2;\n\n          state.events.disconnect == null ? void 0 : state.events.disconnect();\n          (_state$gl = state.gl) == null ? void 0 : (_state$gl$renderLists = _state$gl.renderLists) == null ? void 0 : _state$gl$renderLists.dispose == null ? void 0 : _state$gl$renderLists.dispose();\n          (_state$gl2 = state.gl) == null ? void 0 : _state$gl2.forceContextLoss == null ? void 0 : _state$gl2.forceContextLoss();\n          dispose(state);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (const p in obj) {\n    var _dispose, _ref;\n    (_dispose = (_ref = p).dispose) == null ? void 0 : _dispose.call(_ref);\n    delete obj[p];\n  }\n}\n\nconst act = reconciler.act;\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, container, implementation, key = null) {\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo: prepare(container),\n    implementation\n  };\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  // @ts-ignore\n  version: \"0.0.0\" \n});\n\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useThree };\n"]},"metadata":{},"sourceType":"module"}