{"ast":null,"code":"import { UniformsUtils, UniformsLib } from 'three';\nimport { Node } from '../../core/Node.js';\nimport { ExpressionNode } from '../../core/ExpressionNode.js';\nimport { ColorNode } from '../../inputs/ColorNode.js';\nimport { FloatNode } from '../../inputs/FloatNode.js';\nimport { SpecularMIPLevelNode } from '../../utils/SpecularMIPLevelNode.js';\n\nfunction StandardNode() {\n  Node.call(this);\n  this.color = new ColorNode(0xffffff);\n  this.roughness = new FloatNode(1);\n  this.metalness = new FloatNode(0);\n}\n\nStandardNode.prototype = Object.create(Node.prototype);\nStandardNode.prototype.constructor = StandardNode;\nStandardNode.prototype.nodeType = 'Standard';\n\nStandardNode.prototype.build = function (builder) {\n  var code;\n  builder.define('STANDARD');\n  var useClearcoat = this.clearcoat || this.clearcoatRoughness || this.clearCoatNormal;\n\n  if (useClearcoat) {\n    builder.define('CLEARCOAT');\n  }\n\n  builder.requires.lights = true;\n  builder.extensions.derivatives = true;\n  builder.extensions.shaderTextureLOD = true;\n\n  if (builder.isShader('vertex')) {\n    var position = this.position ? this.position.analyzeAndFlow(builder, 'v3', {\n      cache: 'position'\n    }) : undefined;\n    builder.mergeUniform(UniformsUtils.merge([UniformsLib.fog, UniformsLib.lights]));\n\n    if (UniformsLib.LTC_1) {\n      // add ltc data textures to material uniforms\n      builder.uniforms.ltc_1 = {\n        value: undefined\n      };\n      builder.uniforms.ltc_2 = {\n        value: undefined\n      };\n    }\n\n    builder.addParsCode(['varying vec3 vViewPosition;', '#ifndef FLAT_SHADED', '\tvarying vec3 vNormal;', '#endif', //\"#include <encodings_pars_fragment>\", // encoding functions\n    '#include <fog_pars_vertex>', '#include <morphtarget_pars_vertex>', '#include <skinning_pars_vertex>', '#include <shadowmap_pars_vertex>', '#include <logdepthbuf_pars_vertex>', '#include <clipping_planes_pars_vertex>'].join('\\n'));\n    var output = ['#include <beginnormal_vertex>', '#include <morphnormal_vertex>', '#include <skinbase_vertex>', '#include <skinnormal_vertex>', '#include <defaultnormal_vertex>', '#ifndef FLAT_SHADED', // Normal computed with derivatives when FLAT_SHADED\n    '\tvNormal = normalize( transformedNormal );', '#endif', '#include <begin_vertex>'];\n\n    if (position) {\n      output.push(position.code, position.result ? 'transformed = ' + position.result + ';' : '');\n    }\n\n    output.push('#include <morphtarget_vertex>', '#include <skinning_vertex>', '#include <project_vertex>', '#include <fog_vertex>', '#include <logdepthbuf_vertex>', '#include <clipping_planes_vertex>', '\tvViewPosition = - mvPosition.xyz;', '#include <worldpos_vertex>', '#include <shadowmap_vertex>');\n    code = output.join('\\n');\n  } else {\n    var specularRoughness = new ExpressionNode('material.specularRoughness', 'f');\n    var clearcoatRoughness = new ExpressionNode('material.clearcoatRoughness', 'f');\n    var contextEnvironment = {\n      roughness: specularRoughness,\n      bias: new SpecularMIPLevelNode(specularRoughness),\n      viewNormal: new ExpressionNode('normal', 'v3'),\n      worldNormal: new ExpressionNode('inverseTransformDirection( geometry.normal, viewMatrix )', 'v3'),\n      gamma: true\n    };\n    var contextGammaOnly = {\n      gamma: true\n    };\n    var contextClearcoatEnvironment = {\n      roughness: clearcoatRoughness,\n      bias: new SpecularMIPLevelNode(clearcoatRoughness),\n      viewNormal: new ExpressionNode('clearcoatNormal', 'v3'),\n      worldNormal: new ExpressionNode('inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )', 'v3'),\n      gamma: true\n    }; // analyze all nodes to reuse generate codes\n\n    if (this.mask) this.mask.analyze(builder);\n    this.color.analyze(builder, {\n      slot: 'color',\n      context: contextGammaOnly\n    });\n    this.roughness.analyze(builder);\n    this.metalness.analyze(builder);\n    if (this.alpha) this.alpha.analyze(builder);\n    if (this.normal) this.normal.analyze(builder);\n    if (this.clearcoat) this.clearcoat.analyze(builder);\n    if (this.clearcoatRoughness) this.clearcoatRoughness.analyze(builder);\n    if (this.clearcoatNormal) this.clearcoatNormal.analyze(builder);\n    if (this.reflectivity) this.reflectivity.analyze(builder);\n    if (this.light) this.light.analyze(builder, {\n      cache: 'light'\n    });\n    if (this.ao) this.ao.analyze(builder);\n    if (this.ambient) this.ambient.analyze(builder);\n    if (this.shadow) this.shadow.analyze(builder);\n    if (this.emissive) this.emissive.analyze(builder, {\n      slot: 'emissive'\n    });\n\n    if (this.environment) {\n      // isolate environment from others inputs ( see TextureNode, CubeTextureNode )\n      // environment.analyze will detect if there is a need of calculate irradiance\n      this.environment.analyze(builder, {\n        cache: 'radiance',\n        context: contextEnvironment,\n        slot: 'radiance'\n      });\n\n      if (builder.requires.irradiance) {\n        this.environment.analyze(builder, {\n          cache: 'irradiance',\n          context: contextEnvironment,\n          slot: 'irradiance'\n        });\n      }\n    }\n\n    if (this.sheen) this.sheen.analyze(builder); // build code\n\n    var mask = this.mask ? this.mask.flow(builder, 'b') : undefined;\n    var color = this.color.flow(builder, 'c', {\n      slot: 'color',\n      context: contextGammaOnly\n    });\n    var roughness = this.roughness.flow(builder, 'f');\n    var metalness = this.metalness.flow(builder, 'f');\n    var alpha = this.alpha ? this.alpha.flow(builder, 'f') : undefined;\n    var normal = this.normal ? this.normal.flow(builder, 'v3') : undefined;\n    var clearcoat = this.clearcoat ? this.clearcoat.flow(builder, 'f') : undefined;\n    var clearcoatRoughness = this.clearcoatRoughness ? this.clearcoatRoughness.flow(builder, 'f') : undefined;\n    var clearcoatNormal = this.clearcoatNormal ? this.clearcoatNormal.flow(builder, 'v3') : undefined;\n    var reflectivity = this.reflectivity ? this.reflectivity.flow(builder, 'f') : undefined;\n    var light = this.light ? this.light.flow(builder, 'v3', {\n      cache: 'light'\n    }) : undefined;\n    var ao = this.ao ? this.ao.flow(builder, 'f') : undefined;\n    var ambient = this.ambient ? this.ambient.flow(builder, 'c') : undefined;\n    var shadow = this.shadow ? this.shadow.flow(builder, 'c') : undefined;\n    var emissive = this.emissive ? this.emissive.flow(builder, 'c', {\n      slot: 'emissive'\n    }) : undefined;\n    var environment;\n\n    if (this.environment) {\n      environment = {\n        radiance: this.environment.flow(builder, 'c', {\n          cache: 'radiance',\n          context: contextEnvironment,\n          slot: 'radiance'\n        })\n      };\n\n      if (builder.requires.irradiance) {\n        environment.irradiance = this.environment.flow(builder, 'c', {\n          cache: 'irradiance',\n          context: contextEnvironment,\n          slot: 'irradiance'\n        });\n      }\n    }\n\n    var clearcoatEnv = useClearcoat && environment ? this.environment.flow(builder, 'c', {\n      cache: 'clearcoat',\n      context: contextClearcoatEnvironment,\n      slot: 'environment'\n    }) : undefined;\n    var sheen = this.sheen ? this.sheen.flow(builder, 'c') : undefined;\n    builder.requires.transparent = alpha !== undefined;\n    builder.addParsCode(['varying vec3 vViewPosition;', '#ifndef FLAT_SHADED', '\tvarying vec3 vNormal;', '#endif', '#include <dithering_pars_fragment>', '#include <fog_pars_fragment>', '#include <bsdfs>', '#include <lights_pars_begin>', '#include <lights_physical_pars_fragment>', '#include <shadowmap_pars_fragment>', '#include <logdepthbuf_pars_fragment>'].join('\\n'));\n    var output = ['#include <clipping_planes_fragment>', // add before: prevent undeclared normal\n    '\t#include <normal_fragment_begin>', '\t#include <clearcoat_normal_fragment_begin>', // add before: prevent undeclared material\n    '\tPhysicalMaterial material;', '\tmaterial.diffuseColor = vec3( 1.0 );'];\n\n    if (mask) {\n      output.push(mask.code, 'if ( ! ' + mask.result + ' ) discard;');\n    }\n\n    output.push(color.code, '\tvec3 diffuseColor = ' + color.result + ';', '\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );', '#include <logdepthbuf_fragment>', roughness.code, '\tfloat roughnessFactor = ' + roughness.result + ';', metalness.code, '\tfloat metalnessFactor = ' + metalness.result + ';');\n\n    if (alpha) {\n      output.push(alpha.code, '#ifdef ALPHATEST', '\tif ( ' + alpha.result + ' <= ALPHATEST ) discard;', '#endif');\n    }\n\n    if (normal) {\n      output.push(normal.code, 'normal = ' + normal.result + ';');\n    }\n\n    if (clearcoatNormal) {\n      output.push(clearcoatNormal.code, 'clearcoatNormal = ' + clearcoatNormal.result + ';');\n    } // anti-aliasing code by @elalish\n\n\n    output.push('vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );', 'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );'); // optimization for now\n\n    output.push('material.diffuseColor = ' + (light ? 'vec3( 1.0 )' : 'diffuseColor * ( 1.0 - metalnessFactor )') + ';', 'material.specularRoughness = max( roughnessFactor, 0.0525 );', 'material.specularRoughness += geometryRoughness;', 'material.specularRoughness = min( material.specularRoughness, 1.0 );', 'material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );');\n\n    if (clearcoat) {\n      output.push(clearcoat.code, 'material.clearcoat = saturate( ' + clearcoat.result + ' );' // Burley clearcoat model\n      );\n    } else if (useClearcoat) {\n      output.push('material.clearcoat = 0.0;');\n    }\n\n    if (clearcoatRoughness) {\n      output.push(clearcoatRoughness.code, 'material.clearcoatRoughness = max( ' + clearcoatRoughness.result + ', 0.0525 );', 'material.clearcoatRoughness += geometryRoughness;', 'material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );');\n    } else if (useClearcoat) {\n      output.push('material.clearcoatRoughness = 0.0;');\n    }\n\n    if (sheen) {\n      output.push('material.sheenColor = ' + sheen.result + ';');\n    }\n\n    if (reflectivity) {\n      output.push(reflectivity.code, 'material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( ' + reflectivity.result + ' ) ), diffuseColor, metalnessFactor );');\n    } else {\n      output.push('material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );');\n    }\n\n    output.push('#include <lights_fragment_begin>');\n\n    if (light) {\n      output.push(light.code, 'reflectedLight.directDiffuse = ' + light.result + ';'); // apply color\n\n      output.push('diffuseColor *= 1.0 - metalnessFactor;', 'reflectedLight.directDiffuse *= diffuseColor;', 'reflectedLight.indirectDiffuse *= diffuseColor;');\n    }\n\n    if (ao) {\n      output.push(ao.code, 'reflectedLight.indirectDiffuse *= ' + ao.result + ';', 'float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );', 'reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ' + ao.result + ', material.specularRoughness );');\n    }\n\n    if (ambient) {\n      output.push(ambient.code, 'reflectedLight.indirectDiffuse += ' + ambient.result + ';');\n    }\n\n    if (shadow) {\n      output.push(shadow.code, 'reflectedLight.directDiffuse *= ' + shadow.result + ';', 'reflectedLight.directSpecular *= ' + shadow.result + ';');\n    }\n\n    if (emissive) {\n      output.push(emissive.code, 'reflectedLight.directDiffuse += ' + emissive.result + ';');\n    }\n\n    if (environment) {\n      output.push(environment.radiance.code);\n\n      if (builder.requires.irradiance) {\n        output.push(environment.irradiance.code);\n      }\n\n      if (clearcoatEnv) {\n        output.push(clearcoatEnv.code, 'clearcoatRadiance += ' + clearcoatEnv.result + ';');\n      }\n\n      output.push('radiance += ' + environment.radiance.result + ';');\n\n      if (builder.requires.irradiance) {\n        output.push('iblIrradiance += PI * ' + environment.irradiance.result + ';');\n      }\n    }\n\n    output.push('#include <lights_fragment_end>');\n    output.push('vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;');\n\n    if (alpha) {\n      output.push('gl_FragColor = vec4( outgoingLight, ' + alpha.result + ' );');\n    } else {\n      output.push('gl_FragColor = vec4( outgoingLight, 1.0 );');\n    }\n\n    output.push('#include <tonemapping_fragment>', '#include <encodings_fragment>', '#include <fog_fragment>', '#include <premultiplied_alpha_fragment>', '#include <dithering_fragment>');\n    code = output.join('\\n');\n  }\n\n  return code;\n};\n\nStandardNode.prototype.copy = function (source) {\n  Node.prototype.copy.call(this, source); // vertex\n\n  if (source.position) this.position = source.position; // fragment\n\n  this.color = source.color;\n  this.roughness = source.roughness;\n  this.metalness = source.metalness;\n  if (source.mask) this.mask = source.mask;\n  if (source.alpha) this.alpha = source.alpha;\n  if (source.normal) this.normal = source.normal;\n  if (source.clearcoat) this.clearcoat = source.clearcoat;\n  if (source.clearcoatRoughness) this.clearcoatRoughness = source.clearcoatRoughness;\n  if (source.clearcoatNormal) this.clearcoatNormal = source.clearcoatNormal;\n  if (source.reflectivity) this.reflectivity = source.reflectivity;\n  if (source.light) this.light = source.light;\n  if (source.shadow) this.shadow = source.shadow;\n  if (source.ao) this.ao = source.ao;\n  if (source.emissive) this.emissive = source.emissive;\n  if (source.ambient) this.ambient = source.ambient;\n  if (source.environment) this.environment = source.environment;\n  if (source.sheen) this.sheen = source.sheen;\n  return this;\n};\n\nStandardNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = this.createJSONNode(meta); // vertex\n\n    if (this.position) data.position = this.position.toJSON(meta).uuid; // fragment\n\n    data.color = this.color.toJSON(meta).uuid;\n    data.roughness = this.roughness.toJSON(meta).uuid;\n    data.metalness = this.metalness.toJSON(meta).uuid;\n    if (this.mask) data.mask = this.mask.toJSON(meta).uuid;\n    if (this.alpha) data.alpha = this.alpha.toJSON(meta).uuid;\n    if (this.normal) data.normal = this.normal.toJSON(meta).uuid;\n    if (this.clearcoat) data.clearcoat = this.clearcoat.toJSON(meta).uuid;\n    if (this.clearcoatRoughness) data.clearcoatRoughness = this.clearcoatRoughness.toJSON(meta).uuid;\n    if (this.clearcoatNormal) data.clearcoatNormal = this.clearcoatNormal.toJSON(meta).uuid;\n    if (this.reflectivity) data.reflectivity = this.reflectivity.toJSON(meta).uuid;\n    if (this.light) data.light = this.light.toJSON(meta).uuid;\n    if (this.shadow) data.shadow = this.shadow.toJSON(meta).uuid;\n    if (this.ao) data.ao = this.ao.toJSON(meta).uuid;\n    if (this.emissive) data.emissive = this.emissive.toJSON(meta).uuid;\n    if (this.ambient) data.ambient = this.ambient.toJSON(meta).uuid;\n    if (this.environment) data.environment = this.environment.toJSON(meta).uuid;\n    if (this.sheen) data.sheen = this.sheen.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n\nexport { StandardNode };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/nodes/materials/nodes/StandardNode.js"],"names":["UniformsUtils","UniformsLib","Node","ExpressionNode","ColorNode","FloatNode","SpecularMIPLevelNode","StandardNode","call","color","roughness","metalness","prototype","Object","create","constructor","nodeType","build","builder","code","define","useClearcoat","clearcoat","clearcoatRoughness","clearCoatNormal","requires","lights","extensions","derivatives","shaderTextureLOD","isShader","position","analyzeAndFlow","cache","undefined","mergeUniform","merge","fog","LTC_1","uniforms","ltc_1","value","ltc_2","addParsCode","join","output","push","result","specularRoughness","contextEnvironment","bias","viewNormal","worldNormal","gamma","contextGammaOnly","contextClearcoatEnvironment","mask","analyze","slot","context","alpha","normal","clearcoatNormal","reflectivity","light","ao","ambient","shadow","emissive","environment","irradiance","sheen","flow","radiance","clearcoatEnv","transparent","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"mappings":"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","sourcesContent":["import { UniformsUtils, UniformsLib } from 'three';\nimport { Node } from '../../core/Node.js';\nimport { ExpressionNode } from '../../core/ExpressionNode.js';\nimport { ColorNode } from '../../inputs/ColorNode.js';\nimport { FloatNode } from '../../inputs/FloatNode.js';\nimport { SpecularMIPLevelNode } from '../../utils/SpecularMIPLevelNode.js';\n\nfunction StandardNode() {\n  Node.call(this);\n  this.color = new ColorNode(0xffffff);\n  this.roughness = new FloatNode(1);\n  this.metalness = new FloatNode(0);\n}\n\nStandardNode.prototype = Object.create(Node.prototype);\nStandardNode.prototype.constructor = StandardNode;\nStandardNode.prototype.nodeType = 'Standard';\n\nStandardNode.prototype.build = function (builder) {\n  var code;\n  builder.define('STANDARD');\n  var useClearcoat = this.clearcoat || this.clearcoatRoughness || this.clearCoatNormal;\n\n  if (useClearcoat) {\n    builder.define('CLEARCOAT');\n  }\n\n  builder.requires.lights = true;\n  builder.extensions.derivatives = true;\n  builder.extensions.shaderTextureLOD = true;\n\n  if (builder.isShader('vertex')) {\n    var position = this.position ? this.position.analyzeAndFlow(builder, 'v3', {\n      cache: 'position'\n    }) : undefined;\n    builder.mergeUniform(UniformsUtils.merge([UniformsLib.fog, UniformsLib.lights]));\n\n    if (UniformsLib.LTC_1) {\n      // add ltc data textures to material uniforms\n      builder.uniforms.ltc_1 = {\n        value: undefined\n      };\n      builder.uniforms.ltc_2 = {\n        value: undefined\n      };\n    }\n\n    builder.addParsCode(['varying vec3 vViewPosition;', '#ifndef FLAT_SHADED', '\tvarying vec3 vNormal;', '#endif', //\"#include <encodings_pars_fragment>\", // encoding functions\n    '#include <fog_pars_vertex>', '#include <morphtarget_pars_vertex>', '#include <skinning_pars_vertex>', '#include <shadowmap_pars_vertex>', '#include <logdepthbuf_pars_vertex>', '#include <clipping_planes_pars_vertex>'].join('\\n'));\n    var output = ['#include <beginnormal_vertex>', '#include <morphnormal_vertex>', '#include <skinbase_vertex>', '#include <skinnormal_vertex>', '#include <defaultnormal_vertex>', '#ifndef FLAT_SHADED', // Normal computed with derivatives when FLAT_SHADED\n    '\tvNormal = normalize( transformedNormal );', '#endif', '#include <begin_vertex>'];\n\n    if (position) {\n      output.push(position.code, position.result ? 'transformed = ' + position.result + ';' : '');\n    }\n\n    output.push('#include <morphtarget_vertex>', '#include <skinning_vertex>', '#include <project_vertex>', '#include <fog_vertex>', '#include <logdepthbuf_vertex>', '#include <clipping_planes_vertex>', '\tvViewPosition = - mvPosition.xyz;', '#include <worldpos_vertex>', '#include <shadowmap_vertex>');\n    code = output.join('\\n');\n  } else {\n    var specularRoughness = new ExpressionNode('material.specularRoughness', 'f');\n    var clearcoatRoughness = new ExpressionNode('material.clearcoatRoughness', 'f');\n    var contextEnvironment = {\n      roughness: specularRoughness,\n      bias: new SpecularMIPLevelNode(specularRoughness),\n      viewNormal: new ExpressionNode('normal', 'v3'),\n      worldNormal: new ExpressionNode('inverseTransformDirection( geometry.normal, viewMatrix )', 'v3'),\n      gamma: true\n    };\n    var contextGammaOnly = {\n      gamma: true\n    };\n    var contextClearcoatEnvironment = {\n      roughness: clearcoatRoughness,\n      bias: new SpecularMIPLevelNode(clearcoatRoughness),\n      viewNormal: new ExpressionNode('clearcoatNormal', 'v3'),\n      worldNormal: new ExpressionNode('inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )', 'v3'),\n      gamma: true\n    }; // analyze all nodes to reuse generate codes\n\n    if (this.mask) this.mask.analyze(builder);\n    this.color.analyze(builder, {\n      slot: 'color',\n      context: contextGammaOnly\n    });\n    this.roughness.analyze(builder);\n    this.metalness.analyze(builder);\n    if (this.alpha) this.alpha.analyze(builder);\n    if (this.normal) this.normal.analyze(builder);\n    if (this.clearcoat) this.clearcoat.analyze(builder);\n    if (this.clearcoatRoughness) this.clearcoatRoughness.analyze(builder);\n    if (this.clearcoatNormal) this.clearcoatNormal.analyze(builder);\n    if (this.reflectivity) this.reflectivity.analyze(builder);\n    if (this.light) this.light.analyze(builder, {\n      cache: 'light'\n    });\n    if (this.ao) this.ao.analyze(builder);\n    if (this.ambient) this.ambient.analyze(builder);\n    if (this.shadow) this.shadow.analyze(builder);\n    if (this.emissive) this.emissive.analyze(builder, {\n      slot: 'emissive'\n    });\n\n    if (this.environment) {\n      // isolate environment from others inputs ( see TextureNode, CubeTextureNode )\n      // environment.analyze will detect if there is a need of calculate irradiance\n      this.environment.analyze(builder, {\n        cache: 'radiance',\n        context: contextEnvironment,\n        slot: 'radiance'\n      });\n\n      if (builder.requires.irradiance) {\n        this.environment.analyze(builder, {\n          cache: 'irradiance',\n          context: contextEnvironment,\n          slot: 'irradiance'\n        });\n      }\n    }\n\n    if (this.sheen) this.sheen.analyze(builder); // build code\n\n    var mask = this.mask ? this.mask.flow(builder, 'b') : undefined;\n    var color = this.color.flow(builder, 'c', {\n      slot: 'color',\n      context: contextGammaOnly\n    });\n    var roughness = this.roughness.flow(builder, 'f');\n    var metalness = this.metalness.flow(builder, 'f');\n    var alpha = this.alpha ? this.alpha.flow(builder, 'f') : undefined;\n    var normal = this.normal ? this.normal.flow(builder, 'v3') : undefined;\n    var clearcoat = this.clearcoat ? this.clearcoat.flow(builder, 'f') : undefined;\n    var clearcoatRoughness = this.clearcoatRoughness ? this.clearcoatRoughness.flow(builder, 'f') : undefined;\n    var clearcoatNormal = this.clearcoatNormal ? this.clearcoatNormal.flow(builder, 'v3') : undefined;\n    var reflectivity = this.reflectivity ? this.reflectivity.flow(builder, 'f') : undefined;\n    var light = this.light ? this.light.flow(builder, 'v3', {\n      cache: 'light'\n    }) : undefined;\n    var ao = this.ao ? this.ao.flow(builder, 'f') : undefined;\n    var ambient = this.ambient ? this.ambient.flow(builder, 'c') : undefined;\n    var shadow = this.shadow ? this.shadow.flow(builder, 'c') : undefined;\n    var emissive = this.emissive ? this.emissive.flow(builder, 'c', {\n      slot: 'emissive'\n    }) : undefined;\n    var environment;\n\n    if (this.environment) {\n      environment = {\n        radiance: this.environment.flow(builder, 'c', {\n          cache: 'radiance',\n          context: contextEnvironment,\n          slot: 'radiance'\n        })\n      };\n\n      if (builder.requires.irradiance) {\n        environment.irradiance = this.environment.flow(builder, 'c', {\n          cache: 'irradiance',\n          context: contextEnvironment,\n          slot: 'irradiance'\n        });\n      }\n    }\n\n    var clearcoatEnv = useClearcoat && environment ? this.environment.flow(builder, 'c', {\n      cache: 'clearcoat',\n      context: contextClearcoatEnvironment,\n      slot: 'environment'\n    }) : undefined;\n    var sheen = this.sheen ? this.sheen.flow(builder, 'c') : undefined;\n    builder.requires.transparent = alpha !== undefined;\n    builder.addParsCode(['varying vec3 vViewPosition;', '#ifndef FLAT_SHADED', '\tvarying vec3 vNormal;', '#endif', '#include <dithering_pars_fragment>', '#include <fog_pars_fragment>', '#include <bsdfs>', '#include <lights_pars_begin>', '#include <lights_physical_pars_fragment>', '#include <shadowmap_pars_fragment>', '#include <logdepthbuf_pars_fragment>'].join('\\n'));\n    var output = ['#include <clipping_planes_fragment>', // add before: prevent undeclared normal\n    '\t#include <normal_fragment_begin>', '\t#include <clearcoat_normal_fragment_begin>', // add before: prevent undeclared material\n    '\tPhysicalMaterial material;', '\tmaterial.diffuseColor = vec3( 1.0 );'];\n\n    if (mask) {\n      output.push(mask.code, 'if ( ! ' + mask.result + ' ) discard;');\n    }\n\n    output.push(color.code, '\tvec3 diffuseColor = ' + color.result + ';', '\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );', '#include <logdepthbuf_fragment>', roughness.code, '\tfloat roughnessFactor = ' + roughness.result + ';', metalness.code, '\tfloat metalnessFactor = ' + metalness.result + ';');\n\n    if (alpha) {\n      output.push(alpha.code, '#ifdef ALPHATEST', '\tif ( ' + alpha.result + ' <= ALPHATEST ) discard;', '#endif');\n    }\n\n    if (normal) {\n      output.push(normal.code, 'normal = ' + normal.result + ';');\n    }\n\n    if (clearcoatNormal) {\n      output.push(clearcoatNormal.code, 'clearcoatNormal = ' + clearcoatNormal.result + ';');\n    } // anti-aliasing code by @elalish\n\n\n    output.push('vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );', 'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );'); // optimization for now\n\n    output.push('material.diffuseColor = ' + (light ? 'vec3( 1.0 )' : 'diffuseColor * ( 1.0 - metalnessFactor )') + ';', 'material.specularRoughness = max( roughnessFactor, 0.0525 );', 'material.specularRoughness += geometryRoughness;', 'material.specularRoughness = min( material.specularRoughness, 1.0 );', 'material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );');\n\n    if (clearcoat) {\n      output.push(clearcoat.code, 'material.clearcoat = saturate( ' + clearcoat.result + ' );' // Burley clearcoat model\n      );\n    } else if (useClearcoat) {\n      output.push('material.clearcoat = 0.0;');\n    }\n\n    if (clearcoatRoughness) {\n      output.push(clearcoatRoughness.code, 'material.clearcoatRoughness = max( ' + clearcoatRoughness.result + ', 0.0525 );', 'material.clearcoatRoughness += geometryRoughness;', 'material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );');\n    } else if (useClearcoat) {\n      output.push('material.clearcoatRoughness = 0.0;');\n    }\n\n    if (sheen) {\n      output.push('material.sheenColor = ' + sheen.result + ';');\n    }\n\n    if (reflectivity) {\n      output.push(reflectivity.code, 'material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( ' + reflectivity.result + ' ) ), diffuseColor, metalnessFactor );');\n    } else {\n      output.push('material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );');\n    }\n\n    output.push('#include <lights_fragment_begin>');\n\n    if (light) {\n      output.push(light.code, 'reflectedLight.directDiffuse = ' + light.result + ';'); // apply color\n\n      output.push('diffuseColor *= 1.0 - metalnessFactor;', 'reflectedLight.directDiffuse *= diffuseColor;', 'reflectedLight.indirectDiffuse *= diffuseColor;');\n    }\n\n    if (ao) {\n      output.push(ao.code, 'reflectedLight.indirectDiffuse *= ' + ao.result + ';', 'float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );', 'reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ' + ao.result + ', material.specularRoughness );');\n    }\n\n    if (ambient) {\n      output.push(ambient.code, 'reflectedLight.indirectDiffuse += ' + ambient.result + ';');\n    }\n\n    if (shadow) {\n      output.push(shadow.code, 'reflectedLight.directDiffuse *= ' + shadow.result + ';', 'reflectedLight.directSpecular *= ' + shadow.result + ';');\n    }\n\n    if (emissive) {\n      output.push(emissive.code, 'reflectedLight.directDiffuse += ' + emissive.result + ';');\n    }\n\n    if (environment) {\n      output.push(environment.radiance.code);\n\n      if (builder.requires.irradiance) {\n        output.push(environment.irradiance.code);\n      }\n\n      if (clearcoatEnv) {\n        output.push(clearcoatEnv.code, 'clearcoatRadiance += ' + clearcoatEnv.result + ';');\n      }\n\n      output.push('radiance += ' + environment.radiance.result + ';');\n\n      if (builder.requires.irradiance) {\n        output.push('iblIrradiance += PI * ' + environment.irradiance.result + ';');\n      }\n    }\n\n    output.push('#include <lights_fragment_end>');\n    output.push('vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;');\n\n    if (alpha) {\n      output.push('gl_FragColor = vec4( outgoingLight, ' + alpha.result + ' );');\n    } else {\n      output.push('gl_FragColor = vec4( outgoingLight, 1.0 );');\n    }\n\n    output.push('#include <tonemapping_fragment>', '#include <encodings_fragment>', '#include <fog_fragment>', '#include <premultiplied_alpha_fragment>', '#include <dithering_fragment>');\n    code = output.join('\\n');\n  }\n\n  return code;\n};\n\nStandardNode.prototype.copy = function (source) {\n  Node.prototype.copy.call(this, source); // vertex\n\n  if (source.position) this.position = source.position; // fragment\n\n  this.color = source.color;\n  this.roughness = source.roughness;\n  this.metalness = source.metalness;\n  if (source.mask) this.mask = source.mask;\n  if (source.alpha) this.alpha = source.alpha;\n  if (source.normal) this.normal = source.normal;\n  if (source.clearcoat) this.clearcoat = source.clearcoat;\n  if (source.clearcoatRoughness) this.clearcoatRoughness = source.clearcoatRoughness;\n  if (source.clearcoatNormal) this.clearcoatNormal = source.clearcoatNormal;\n  if (source.reflectivity) this.reflectivity = source.reflectivity;\n  if (source.light) this.light = source.light;\n  if (source.shadow) this.shadow = source.shadow;\n  if (source.ao) this.ao = source.ao;\n  if (source.emissive) this.emissive = source.emissive;\n  if (source.ambient) this.ambient = source.ambient;\n  if (source.environment) this.environment = source.environment;\n  if (source.sheen) this.sheen = source.sheen;\n  return this;\n};\n\nStandardNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = this.createJSONNode(meta); // vertex\n\n    if (this.position) data.position = this.position.toJSON(meta).uuid; // fragment\n\n    data.color = this.color.toJSON(meta).uuid;\n    data.roughness = this.roughness.toJSON(meta).uuid;\n    data.metalness = this.metalness.toJSON(meta).uuid;\n    if (this.mask) data.mask = this.mask.toJSON(meta).uuid;\n    if (this.alpha) data.alpha = this.alpha.toJSON(meta).uuid;\n    if (this.normal) data.normal = this.normal.toJSON(meta).uuid;\n    if (this.clearcoat) data.clearcoat = this.clearcoat.toJSON(meta).uuid;\n    if (this.clearcoatRoughness) data.clearcoatRoughness = this.clearcoatRoughness.toJSON(meta).uuid;\n    if (this.clearcoatNormal) data.clearcoatNormal = this.clearcoatNormal.toJSON(meta).uuid;\n    if (this.reflectivity) data.reflectivity = this.reflectivity.toJSON(meta).uuid;\n    if (this.light) data.light = this.light.toJSON(meta).uuid;\n    if (this.shadow) data.shadow = this.shadow.toJSON(meta).uuid;\n    if (this.ao) data.ao = this.ao.toJSON(meta).uuid;\n    if (this.emissive) data.emissive = this.emissive.toJSON(meta).uuid;\n    if (this.ambient) data.ambient = this.ambient.toJSON(meta).uuid;\n    if (this.environment) data.environment = this.environment.toJSON(meta).uuid;\n    if (this.sheen) data.sheen = this.sheen.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n\nexport { StandardNode };\n"]},"metadata":{},"sourceType":"module"}