{"ast":null,"code":"import { Vector3, Matrix3, Box3, Matrix4, Ray, MathUtils } from 'three';\nvar a = {\n  c: null,\n  // center\n  u: [new Vector3(), new Vector3(), new Vector3()],\n  // basis vectors\n  e: [] // half width\n\n};\nvar b = {\n  c: null,\n  // center\n  u: [new Vector3(), new Vector3(), new Vector3()],\n  // basis vectors\n  e: [] // half width\n\n};\nvar R = [[], [], []];\nvar AbsR = [[], [], []];\nvar t = [];\nvar xAxis = new Vector3();\nvar yAxis = new Vector3();\nvar zAxis = new Vector3();\nvar v1 = new Vector3();\nvar size = new Vector3();\nvar closestPoint = new Vector3();\nvar rotationMatrix = new Matrix3();\nvar aabb = new Box3();\nvar matrix = new Matrix4();\nvar inverse = new Matrix4();\nvar localRay = new Ray(); // OBB\n\nfunction OBB() {\n  var center = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Vector3();\n  var halfSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Vector3();\n  var rotation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Matrix3();\n  this.center = center;\n  this.halfSize = halfSize;\n  this.rotation = rotation;\n}\n\nObject.assign(OBB.prototype, {\n  set: function set(center, halfSize, rotation) {\n    this.center = center;\n    this.halfSize = halfSize;\n    this.rotation = rotation;\n    return this;\n  },\n  copy: function copy(obb) {\n    this.center.copy(obb.center);\n    this.halfSize.copy(obb.halfSize);\n    this.rotation.copy(obb.rotation);\n    return this;\n  },\n  clone: function clone() {\n    return new this.constructor().copy(this);\n  },\n  getSize: function getSize(result) {\n    return result.copy(this.halfSize).multiplyScalar(2);\n  },\n\n  /**\n   * Reference: Closest Point on OBB to Point in Real-Time Collision Detection\n   * by Christer Ericson (chapter 5.1.4)\n   */\n  clampPoint: function clampPoint(point, result) {\n    var halfSize = this.halfSize;\n    v1.subVectors(point, this.center);\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // start at the center position of the OBB\n\n    result.copy(this.center); // project the target onto the OBB axes and walk towards that point\n\n    var x = MathUtils.clamp(v1.dot(xAxis), -halfSize.x, halfSize.x);\n    result.add(xAxis.multiplyScalar(x));\n    var y = MathUtils.clamp(v1.dot(yAxis), -halfSize.y, halfSize.y);\n    result.add(yAxis.multiplyScalar(y));\n    var z = MathUtils.clamp(v1.dot(zAxis), -halfSize.z, halfSize.z);\n    result.add(zAxis.multiplyScalar(z));\n    return result;\n  },\n  containsPoint: function containsPoint(point) {\n    v1.subVectors(point, this.center);\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // project v1 onto each axis and check if these points lie inside the OBB\n\n    return Math.abs(v1.dot(xAxis)) <= this.halfSize.x && Math.abs(v1.dot(yAxis)) <= this.halfSize.y && Math.abs(v1.dot(zAxis)) <= this.halfSize.z;\n  },\n  intersectsBox3: function intersectsBox3(box3) {\n    return this.intersectsOBB(obb.fromBox3(box3));\n  },\n  intersectsSphere: function intersectsSphere(sphere) {\n    // find the point on the OBB closest to the sphere center\n    this.clampPoint(sphere.center, closestPoint); // if that point is inside the sphere, the OBB and sphere intersect\n\n    return closestPoint.distanceToSquared(sphere.center) <= sphere.radius * sphere.radius;\n  },\n\n  /**\n   * Reference: OBB-OBB Intersection in Real-Time Collision Detection\n   * by Christer Ericson (chapter 4.4.1)\n   *\n   */\n  intersectsOBB: function intersectsOBB(obb) {\n    var epsilon = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.EPSILON;\n    // prepare data structures (the code uses the same nomenclature like the reference)\n    a.c = this.center;\n    a.e[0] = this.halfSize.x;\n    a.e[1] = this.halfSize.y;\n    a.e[2] = this.halfSize.z;\n    this.rotation.extractBasis(a.u[0], a.u[1], a.u[2]);\n    b.c = obb.center;\n    b.e[0] = obb.halfSize.x;\n    b.e[1] = obb.halfSize.y;\n    b.e[2] = obb.halfSize.z;\n    obb.rotation.extractBasis(b.u[0], b.u[1], b.u[2]); // compute rotation matrix expressing b in a's coordinate frame\n\n    for (var i = 0; i < 3; i++) {\n      for (var j = 0; j < 3; j++) {\n        R[i][j] = a.u[i].dot(b.u[j]);\n      }\n    } // compute translation vector\n\n\n    v1.subVectors(b.c, a.c); // bring translation into a's coordinate frame\n\n    t[0] = v1.dot(a.u[0]);\n    t[1] = v1.dot(a.u[1]);\n    t[2] = v1.dot(a.u[2]); // compute common subexpressions. Add in an epsilon term to\n    // counteract arithmetic errors when two edges are parallel and\n    // their cross product is (near) null\n\n    for (var _i = 0; _i < 3; _i++) {\n      for (var _j = 0; _j < 3; _j++) {\n        AbsR[_i][_j] = Math.abs(R[_i][_j]) + epsilon;\n      }\n    }\n\n    var ra, rb; // test axes L = A0, L = A1, L = A2\n\n    for (var _i2 = 0; _i2 < 3; _i2++) {\n      ra = a.e[_i2];\n      rb = b.e[0] * AbsR[_i2][0] + b.e[1] * AbsR[_i2][1] + b.e[2] * AbsR[_i2][2];\n      if (Math.abs(t[_i2]) > ra + rb) return false;\n    } // test axes L = B0, L = B1, L = B2\n\n\n    for (var _i3 = 0; _i3 < 3; _i3++) {\n      ra = a.e[0] * AbsR[0][_i3] + a.e[1] * AbsR[1][_i3] + a.e[2] * AbsR[2][_i3];\n      rb = b.e[_i3];\n      if (Math.abs(t[0] * R[0][_i3] + t[1] * R[1][_i3] + t[2] * R[2][_i3]) > ra + rb) return false;\n    } // test axis L = A0 x B0\n\n\n    ra = a.e[1] * AbsR[2][0] + a.e[2] * AbsR[1][0];\n    rb = b.e[1] * AbsR[0][2] + b.e[2] * AbsR[0][1];\n    if (Math.abs(t[2] * R[1][0] - t[1] * R[2][0]) > ra + rb) return false; // test axis L = A0 x B1\n\n    ra = a.e[1] * AbsR[2][1] + a.e[2] * AbsR[1][1];\n    rb = b.e[0] * AbsR[0][2] + b.e[2] * AbsR[0][0];\n    if (Math.abs(t[2] * R[1][1] - t[1] * R[2][1]) > ra + rb) return false; // test axis L = A0 x B2\n\n    ra = a.e[1] * AbsR[2][2] + a.e[2] * AbsR[1][2];\n    rb = b.e[0] * AbsR[0][1] + b.e[1] * AbsR[0][0];\n    if (Math.abs(t[2] * R[1][2] - t[1] * R[2][2]) > ra + rb) return false; // test axis L = A1 x B0\n\n    ra = a.e[0] * AbsR[2][0] + a.e[2] * AbsR[0][0];\n    rb = b.e[1] * AbsR[1][2] + b.e[2] * AbsR[1][1];\n    if (Math.abs(t[0] * R[2][0] - t[2] * R[0][0]) > ra + rb) return false; // test axis L = A1 x B1\n\n    ra = a.e[0] * AbsR[2][1] + a.e[2] * AbsR[0][1];\n    rb = b.e[0] * AbsR[1][2] + b.e[2] * AbsR[1][0];\n    if (Math.abs(t[0] * R[2][1] - t[2] * R[0][1]) > ra + rb) return false; // test axis L = A1 x B2\n\n    ra = a.e[0] * AbsR[2][2] + a.e[2] * AbsR[0][2];\n    rb = b.e[0] * AbsR[1][1] + b.e[1] * AbsR[1][0];\n    if (Math.abs(t[0] * R[2][2] - t[2] * R[0][2]) > ra + rb) return false; // test axis L = A2 x B0\n\n    ra = a.e[0] * AbsR[1][0] + a.e[1] * AbsR[0][0];\n    rb = b.e[1] * AbsR[2][2] + b.e[2] * AbsR[2][1];\n    if (Math.abs(t[1] * R[0][0] - t[0] * R[1][0]) > ra + rb) return false; // test axis L = A2 x B1\n\n    ra = a.e[0] * AbsR[1][1] + a.e[1] * AbsR[0][1];\n    rb = b.e[0] * AbsR[2][2] + b.e[2] * AbsR[2][0];\n    if (Math.abs(t[1] * R[0][1] - t[0] * R[1][1]) > ra + rb) return false; // test axis L = A2 x B2\n\n    ra = a.e[0] * AbsR[1][2] + a.e[1] * AbsR[0][2];\n    rb = b.e[0] * AbsR[2][1] + b.e[1] * AbsR[2][0];\n    if (Math.abs(t[1] * R[0][2] - t[0] * R[1][2]) > ra + rb) return false; // since no separating axis is found, the OBBs must be intersecting\n\n    return true;\n  },\n\n  /**\n   * Reference: Testing Box Against Plane in Real-Time Collision Detection\n   * by Christer Ericson (chapter 5.2.3)\n   */\n  intersectsPlane: function intersectsPlane(plane) {\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // compute the projection interval radius of this OBB onto L(t) = this->center + t * p.normal;\n\n    var r = this.halfSize.x * Math.abs(plane.normal.dot(xAxis)) + this.halfSize.y * Math.abs(plane.normal.dot(yAxis)) + this.halfSize.z * Math.abs(plane.normal.dot(zAxis)); // compute distance of the OBB's center from the plane\n\n    var d = plane.normal.dot(this.center) - plane.constant; // Intersection occurs when distance d falls within [-r,+r] interval\n\n    return Math.abs(d) <= r;\n  },\n\n  /**\n   * Performs a ray/OBB intersection test and stores the intersection point\n   * to the given 3D vector. If no intersection is detected, *null* is returned.\n   */\n  intersectRay: function intersectRay(ray, result) {\n    // the idea is to perform the intersection test in the local space\n    // of the OBB.\n    this.getSize(size);\n    aabb.setFromCenterAndSize(v1.set(0, 0, 0), size); // create a 4x4 transformation matrix\n\n    matrix4FromRotationMatrix(matrix, this.rotation);\n    matrix.setPosition(this.center); // transform ray to the local space of the OBB\n\n    inverse.copy(matrix).invert();\n    localRay.copy(ray).applyMatrix4(inverse); // perform ray <-> AABB intersection test\n\n    if (localRay.intersectBox(aabb, result)) {\n      // transform the intersection point back to world space\n      return result.applyMatrix4(matrix);\n    } else {\n      return null;\n    }\n  },\n\n  /**\n   * Performs a ray/OBB intersection test. Returns either true or false if\n   * there is a intersection or not.\n   */\n  intersectsRay: function intersectsRay(ray) {\n    return this.intersectRay(ray, v1) !== null;\n  },\n  fromBox3: function fromBox3(box3) {\n    box3.getCenter(this.center);\n    box3.getSize(this.halfSize).multiplyScalar(0.5);\n    this.rotation.identity();\n    return this;\n  },\n  equals: function equals(obb) {\n    return obb.center.equals(this.center) && obb.halfSize.equals(this.halfSize) && obb.rotation.equals(this.rotation);\n  },\n  applyMatrix4: function applyMatrix4(matrix) {\n    var e = matrix.elements;\n    var sx = v1.set(e[0], e[1], e[2]).length();\n    var sy = v1.set(e[4], e[5], e[6]).length();\n    var sz = v1.set(e[8], e[9], e[10]).length();\n    var det = matrix.determinant();\n    if (det < 0) sx = -sx;\n    rotationMatrix.setFromMatrix4(matrix);\n    var invSX = 1 / sx;\n    var invSY = 1 / sy;\n    var invSZ = 1 / sz;\n    rotationMatrix.elements[0] *= invSX;\n    rotationMatrix.elements[1] *= invSX;\n    rotationMatrix.elements[2] *= invSX;\n    rotationMatrix.elements[3] *= invSY;\n    rotationMatrix.elements[4] *= invSY;\n    rotationMatrix.elements[5] *= invSY;\n    rotationMatrix.elements[6] *= invSZ;\n    rotationMatrix.elements[7] *= invSZ;\n    rotationMatrix.elements[8] *= invSZ;\n    this.rotation.multiply(rotationMatrix);\n    this.halfSize.x *= sx;\n    this.halfSize.y *= sy;\n    this.halfSize.z *= sz;\n    v1.setFromMatrixPosition(matrix);\n    this.center.add(v1);\n    return this;\n  }\n});\n\nfunction matrix4FromRotationMatrix(matrix4, matrix3) {\n  var e = matrix4.elements;\n  var me = matrix3.elements;\n  e[0] = me[0];\n  e[1] = me[1];\n  e[2] = me[2];\n  e[3] = 0;\n  e[4] = me[3];\n  e[5] = me[4];\n  e[6] = me[5];\n  e[7] = 0;\n  e[8] = me[6];\n  e[9] = me[7];\n  e[10] = me[8];\n  e[11] = 0;\n  e[12] = 0;\n  e[13] = 0;\n  e[14] = 0;\n  e[15] = 1;\n}\n\nvar obb = new OBB();\nexport { OBB };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/math/OBB.js"],"names":["Vector3","Matrix3","Box3","Matrix4","Ray","MathUtils","a","c","u","e","b","R","AbsR","t","xAxis","yAxis","zAxis","v1","size","closestPoint","rotationMatrix","aabb","matrix","inverse","localRay","OBB","center","halfSize","rotation","Object","assign","prototype","set","copy","obb","clone","constructor","getSize","result","multiplyScalar","clampPoint","point","subVectors","extractBasis","x","clamp","dot","add","y","z","containsPoint","Math","abs","intersectsBox3","box3","intersectsOBB","fromBox3","intersectsSphere","sphere","distanceToSquared","radius","epsilon","Number","EPSILON","i","j","ra","rb","intersectsPlane","plane","r","normal","d","constant","intersectRay","ray","setFromCenterAndSize","matrix4FromRotationMatrix","setPosition","invert","applyMatrix4","intersectBox","intersectsRay","getCenter","identity","equals","elements","sx","length","sy","sz","det","determinant","setFromMatrix4","invSX","invSY","invSZ","multiply","setFromMatrixPosition","matrix4","matrix3","me"],"mappings":"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","sourcesContent":["import { Vector3, Matrix3, Box3, Matrix4, Ray, MathUtils } from 'three';\n\nvar a = {\n  c: null,\n  // center\n  u: [new Vector3(), new Vector3(), new Vector3()],\n  // basis vectors\n  e: [] // half width\n\n};\nvar b = {\n  c: null,\n  // center\n  u: [new Vector3(), new Vector3(), new Vector3()],\n  // basis vectors\n  e: [] // half width\n\n};\nvar R = [[], [], []];\nvar AbsR = [[], [], []];\nvar t = [];\nvar xAxis = new Vector3();\nvar yAxis = new Vector3();\nvar zAxis = new Vector3();\nvar v1 = new Vector3();\nvar size = new Vector3();\nvar closestPoint = new Vector3();\nvar rotationMatrix = new Matrix3();\nvar aabb = new Box3();\nvar matrix = new Matrix4();\nvar inverse = new Matrix4();\nvar localRay = new Ray(); // OBB\n\nfunction OBB(center = new Vector3(), halfSize = new Vector3(), rotation = new Matrix3()) {\n  this.center = center;\n  this.halfSize = halfSize;\n  this.rotation = rotation;\n}\n\nObject.assign(OBB.prototype, {\n  set: function (center, halfSize, rotation) {\n    this.center = center;\n    this.halfSize = halfSize;\n    this.rotation = rotation;\n    return this;\n  },\n  copy: function (obb) {\n    this.center.copy(obb.center);\n    this.halfSize.copy(obb.halfSize);\n    this.rotation.copy(obb.rotation);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  getSize: function (result) {\n    return result.copy(this.halfSize).multiplyScalar(2);\n  },\n\n  /**\n   * Reference: Closest Point on OBB to Point in Real-Time Collision Detection\n   * by Christer Ericson (chapter 5.1.4)\n   */\n  clampPoint: function (point, result) {\n    var halfSize = this.halfSize;\n    v1.subVectors(point, this.center);\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // start at the center position of the OBB\n\n    result.copy(this.center); // project the target onto the OBB axes and walk towards that point\n\n    var x = MathUtils.clamp(v1.dot(xAxis), -halfSize.x, halfSize.x);\n    result.add(xAxis.multiplyScalar(x));\n    var y = MathUtils.clamp(v1.dot(yAxis), -halfSize.y, halfSize.y);\n    result.add(yAxis.multiplyScalar(y));\n    var z = MathUtils.clamp(v1.dot(zAxis), -halfSize.z, halfSize.z);\n    result.add(zAxis.multiplyScalar(z));\n    return result;\n  },\n  containsPoint: function (point) {\n    v1.subVectors(point, this.center);\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // project v1 onto each axis and check if these points lie inside the OBB\n\n    return Math.abs(v1.dot(xAxis)) <= this.halfSize.x && Math.abs(v1.dot(yAxis)) <= this.halfSize.y && Math.abs(v1.dot(zAxis)) <= this.halfSize.z;\n  },\n  intersectsBox3: function (box3) {\n    return this.intersectsOBB(obb.fromBox3(box3));\n  },\n  intersectsSphere: function (sphere) {\n    // find the point on the OBB closest to the sphere center\n    this.clampPoint(sphere.center, closestPoint); // if that point is inside the sphere, the OBB and sphere intersect\n\n    return closestPoint.distanceToSquared(sphere.center) <= sphere.radius * sphere.radius;\n  },\n\n  /**\n   * Reference: OBB-OBB Intersection in Real-Time Collision Detection\n   * by Christer Ericson (chapter 4.4.1)\n   *\n   */\n  intersectsOBB: function (obb, epsilon = Number.EPSILON) {\n    // prepare data structures (the code uses the same nomenclature like the reference)\n    a.c = this.center;\n    a.e[0] = this.halfSize.x;\n    a.e[1] = this.halfSize.y;\n    a.e[2] = this.halfSize.z;\n    this.rotation.extractBasis(a.u[0], a.u[1], a.u[2]);\n    b.c = obb.center;\n    b.e[0] = obb.halfSize.x;\n    b.e[1] = obb.halfSize.y;\n    b.e[2] = obb.halfSize.z;\n    obb.rotation.extractBasis(b.u[0], b.u[1], b.u[2]); // compute rotation matrix expressing b in a's coordinate frame\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        R[i][j] = a.u[i].dot(b.u[j]);\n      }\n    } // compute translation vector\n\n\n    v1.subVectors(b.c, a.c); // bring translation into a's coordinate frame\n\n    t[0] = v1.dot(a.u[0]);\n    t[1] = v1.dot(a.u[1]);\n    t[2] = v1.dot(a.u[2]); // compute common subexpressions. Add in an epsilon term to\n    // counteract arithmetic errors when two edges are parallel and\n    // their cross product is (near) null\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        AbsR[i][j] = Math.abs(R[i][j]) + epsilon;\n      }\n    }\n\n    var ra, rb; // test axes L = A0, L = A1, L = A2\n\n    for (let i = 0; i < 3; i++) {\n      ra = a.e[i];\n      rb = b.e[0] * AbsR[i][0] + b.e[1] * AbsR[i][1] + b.e[2] * AbsR[i][2];\n      if (Math.abs(t[i]) > ra + rb) return false;\n    } // test axes L = B0, L = B1, L = B2\n\n\n    for (let i = 0; i < 3; i++) {\n      ra = a.e[0] * AbsR[0][i] + a.e[1] * AbsR[1][i] + a.e[2] * AbsR[2][i];\n      rb = b.e[i];\n      if (Math.abs(t[0] * R[0][i] + t[1] * R[1][i] + t[2] * R[2][i]) > ra + rb) return false;\n    } // test axis L = A0 x B0\n\n\n    ra = a.e[1] * AbsR[2][0] + a.e[2] * AbsR[1][0];\n    rb = b.e[1] * AbsR[0][2] + b.e[2] * AbsR[0][1];\n    if (Math.abs(t[2] * R[1][0] - t[1] * R[2][0]) > ra + rb) return false; // test axis L = A0 x B1\n\n    ra = a.e[1] * AbsR[2][1] + a.e[2] * AbsR[1][1];\n    rb = b.e[0] * AbsR[0][2] + b.e[2] * AbsR[0][0];\n    if (Math.abs(t[2] * R[1][1] - t[1] * R[2][1]) > ra + rb) return false; // test axis L = A0 x B2\n\n    ra = a.e[1] * AbsR[2][2] + a.e[2] * AbsR[1][2];\n    rb = b.e[0] * AbsR[0][1] + b.e[1] * AbsR[0][0];\n    if (Math.abs(t[2] * R[1][2] - t[1] * R[2][2]) > ra + rb) return false; // test axis L = A1 x B0\n\n    ra = a.e[0] * AbsR[2][0] + a.e[2] * AbsR[0][0];\n    rb = b.e[1] * AbsR[1][2] + b.e[2] * AbsR[1][1];\n    if (Math.abs(t[0] * R[2][0] - t[2] * R[0][0]) > ra + rb) return false; // test axis L = A1 x B1\n\n    ra = a.e[0] * AbsR[2][1] + a.e[2] * AbsR[0][1];\n    rb = b.e[0] * AbsR[1][2] + b.e[2] * AbsR[1][0];\n    if (Math.abs(t[0] * R[2][1] - t[2] * R[0][1]) > ra + rb) return false; // test axis L = A1 x B2\n\n    ra = a.e[0] * AbsR[2][2] + a.e[2] * AbsR[0][2];\n    rb = b.e[0] * AbsR[1][1] + b.e[1] * AbsR[1][0];\n    if (Math.abs(t[0] * R[2][2] - t[2] * R[0][2]) > ra + rb) return false; // test axis L = A2 x B0\n\n    ra = a.e[0] * AbsR[1][0] + a.e[1] * AbsR[0][0];\n    rb = b.e[1] * AbsR[2][2] + b.e[2] * AbsR[2][1];\n    if (Math.abs(t[1] * R[0][0] - t[0] * R[1][0]) > ra + rb) return false; // test axis L = A2 x B1\n\n    ra = a.e[0] * AbsR[1][1] + a.e[1] * AbsR[0][1];\n    rb = b.e[0] * AbsR[2][2] + b.e[2] * AbsR[2][0];\n    if (Math.abs(t[1] * R[0][1] - t[0] * R[1][1]) > ra + rb) return false; // test axis L = A2 x B2\n\n    ra = a.e[0] * AbsR[1][2] + a.e[1] * AbsR[0][2];\n    rb = b.e[0] * AbsR[2][1] + b.e[1] * AbsR[2][0];\n    if (Math.abs(t[1] * R[0][2] - t[0] * R[1][2]) > ra + rb) return false; // since no separating axis is found, the OBBs must be intersecting\n\n    return true;\n  },\n\n  /**\n   * Reference: Testing Box Against Plane in Real-Time Collision Detection\n   * by Christer Ericson (chapter 5.2.3)\n   */\n  intersectsPlane: function (plane) {\n    this.rotation.extractBasis(xAxis, yAxis, zAxis); // compute the projection interval radius of this OBB onto L(t) = this->center + t * p.normal;\n\n    const r = this.halfSize.x * Math.abs(plane.normal.dot(xAxis)) + this.halfSize.y * Math.abs(plane.normal.dot(yAxis)) + this.halfSize.z * Math.abs(plane.normal.dot(zAxis)); // compute distance of the OBB's center from the plane\n\n    const d = plane.normal.dot(this.center) - plane.constant; // Intersection occurs when distance d falls within [-r,+r] interval\n\n    return Math.abs(d) <= r;\n  },\n\n  /**\n   * Performs a ray/OBB intersection test and stores the intersection point\n   * to the given 3D vector. If no intersection is detected, *null* is returned.\n   */\n  intersectRay: function (ray, result) {\n    // the idea is to perform the intersection test in the local space\n    // of the OBB.\n    this.getSize(size);\n    aabb.setFromCenterAndSize(v1.set(0, 0, 0), size); // create a 4x4 transformation matrix\n\n    matrix4FromRotationMatrix(matrix, this.rotation);\n    matrix.setPosition(this.center); // transform ray to the local space of the OBB\n\n    inverse.copy(matrix).invert();\n    localRay.copy(ray).applyMatrix4(inverse); // perform ray <-> AABB intersection test\n\n    if (localRay.intersectBox(aabb, result)) {\n      // transform the intersection point back to world space\n      return result.applyMatrix4(matrix);\n    } else {\n      return null;\n    }\n  },\n\n  /**\n   * Performs a ray/OBB intersection test. Returns either true or false if\n   * there is a intersection or not.\n   */\n  intersectsRay: function (ray) {\n    return this.intersectRay(ray, v1) !== null;\n  },\n  fromBox3: function (box3) {\n    box3.getCenter(this.center);\n    box3.getSize(this.halfSize).multiplyScalar(0.5);\n    this.rotation.identity();\n    return this;\n  },\n  equals: function (obb) {\n    return obb.center.equals(this.center) && obb.halfSize.equals(this.halfSize) && obb.rotation.equals(this.rotation);\n  },\n  applyMatrix4: function (matrix) {\n    var e = matrix.elements;\n    var sx = v1.set(e[0], e[1], e[2]).length();\n    var sy = v1.set(e[4], e[5], e[6]).length();\n    var sz = v1.set(e[8], e[9], e[10]).length();\n    var det = matrix.determinant();\n    if (det < 0) sx = -sx;\n    rotationMatrix.setFromMatrix4(matrix);\n    var invSX = 1 / sx;\n    var invSY = 1 / sy;\n    var invSZ = 1 / sz;\n    rotationMatrix.elements[0] *= invSX;\n    rotationMatrix.elements[1] *= invSX;\n    rotationMatrix.elements[2] *= invSX;\n    rotationMatrix.elements[3] *= invSY;\n    rotationMatrix.elements[4] *= invSY;\n    rotationMatrix.elements[5] *= invSY;\n    rotationMatrix.elements[6] *= invSZ;\n    rotationMatrix.elements[7] *= invSZ;\n    rotationMatrix.elements[8] *= invSZ;\n    this.rotation.multiply(rotationMatrix);\n    this.halfSize.x *= sx;\n    this.halfSize.y *= sy;\n    this.halfSize.z *= sz;\n    v1.setFromMatrixPosition(matrix);\n    this.center.add(v1);\n    return this;\n  }\n});\n\nfunction matrix4FromRotationMatrix(matrix4, matrix3) {\n  var e = matrix4.elements;\n  var me = matrix3.elements;\n  e[0] = me[0];\n  e[1] = me[1];\n  e[2] = me[2];\n  e[3] = 0;\n  e[4] = me[3];\n  e[5] = me[4];\n  e[6] = me[5];\n  e[7] = 0;\n  e[8] = me[6];\n  e[9] = me[7];\n  e[10] = me[8];\n  e[11] = 0;\n  e[12] = 0;\n  e[13] = 0;\n  e[14] = 0;\n  e[15] = 1;\n}\n\nvar obb = new OBB();\n\nexport { OBB };\n"]},"metadata":{},"sourceType":"module"}