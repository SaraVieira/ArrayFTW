{"ast":null,"code":"import { Object3D, Vector3, Matrix4 } from 'three';\n\nvar CSS2DObject = function CSS2DObject(element) {\n  Object3D.call(this);\n  this.element = element || document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.addEventListener('removed', function () {\n    this.traverse(function (object) {\n      if (object.element instanceof Element && object.element.parentNode !== null) {\n        object.element.parentNode.removeChild(object.element);\n      }\n    });\n  });\n};\n\nCSS2DObject.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: CSS2DObject,\n  copy: function copy(source, recursive) {\n    Object3D.prototype.copy.call(this, source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n}); //\n\nvar CSS2DRenderer = function CSS2DRenderer() {\n  var _this = this;\n\n  var _width, _height;\n\n  var _widthHalf, _heightHalf;\n\n  var vector = new Vector3();\n  var viewMatrix = new Matrix4();\n  var viewProjectionMatrix = new Matrix4();\n  var cache = {\n    objects: new WeakMap()\n  };\n  var domElement = document.createElement('div');\n  domElement.style.overflow = 'hidden';\n  this.domElement = domElement;\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height) {\n    _width = width;\n    _height = height;\n    _widthHalf = _width / 2;\n    _heightHalf = _height / 2;\n    domElement.style.width = width + 'px';\n    domElement.style.height = height + 'px';\n  };\n\n  var renderObject = function renderObject(object, scene, camera) {\n    if (object instanceof CSS2DObject) {\n      object.onBeforeRender(_this, scene, camera);\n      vector.setFromMatrixPosition(object.matrixWorld);\n      vector.applyMatrix4(viewProjectionMatrix);\n      var element = object.element;\n      element.style.transform = 'translate(-50%,-50%) translate(' + (vector.x * _widthHalf + _widthHalf) + 'px,' + (-vector.y * _heightHalf + _heightHalf) + 'px)';\n      element.style.display = object.visible && vector.z >= -1 && vector.z <= 1 ? '' : 'none';\n      var objectData = {\n        distanceToCameraSquared: getDistanceToSquared(camera, object)\n      };\n      cache.objects.set(object, objectData);\n\n      if (element.parentNode !== domElement) {\n        domElement.appendChild(element);\n      }\n\n      object.onAfterRender(_this, scene, camera);\n    }\n\n    for (var i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera);\n    }\n  };\n\n  var getDistanceToSquared = function () {\n    var a = new Vector3();\n    var b = new Vector3();\n    return function (object1, object2) {\n      a.setFromMatrixPosition(object1.matrixWorld);\n      b.setFromMatrixPosition(object2.matrixWorld);\n      return a.distanceToSquared(b);\n    };\n  }();\n\n  var filterAndFlatten = function filterAndFlatten(scene) {\n    var result = [];\n    scene.traverse(function (object) {\n      if (object instanceof CSS2DObject) result.push(object);\n    });\n    return result;\n  };\n\n  var zOrder = function zOrder(scene) {\n    var sorted = filterAndFlatten(scene).sort(function (a, b) {\n      var distanceA = cache.objects.get(a).distanceToCameraSquared;\n      var distanceB = cache.objects.get(b).distanceToCameraSquared;\n      return distanceA - distanceB;\n    });\n    var zMax = sorted.length;\n\n    for (var i = 0, l = sorted.length; i < l; i++) {\n      sorted[i].element.style.zIndex = zMax - i;\n    }\n  };\n\n  this.render = function (scene, camera) {\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n    viewMatrix.copy(camera.matrixWorldInverse);\n    viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix, viewMatrix);\n    renderObject(scene, scene, camera);\n    zOrder(scene);\n  };\n};\n\nexport { CSS2DObject, CSS2DRenderer };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/renderers/CSS2DRenderer.js"],"names":["Object3D","Vector3","Matrix4","CSS2DObject","element","call","document","createElement","style","position","addEventListener","traverse","object","Element","parentNode","removeChild","prototype","Object","assign","create","constructor","copy","source","recursive","cloneNode","CSS2DRenderer","_this","_width","_height","_widthHalf","_heightHalf","vector","viewMatrix","viewProjectionMatrix","cache","objects","WeakMap","domElement","overflow","getSize","width","height","setSize","renderObject","scene","camera","onBeforeRender","setFromMatrixPosition","matrixWorld","applyMatrix4","transform","x","y","display","visible","z","objectData","distanceToCameraSquared","getDistanceToSquared","set","appendChild","onAfterRender","i","l","children","length","a","b","object1","object2","distanceToSquared","filterAndFlatten","result","push","zOrder","sorted","sort","distanceA","get","distanceB","zMax","zIndex","render","autoUpdate","updateMatrixWorld","parent","matrixWorldInverse","multiplyMatrices","projectionMatrix"],"mappings":"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","sourcesContent":["import { Object3D, Vector3, Matrix4 } from 'three';\n\nvar CSS2DObject = function (element) {\n  Object3D.call(this);\n  this.element = element || document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.addEventListener('removed', function () {\n    this.traverse(function (object) {\n      if (object.element instanceof Element && object.element.parentNode !== null) {\n        object.element.parentNode.removeChild(object.element);\n      }\n    });\n  });\n};\n\nCSS2DObject.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: CSS2DObject,\n  copy: function (source, recursive) {\n    Object3D.prototype.copy.call(this, source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n}); //\n\nvar CSS2DRenderer = function () {\n  var _this = this;\n\n  var _width, _height;\n\n  var _widthHalf, _heightHalf;\n\n  var vector = new Vector3();\n  var viewMatrix = new Matrix4();\n  var viewProjectionMatrix = new Matrix4();\n  var cache = {\n    objects: new WeakMap()\n  };\n  var domElement = document.createElement('div');\n  domElement.style.overflow = 'hidden';\n  this.domElement = domElement;\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height) {\n    _width = width;\n    _height = height;\n    _widthHalf = _width / 2;\n    _heightHalf = _height / 2;\n    domElement.style.width = width + 'px';\n    domElement.style.height = height + 'px';\n  };\n\n  var renderObject = function (object, scene, camera) {\n    if (object instanceof CSS2DObject) {\n      object.onBeforeRender(_this, scene, camera);\n      vector.setFromMatrixPosition(object.matrixWorld);\n      vector.applyMatrix4(viewProjectionMatrix);\n      var element = object.element;\n      element.style.transform = 'translate(-50%,-50%) translate(' + (vector.x * _widthHalf + _widthHalf) + 'px,' + (-vector.y * _heightHalf + _heightHalf) + 'px)';\n      element.style.display = object.visible && vector.z >= -1 && vector.z <= 1 ? '' : 'none';\n      var objectData = {\n        distanceToCameraSquared: getDistanceToSquared(camera, object)\n      };\n      cache.objects.set(object, objectData);\n\n      if (element.parentNode !== domElement) {\n        domElement.appendChild(element);\n      }\n\n      object.onAfterRender(_this, scene, camera);\n    }\n\n    for (let i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera);\n    }\n  };\n\n  var getDistanceToSquared = function () {\n    var a = new Vector3();\n    var b = new Vector3();\n    return function (object1, object2) {\n      a.setFromMatrixPosition(object1.matrixWorld);\n      b.setFromMatrixPosition(object2.matrixWorld);\n      return a.distanceToSquared(b);\n    };\n  }();\n\n  var filterAndFlatten = function (scene) {\n    var result = [];\n    scene.traverse(function (object) {\n      if (object instanceof CSS2DObject) result.push(object);\n    });\n    return result;\n  };\n\n  var zOrder = function (scene) {\n    var sorted = filterAndFlatten(scene).sort(function (a, b) {\n      var distanceA = cache.objects.get(a).distanceToCameraSquared;\n      var distanceB = cache.objects.get(b).distanceToCameraSquared;\n      return distanceA - distanceB;\n    });\n    var zMax = sorted.length;\n\n    for (let i = 0, l = sorted.length; i < l; i++) {\n      sorted[i].element.style.zIndex = zMax - i;\n    }\n  };\n\n  this.render = function (scene, camera) {\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n    viewMatrix.copy(camera.matrixWorldInverse);\n    viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix, viewMatrix);\n    renderObject(scene, scene, camera);\n    zOrder(scene);\n  };\n};\n\nexport { CSS2DObject, CSS2DRenderer };\n"]},"metadata":{},"sourceType":"module"}