{"ast":null,"code":"import { MathUtils } from 'three';\nimport { Node } from './Node.js';\n\nfunction TempNode(type, params) {\n  Node.call(this, type);\n  params = params || {};\n  this.shared = params.shared !== undefined ? params.shared : true;\n  this.unique = params.unique !== undefined ? params.unique : false;\n}\n\nTempNode.prototype = Object.create(Node.prototype);\nTempNode.prototype.constructor = TempNode;\n\nTempNode.prototype.build = function (builder, output, uuid, ns) {\n  output = output || this.getType(builder);\n\n  if (this.getShared(builder, output)) {\n    var isUnique = this.getUnique(builder, output);\n\n    if (isUnique && this.constructor.uuid === undefined) {\n      this.constructor.uuid = MathUtils.generateUUID();\n    }\n\n    uuid = builder.getUuid(uuid || this.getUuid(), !isUnique);\n    var data = builder.getNodeData(uuid),\n        type = data.output || this.getType(builder);\n\n    if (builder.analyzing) {\n      if ((data.deps || 0) > 0 || this.getLabel()) {\n        this.appendDepsNode(builder, data, output);\n        return this.generate(builder, output, uuid);\n      }\n\n      return Node.prototype.build.call(this, builder, output, uuid);\n    } else if (isUnique) {\n      data.name = data.name || Node.prototype.build.call(this, builder, output, uuid);\n      return data.name;\n    } else if (!this.getLabel() && (!this.getShared(builder, type) || builder.context.ignoreCache || data.deps === 1)) {\n      return Node.prototype.build.call(this, builder, output, uuid);\n    }\n\n    uuid = this.getUuid(false);\n    var name = this.getTemp(builder, uuid);\n\n    if (name) {\n      return builder.format(name, type, output);\n    } else {\n      name = TempNode.prototype.generate.call(this, builder, output, uuid, data.output, ns);\n      var code = this.generate(builder, type, uuid);\n      builder.addNodeCode(name + ' = ' + code + ';');\n      return builder.format(name, type, output);\n    }\n  }\n\n  return Node.prototype.build.call(this, builder, output, uuid);\n};\n\nTempNode.prototype.getShared = function (builder, output) {\n  return output !== 'sampler2D' && output !== 'samplerCube' && this.shared;\n};\n\nTempNode.prototype.getUnique = function ()\n/* builder, output */\n{\n  return this.unique;\n};\n\nTempNode.prototype.setLabel = function (name) {\n  this.label = name;\n  return this;\n};\n\nTempNode.prototype.getLabel = function ()\n/* builder */\n{\n  return this.label;\n};\n\nTempNode.prototype.getUuid = function (unique) {\n  var uuid = unique || unique == undefined ? this.constructor.uuid || this.uuid : this.uuid;\n  if (typeof this.scope === 'string') uuid = this.scope + '-' + uuid;\n  return uuid;\n};\n\nTempNode.prototype.getTemp = function (builder, uuid) {\n  uuid = uuid || this.uuid;\n  var tempVar = builder.getVars()[uuid];\n  return tempVar ? tempVar.name : undefined;\n};\n\nTempNode.prototype.generate = function (builder, output, uuid, type, ns) {\n  if (!this.getShared(builder, output)) console.error('THREE.TempNode is not shared!');\n  uuid = uuid || this.uuid;\n  return builder.getTempVar(uuid, type || this.getType(builder), ns, this.getLabel()).name;\n};\n\nexport { TempNode };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/nodes/core/TempNode.js"],"names":["MathUtils","Node","TempNode","type","params","call","shared","undefined","unique","prototype","Object","create","constructor","build","builder","output","uuid","ns","getType","getShared","isUnique","getUnique","generateUUID","getUuid","data","getNodeData","analyzing","deps","getLabel","appendDepsNode","generate","name","context","ignoreCache","getTemp","format","code","addNodeCode","setLabel","label","scope","tempVar","getVars","console","error","getTempVar"],"mappings":"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","sourcesContent":["import { MathUtils } from 'three';\nimport { Node } from './Node.js';\n\nfunction TempNode(type, params) {\n  Node.call(this, type);\n  params = params || {};\n  this.shared = params.shared !== undefined ? params.shared : true;\n  this.unique = params.unique !== undefined ? params.unique : false;\n}\n\nTempNode.prototype = Object.create(Node.prototype);\nTempNode.prototype.constructor = TempNode;\n\nTempNode.prototype.build = function (builder, output, uuid, ns) {\n  output = output || this.getType(builder);\n\n  if (this.getShared(builder, output)) {\n    var isUnique = this.getUnique(builder, output);\n\n    if (isUnique && this.constructor.uuid === undefined) {\n      this.constructor.uuid = MathUtils.generateUUID();\n    }\n\n    uuid = builder.getUuid(uuid || this.getUuid(), !isUnique);\n    var data = builder.getNodeData(uuid),\n        type = data.output || this.getType(builder);\n\n    if (builder.analyzing) {\n      if ((data.deps || 0) > 0 || this.getLabel()) {\n        this.appendDepsNode(builder, data, output);\n        return this.generate(builder, output, uuid);\n      }\n\n      return Node.prototype.build.call(this, builder, output, uuid);\n    } else if (isUnique) {\n      data.name = data.name || Node.prototype.build.call(this, builder, output, uuid);\n      return data.name;\n    } else if (!this.getLabel() && (!this.getShared(builder, type) || builder.context.ignoreCache || data.deps === 1)) {\n      return Node.prototype.build.call(this, builder, output, uuid);\n    }\n\n    uuid = this.getUuid(false);\n    var name = this.getTemp(builder, uuid);\n\n    if (name) {\n      return builder.format(name, type, output);\n    } else {\n      name = TempNode.prototype.generate.call(this, builder, output, uuid, data.output, ns);\n      var code = this.generate(builder, type, uuid);\n      builder.addNodeCode(name + ' = ' + code + ';');\n      return builder.format(name, type, output);\n    }\n  }\n\n  return Node.prototype.build.call(this, builder, output, uuid);\n};\n\nTempNode.prototype.getShared = function (builder, output) {\n  return output !== 'sampler2D' && output !== 'samplerCube' && this.shared;\n};\n\nTempNode.prototype.getUnique = function ()\n/* builder, output */\n{\n  return this.unique;\n};\n\nTempNode.prototype.setLabel = function (name) {\n  this.label = name;\n  return this;\n};\n\nTempNode.prototype.getLabel = function ()\n/* builder */\n{\n  return this.label;\n};\n\nTempNode.prototype.getUuid = function (unique) {\n  var uuid = unique || unique == undefined ? this.constructor.uuid || this.uuid : this.uuid;\n  if (typeof this.scope === 'string') uuid = this.scope + '-' + uuid;\n  return uuid;\n};\n\nTempNode.prototype.getTemp = function (builder, uuid) {\n  uuid = uuid || this.uuid;\n  var tempVar = builder.getVars()[uuid];\n  return tempVar ? tempVar.name : undefined;\n};\n\nTempNode.prototype.generate = function (builder, output, uuid, type, ns) {\n  if (!this.getShared(builder, output)) console.error('THREE.TempNode is not shared!');\n  uuid = uuid || this.uuid;\n  return builder.getTempVar(uuid, type || this.getType(builder), ns, this.getLabel()).name;\n};\n\nexport { TempNode };\n"]},"metadata":{},"sourceType":"module"}