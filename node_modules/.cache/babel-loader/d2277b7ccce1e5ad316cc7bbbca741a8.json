{"ast":null,"code":"import { Matrix3, OrthographicCamera, Scene, StereoCamera, WebGLRenderTarget, ShaderMaterial, Mesh, PlaneGeometry, LinearFilter, NearestFilter, RGBAFormat } from 'three';\n\nvar AnaglyphEffect = function AnaglyphEffect(renderer, width, height) {\n  // Dubois matrices from https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.7.6968&rep=rep1&type=pdf#page=4\n  this.colorMatrixLeft = new Matrix3().fromArray([0.4561, -0.0400822, -0.0152161, 0.500484, -0.0378246, -0.0205971, 0.176381, -0.0157589, -0.00546856]);\n  this.colorMatrixRight = new Matrix3().fromArray([-0.0434706, 0.378476, -0.0721527, -0.0879388, 0.73364, -0.112961, -0.00155529, -0.0184503, 1.2264]);\n\n  var _camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1);\n\n  var _scene = new Scene();\n\n  var _stereo = new StereoCamera();\n\n  var _params = {\n    minFilter: LinearFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  };\n  if (width === undefined) width = 512;\n  if (height === undefined) height = 512;\n\n  var _renderTargetL = new WebGLRenderTarget(width, height, _params);\n\n  var _renderTargetR = new WebGLRenderTarget(width, height, _params);\n\n  var _material = new ShaderMaterial({\n    uniforms: {\n      mapLeft: {\n        value: _renderTargetL.texture\n      },\n      mapRight: {\n        value: _renderTargetR.texture\n      },\n      colorMatrixLeft: {\n        value: this.colorMatrixLeft\n      },\n      colorMatrixRight: {\n        value: this.colorMatrixRight\n      }\n    },\n    vertexShader: ['varying vec2 vUv;', 'void main() {', '\tvUv = vec2( uv.x, uv.y );', '\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );', '}'].join('\\n'),\n    fragmentShader: ['uniform sampler2D mapLeft;', 'uniform sampler2D mapRight;', 'varying vec2 vUv;', 'uniform mat3 colorMatrixLeft;', 'uniform mat3 colorMatrixRight;', // These functions implement sRGB linearization and gamma correction\n    'float lin( float c ) {', '\treturn c <= 0.04045 ? c * 0.0773993808 :', '\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );', '}', 'vec4 lin( vec4 c ) {', '\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );', '}', 'float dev( float c ) {', '\treturn c <= 0.0031308 ? c * 12.92', '\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;', '}', 'void main() {', '\tvec2 uv = vUv;', '\tvec4 colorL = lin( texture2D( mapLeft, uv ) );', '\tvec4 colorR = lin( texture2D( mapRight, uv ) );', '\tvec3 color = clamp(', '\t\t\tcolorMatrixLeft * colorL.rgb +', '\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );', '\tgl_FragColor = vec4(', '\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),', '\t\t\tmax( colorL.a, colorR.a ) );', '}'].join('\\n')\n  });\n\n  var _mesh = new Mesh(new PlaneGeometry(2, 2), _material);\n\n  _scene.add(_mesh);\n\n  this.setSize = function (width, height) {\n    renderer.setSize(width, height);\n    var pixelRatio = renderer.getPixelRatio();\n\n    _renderTargetL.setSize(width * pixelRatio, height * pixelRatio);\n\n    _renderTargetR.setSize(width * pixelRatio, height * pixelRatio);\n  };\n\n  this.render = function (scene, camera) {\n    var currentRenderTarget = renderer.getRenderTarget();\n    scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    _stereo.update(camera);\n\n    renderer.setRenderTarget(_renderTargetL);\n    renderer.clear();\n    renderer.render(scene, _stereo.cameraL);\n    renderer.setRenderTarget(_renderTargetR);\n    renderer.clear();\n    renderer.render(scene, _stereo.cameraR);\n    renderer.setRenderTarget(null);\n    renderer.render(_scene, _camera);\n    renderer.setRenderTarget(currentRenderTarget);\n  };\n\n  this.dispose = function () {\n    if (_renderTargetL) _renderTargetL.dispose();\n    if (_renderTargetR) _renderTargetR.dispose();\n    if (_mesh) _mesh.geometry.dispose();\n    if (_material) _material.dispose();\n  };\n};\n\nexport { AnaglyphEffect };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/effects/AnaglyphEffect.js"],"names":["Matrix3","OrthographicCamera","Scene","StereoCamera","WebGLRenderTarget","ShaderMaterial","Mesh","PlaneGeometry","LinearFilter","NearestFilter","RGBAFormat","AnaglyphEffect","renderer","width","height","colorMatrixLeft","fromArray","colorMatrixRight","_camera","_scene","_stereo","_params","minFilter","magFilter","format","undefined","_renderTargetL","_renderTargetR","_material","uniforms","mapLeft","value","texture","mapRight","vertexShader","join","fragmentShader","_mesh","add","setSize","pixelRatio","getPixelRatio","render","scene","camera","currentRenderTarget","getRenderTarget","updateMatrixWorld","parent","update","setRenderTarget","clear","cameraL","cameraR","dispose","geometry"],"mappings":"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","sourcesContent":["import { Matrix3, OrthographicCamera, Scene, StereoCamera, WebGLRenderTarget, ShaderMaterial, Mesh, PlaneGeometry, LinearFilter, NearestFilter, RGBAFormat } from 'three';\n\nconst AnaglyphEffect = function (renderer, width, height) {\n  // Dubois matrices from https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.7.6968&rep=rep1&type=pdf#page=4\n  this.colorMatrixLeft = new Matrix3().fromArray([0.4561, -0.0400822, -0.0152161, 0.500484, -0.0378246, -0.0205971, 0.176381, -0.0157589, -0.00546856]);\n  this.colorMatrixRight = new Matrix3().fromArray([-0.0434706, 0.378476, -0.0721527, -0.0879388, 0.73364, -0.112961, -0.00155529, -0.0184503, 1.2264]);\n\n  const _camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1);\n\n  const _scene = new Scene();\n\n  const _stereo = new StereoCamera();\n\n  const _params = {\n    minFilter: LinearFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  };\n  if (width === undefined) width = 512;\n  if (height === undefined) height = 512;\n\n  const _renderTargetL = new WebGLRenderTarget(width, height, _params);\n\n  const _renderTargetR = new WebGLRenderTarget(width, height, _params);\n\n  const _material = new ShaderMaterial({\n    uniforms: {\n      mapLeft: {\n        value: _renderTargetL.texture\n      },\n      mapRight: {\n        value: _renderTargetR.texture\n      },\n      colorMatrixLeft: {\n        value: this.colorMatrixLeft\n      },\n      colorMatrixRight: {\n        value: this.colorMatrixRight\n      }\n    },\n    vertexShader: ['varying vec2 vUv;', 'void main() {', '\tvUv = vec2( uv.x, uv.y );', '\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );', '}'].join('\\n'),\n    fragmentShader: ['uniform sampler2D mapLeft;', 'uniform sampler2D mapRight;', 'varying vec2 vUv;', 'uniform mat3 colorMatrixLeft;', 'uniform mat3 colorMatrixRight;', // These functions implement sRGB linearization and gamma correction\n    'float lin( float c ) {', '\treturn c <= 0.04045 ? c * 0.0773993808 :', '\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );', '}', 'vec4 lin( vec4 c ) {', '\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );', '}', 'float dev( float c ) {', '\treturn c <= 0.0031308 ? c * 12.92', '\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;', '}', 'void main() {', '\tvec2 uv = vUv;', '\tvec4 colorL = lin( texture2D( mapLeft, uv ) );', '\tvec4 colorR = lin( texture2D( mapRight, uv ) );', '\tvec3 color = clamp(', '\t\t\tcolorMatrixLeft * colorL.rgb +', '\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );', '\tgl_FragColor = vec4(', '\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),', '\t\t\tmax( colorL.a, colorR.a ) );', '}'].join('\\n')\n  });\n\n  const _mesh = new Mesh(new PlaneGeometry(2, 2), _material);\n\n  _scene.add(_mesh);\n\n  this.setSize = (width, height) => {\n    renderer.setSize(width, height);\n    const pixelRatio = renderer.getPixelRatio();\n\n    _renderTargetL.setSize(width * pixelRatio, height * pixelRatio);\n\n    _renderTargetR.setSize(width * pixelRatio, height * pixelRatio);\n  };\n\n  this.render = (scene, camera) => {\n    const currentRenderTarget = renderer.getRenderTarget();\n    scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    _stereo.update(camera);\n\n    renderer.setRenderTarget(_renderTargetL);\n    renderer.clear();\n    renderer.render(scene, _stereo.cameraL);\n    renderer.setRenderTarget(_renderTargetR);\n    renderer.clear();\n    renderer.render(scene, _stereo.cameraR);\n    renderer.setRenderTarget(null);\n    renderer.render(_scene, _camera);\n    renderer.setRenderTarget(currentRenderTarget);\n  };\n\n  this.dispose = () => {\n    if (_renderTargetL) _renderTargetL.dispose();\n    if (_renderTargetR) _renderTargetR.dispose();\n    if (_mesh) _mesh.geometry.dispose();\n    if (_material) _material.dispose();\n  };\n};\n\nexport { AnaglyphEffect };\n"]},"metadata":{},"sourceType":"module"}