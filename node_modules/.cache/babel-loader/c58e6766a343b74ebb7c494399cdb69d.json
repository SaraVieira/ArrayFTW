{"ast":null,"code":"import { Loader, FileLoader, NumberKeyframeTrack, AnimationClip, BufferAttribute } from 'three';\n/**\n * MDD is a special format that stores a position for every vertex in a model for every frame in an animation.\n * Similar to BVH, it can be used to transfer animation data between different 3D applications or engines.\n *\n * MDD stores its data in binary format (big endian) in the following way:\n *\n * number of frames (a single uint32)\n * number of vertices (a single uint32)\n * time values for each frame (sequence of float32)\n * vertex data for each frame (sequence of float32)\n */\n\nvar MDDLoader = function MDDLoader(manager) {\n  Loader.call(this, manager);\n};\n\nMDDLoader.prototype = Object.assign(Object.create(Loader.prototype), {\n  constructor: MDDLoader,\n  load: function load(url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, function (data) {\n      onLoad(scope.parse(data));\n    }, onProgress, onError);\n  },\n  parse: function parse(data) {\n    var view = new DataView(data);\n    var totalFrames = view.getUint32(0);\n    var totalPoints = view.getUint32(4);\n    var offset = 8; // animation clip\n\n    var times = new Float32Array(totalFrames);\n    var values = new Float32Array(totalFrames * totalFrames).fill(0);\n\n    for (var i = 0; i < totalFrames; i++) {\n      times[i] = view.getFloat32(offset);\n      offset += 4;\n      values[totalFrames * i + i] = 1;\n    }\n\n    var track = new NumberKeyframeTrack('.morphTargetInfluences', times, values);\n    var clip = new AnimationClip('default', times[times.length - 1], [track]); // morph targets\n\n    var morphTargets = [];\n\n    for (var _i = 0; _i < totalFrames; _i++) {\n      var morphTarget = new Float32Array(totalPoints * 3);\n\n      for (var j = 0; j < totalPoints; j++) {\n        var stride = j * 3;\n        morphTarget[stride + 0] = view.getFloat32(offset);\n        offset += 4; // x\n\n        morphTarget[stride + 1] = view.getFloat32(offset);\n        offset += 4; // y\n\n        morphTarget[stride + 2] = view.getFloat32(offset);\n        offset += 4; // z\n      }\n\n      var attribute = new BufferAttribute(morphTarget, 3);\n      attribute.name = 'morph_' + _i;\n      morphTargets.push(attribute);\n    }\n\n    return {\n      morphTargets: morphTargets,\n      clip: clip\n    };\n  }\n});\nexport { MDDLoader };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/loaders/MDDLoader.js"],"names":["Loader","FileLoader","NumberKeyframeTrack","AnimationClip","BufferAttribute","MDDLoader","manager","call","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","data","parse","view","DataView","totalFrames","getUint32","totalPoints","offset","times","Float32Array","values","fill","i","getFloat32","track","clip","length","morphTargets","morphTarget","j","stride","attribute","name","push"],"mappings":"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","sourcesContent":["import { Loader, FileLoader, NumberKeyframeTrack, AnimationClip, BufferAttribute } from 'three';\n\n/**\n * MDD is a special format that stores a position for every vertex in a model for every frame in an animation.\n * Similar to BVH, it can be used to transfer animation data between different 3D applications or engines.\n *\n * MDD stores its data in binary format (big endian) in the following way:\n *\n * number of frames (a single uint32)\n * number of vertices (a single uint32)\n * time values for each frame (sequence of float32)\n * vertex data for each frame (sequence of float32)\n */\n\nvar MDDLoader = function (manager) {\n  Loader.call(this, manager);\n};\n\nMDDLoader.prototype = Object.assign(Object.create(Loader.prototype), {\n  constructor: MDDLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, function (data) {\n      onLoad(scope.parse(data));\n    }, onProgress, onError);\n  },\n  parse: function (data) {\n    var view = new DataView(data);\n    var totalFrames = view.getUint32(0);\n    var totalPoints = view.getUint32(4);\n    var offset = 8; // animation clip\n\n    var times = new Float32Array(totalFrames);\n    var values = new Float32Array(totalFrames * totalFrames).fill(0);\n\n    for (let i = 0; i < totalFrames; i++) {\n      times[i] = view.getFloat32(offset);\n      offset += 4;\n      values[totalFrames * i + i] = 1;\n    }\n\n    var track = new NumberKeyframeTrack('.morphTargetInfluences', times, values);\n    var clip = new AnimationClip('default', times[times.length - 1], [track]); // morph targets\n\n    var morphTargets = [];\n\n    for (let i = 0; i < totalFrames; i++) {\n      var morphTarget = new Float32Array(totalPoints * 3);\n\n      for (let j = 0; j < totalPoints; j++) {\n        var stride = j * 3;\n        morphTarget[stride + 0] = view.getFloat32(offset);\n        offset += 4; // x\n\n        morphTarget[stride + 1] = view.getFloat32(offset);\n        offset += 4; // y\n\n        morphTarget[stride + 2] = view.getFloat32(offset);\n        offset += 4; // z\n      }\n\n      var attribute = new BufferAttribute(morphTarget, 3);\n      attribute.name = 'morph_' + i;\n      morphTargets.push(attribute);\n    }\n\n    return {\n      morphTargets: morphTargets,\n      clip: clip\n    };\n  }\n});\n\nexport { MDDLoader };\n"]},"metadata":{},"sourceType":"module"}