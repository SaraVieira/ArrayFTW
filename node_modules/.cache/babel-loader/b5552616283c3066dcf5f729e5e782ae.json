{"ast":null,"code":"import { Object3D, Matrix4 } from 'three';\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nvar CSS3DObject = function CSS3DObject(element) {\n  Object3D.call(this);\n  this.element = element || document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.element.style.pointerEvents = 'auto';\n  this.addEventListener('removed', function () {\n    this.traverse(function (object) {\n      if (object.element instanceof Element && object.element.parentNode !== null) {\n        object.element.parentNode.removeChild(object.element);\n      }\n    });\n  });\n};\n\nCSS3DObject.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: CSS3DObject,\n  copy: function copy(source, recursive) {\n    Object3D.prototype.copy.call(this, source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n});\n\nvar CSS3DSprite = function CSS3DSprite(element) {\n  CSS3DObject.call(this, element);\n};\n\nCSS3DSprite.prototype = Object.create(CSS3DObject.prototype);\nCSS3DSprite.prototype.constructor = CSS3DSprite; //\n\nvar CSS3DRenderer = function CSS3DRenderer() {\n  var _this = this;\n\n  var _width, _height;\n\n  var _widthHalf, _heightHalf;\n\n  var matrix = new Matrix4();\n  var cache = {\n    camera: {\n      fov: 0,\n      style: ''\n    },\n    objects: new WeakMap()\n  };\n  var domElement = document.createElement('div');\n  domElement.style.overflow = 'hidden';\n  this.domElement = domElement;\n  var cameraElement = document.createElement('div');\n  cameraElement.style.transformStyle = 'preserve-3d';\n  cameraElement.style.pointerEvents = 'none';\n  domElement.appendChild(cameraElement);\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height) {\n    _width = width;\n    _height = height;\n    _widthHalf = _width / 2;\n    _heightHalf = _height / 2;\n    domElement.style.width = width + 'px';\n    domElement.style.height = height + 'px';\n    cameraElement.style.width = width + 'px';\n    cameraElement.style.height = height + 'px';\n  };\n\n  function epsilon(value) {\n    return Math.abs(value) < 1e-10 ? 0 : value;\n  }\n\n  function getCameraCSSMatrix(matrix) {\n    var elements = matrix.elements;\n    return 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(-elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(elements[6]) + ',' + epsilon(elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(-elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(-elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n  }\n\n  function getObjectCSSMatrix(matrix) {\n    var elements = matrix.elements;\n    var matrix3d = 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(-elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(-elements[6]) + ',' + epsilon(-elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n    return 'translate(-50%,-50%)' + matrix3d;\n  }\n\n  function renderObject(object, scene, camera, cameraCSSMatrix) {\n    if (object instanceof CSS3DObject) {\n      object.onBeforeRender(_this, scene, camera);\n      var style;\n\n      if (object instanceof CSS3DSprite) {\n        // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n        matrix.copy(camera.matrixWorldInverse);\n        matrix.transpose();\n        matrix.copyPosition(object.matrixWorld);\n        matrix.scale(object.scale);\n        matrix.elements[3] = 0;\n        matrix.elements[7] = 0;\n        matrix.elements[11] = 0;\n        matrix.elements[15] = 1;\n        style = getObjectCSSMatrix(matrix);\n      } else {\n        style = getObjectCSSMatrix(object.matrixWorld);\n      }\n\n      var element = object.element;\n      var cachedObject = cache.objects.get(object);\n\n      if (cachedObject === undefined || cachedObject.style !== style) {\n        element.style.transform = style;\n        var objectData = {\n          style: style\n        };\n        cache.objects.set(object, objectData);\n      }\n\n      element.style.display = object.visible ? '' : 'none';\n\n      if (element.parentNode !== cameraElement) {\n        cameraElement.appendChild(element);\n      }\n\n      object.onAfterRender(_this, scene, camera);\n    }\n\n    for (var i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera);\n    }\n  }\n\n  this.render = function (scene, camera) {\n    var fov = camera.projectionMatrix.elements[5] * _heightHalf;\n\n    if (cache.camera.fov !== fov) {\n      domElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\n      cache.camera.fov = fov;\n    }\n\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    if (camera.isOrthographicCamera) {\n      var tx = -(camera.right + camera.left) / 2;\n      var ty = (camera.top + camera.bottom) / 2;\n    }\n\n    var cameraCSSMatrix = camera.isOrthographicCamera ? 'scale(' + fov + ')' + 'translate(' + epsilon(tx) + 'px,' + epsilon(ty) + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse) : 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse);\n    var style = cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n    if (cache.camera.style !== style) {\n      cameraElement.style.transform = style;\n      cache.camera.style = style;\n    }\n\n    renderObject(scene, scene, camera);\n  };\n};\n\nexport { CSS3DObject, CSS3DRenderer, CSS3DSprite };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/renderers/CSS3DRenderer.js"],"names":["Object3D","Matrix4","CSS3DObject","element","call","document","createElement","style","position","pointerEvents","addEventListener","traverse","object","Element","parentNode","removeChild","prototype","Object","assign","create","constructor","copy","source","recursive","cloneNode","CSS3DSprite","CSS3DRenderer","_this","_width","_height","_widthHalf","_heightHalf","matrix","cache","camera","fov","objects","WeakMap","domElement","overflow","cameraElement","transformStyle","appendChild","getSize","width","height","setSize","epsilon","value","Math","abs","getCameraCSSMatrix","elements","getObjectCSSMatrix","matrix3d","renderObject","scene","cameraCSSMatrix","onBeforeRender","matrixWorldInverse","transpose","copyPosition","matrixWorld","scale","cachedObject","get","undefined","transform","objectData","set","display","visible","onAfterRender","i","l","children","length","render","projectionMatrix","perspective","isPerspectiveCamera","autoUpdate","updateMatrixWorld","parent","isOrthographicCamera","tx","right","left","ty","top","bottom"],"mappings":"AAAA,SAASA,QAAT,EAAmBC,OAAnB,QAAkC,OAAlC;AAEA;AACA;AACA;;AAEA,IAAIC,WAAW,GAAG,SAAdA,WAAc,CAAUC,OAAV,EAAmB;AACnCH,EAAAA,QAAQ,CAACI,IAAT,CAAc,IAAd;AACA,OAAKD,OAAL,GAAeA,OAAO,IAAIE,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA1B;AACA,OAAKH,OAAL,CAAaI,KAAb,CAAmBC,QAAnB,GAA8B,UAA9B;AACA,OAAKL,OAAL,CAAaI,KAAb,CAAmBE,aAAnB,GAAmC,MAAnC;AACA,OAAKC,gBAAL,CAAsB,SAAtB,EAAiC,YAAY;AAC3C,SAAKC,QAAL,CAAc,UAAUC,MAAV,EAAkB;AAC9B,UAAIA,MAAM,CAACT,OAAP,YAA0BU,OAA1B,IAAqCD,MAAM,CAACT,OAAP,CAAeW,UAAf,KAA8B,IAAvE,EAA6E;AAC3EF,QAAAA,MAAM,CAACT,OAAP,CAAeW,UAAf,CAA0BC,WAA1B,CAAsCH,MAAM,CAACT,OAA7C;AACD;AACF,KAJD;AAKD,GAND;AAOD,CAZD;;AAcAD,WAAW,CAACc,SAAZ,GAAwBC,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACE,MAAP,CAAcnB,QAAQ,CAACgB,SAAvB,CAAd,EAAiD;AACvEI,EAAAA,WAAW,EAAElB,WAD0D;AAEvEmB,EAAAA,IAAI,EAAE,cAAUC,MAAV,EAAkBC,SAAlB,EAA6B;AACjCvB,IAAAA,QAAQ,CAACgB,SAAT,CAAmBK,IAAnB,CAAwBjB,IAAxB,CAA6B,IAA7B,EAAmCkB,MAAnC,EAA2CC,SAA3C;AACA,SAAKpB,OAAL,GAAemB,MAAM,CAACnB,OAAP,CAAeqB,SAAf,CAAyB,IAAzB,CAAf;AACA,WAAO,IAAP;AACD;AANsE,CAAjD,CAAxB;;AASA,IAAIC,WAAW,GAAG,SAAdA,WAAc,CAAUtB,OAAV,EAAmB;AACnCD,EAAAA,WAAW,CAACE,IAAZ,CAAiB,IAAjB,EAAuBD,OAAvB;AACD,CAFD;;AAIAsB,WAAW,CAACT,SAAZ,GAAwBC,MAAM,CAACE,MAAP,CAAcjB,WAAW,CAACc,SAA1B,CAAxB;AACAS,WAAW,CAACT,SAAZ,CAAsBI,WAAtB,GAAoCK,WAApC,C,CAAiD;;AAEjD,IAAIC,aAAa,GAAG,SAAhBA,aAAgB,GAAY;AAC9B,MAAIC,KAAK,GAAG,IAAZ;;AAEA,MAAIC,MAAJ,EAAYC,OAAZ;;AAEA,MAAIC,UAAJ,EAAgBC,WAAhB;;AAEA,MAAIC,MAAM,GAAG,IAAI/B,OAAJ,EAAb;AACA,MAAIgC,KAAK,GAAG;AACVC,IAAAA,MAAM,EAAE;AACNC,MAAAA,GAAG,EAAE,CADC;AAEN5B,MAAAA,KAAK,EAAE;AAFD,KADE;AAKV6B,IAAAA,OAAO,EAAE,IAAIC,OAAJ;AALC,GAAZ;AAOA,MAAIC,UAAU,GAAGjC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;AACAgC,EAAAA,UAAU,CAAC/B,KAAX,CAAiBgC,QAAjB,GAA4B,QAA5B;AACA,OAAKD,UAAL,GAAkBA,UAAlB;AACA,MAAIE,aAAa,GAAGnC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApB;AACAkC,EAAAA,aAAa,CAACjC,KAAd,CAAoBkC,cAApB,GAAqC,aAArC;AACAD,EAAAA,aAAa,CAACjC,KAAd,CAAoBE,aAApB,GAAoC,MAApC;AACA6B,EAAAA,UAAU,CAACI,WAAX,CAAuBF,aAAvB;;AAEA,OAAKG,OAAL,GAAe,YAAY;AACzB,WAAO;AACLC,MAAAA,KAAK,EAAEhB,MADF;AAELiB,MAAAA,MAAM,EAAEhB;AAFH,KAAP;AAID,GALD;;AAOA,OAAKiB,OAAL,GAAe,UAAUF,KAAV,EAAiBC,MAAjB,EAAyB;AACtCjB,IAAAA,MAAM,GAAGgB,KAAT;AACAf,IAAAA,OAAO,GAAGgB,MAAV;AACAf,IAAAA,UAAU,GAAGF,MAAM,GAAG,CAAtB;AACAG,IAAAA,WAAW,GAAGF,OAAO,GAAG,CAAxB;AACAS,IAAAA,UAAU,CAAC/B,KAAX,CAAiBqC,KAAjB,GAAyBA,KAAK,GAAG,IAAjC;AACAN,IAAAA,UAAU,CAAC/B,KAAX,CAAiBsC,MAAjB,GAA0BA,MAAM,GAAG,IAAnC;AACAL,IAAAA,aAAa,CAACjC,KAAd,CAAoBqC,KAApB,GAA4BA,KAAK,GAAG,IAApC;AACAJ,IAAAA,aAAa,CAACjC,KAAd,CAAoBsC,MAApB,GAA6BA,MAAM,GAAG,IAAtC;AACD,GATD;;AAWA,WAASE,OAAT,CAAiBC,KAAjB,EAAwB;AACtB,WAAOC,IAAI,CAACC,GAAL,CAASF,KAAT,IAAkB,KAAlB,GAA0B,CAA1B,GAA8BA,KAArC;AACD;;AAED,WAASG,kBAAT,CAA4BnB,MAA5B,EAAoC;AAClC,QAAIoB,QAAQ,GAAGpB,MAAM,CAACoB,QAAtB;AACA,WAAO,cAAcL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAArB,GAAqC,GAArC,GAA2CL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAAlD,GAAmE,GAAnE,GAAyEL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAAhF,GAAgG,GAAhG,GAAsGL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA7G,GAA6H,GAA7H,GAAmIL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA1I,GAA0J,GAA1J,GAAgKL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAAvK,GAAwL,GAAxL,GAA8LL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAArM,GAAqN,GAArN,GAA2NL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAAlO,GAAkP,GAAlP,GAAwPL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA/P,GAA+Q,GAA/Q,GAAqRL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAA5R,GAA6S,GAA7S,GAAmTL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAA1T,GAA2U,GAA3U,GAAiVL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAxV,GAAyW,GAAzW,GAA+WL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAtX,GAAuY,GAAvY,GAA6YL,OAAO,CAAC,CAACK,QAAQ,CAAC,EAAD,CAAV,CAApZ,GAAsa,GAAta,GAA4aL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAnb,GAAoc,GAApc,GAA0cL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAjd,GAAke,GAAze;AACD;;AAED,WAASC,kBAAT,CAA4BrB,MAA5B,EAAoC;AAClC,QAAIoB,QAAQ,GAAGpB,MAAM,CAACoB,QAAtB;AACA,QAAIE,QAAQ,GAAG,cAAcP,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAArB,GAAqC,GAArC,GAA2CL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAAlD,GAAkE,GAAlE,GAAwEL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA/E,GAA+F,GAA/F,GAAqGL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA5G,GAA4H,GAA5H,GAAkIL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAAzI,GAA0J,GAA1J,GAAgKL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAAvK,GAAwL,GAAxL,GAA8LL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAArM,GAAsN,GAAtN,GAA4NL,OAAO,CAAC,CAACK,QAAQ,CAAC,CAAD,CAAV,CAAnO,GAAoP,GAApP,GAA0PL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAAjQ,GAAiR,GAAjR,GAAuRL,OAAO,CAACK,QAAQ,CAAC,CAAD,CAAT,CAA9R,GAA8S,GAA9S,GAAoTL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAA3T,GAA4U,GAA5U,GAAkVL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAzV,GAA0W,GAA1W,GAAgXL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAvX,GAAwY,GAAxY,GAA8YL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAArZ,GAAsa,GAAta,GAA4aL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAnb,GAAoc,GAApc,GAA0cL,OAAO,CAACK,QAAQ,CAAC,EAAD,CAAT,CAAjd,GAAke,GAAjf;AACA,WAAO,yBAAyBE,QAAhC;AACD;;AAED,WAASC,YAAT,CAAsB3C,MAAtB,EAA8B4C,KAA9B,EAAqCtB,MAArC,EAA6CuB,eAA7C,EAA8D;AAC5D,QAAI7C,MAAM,YAAYV,WAAtB,EAAmC;AACjCU,MAAAA,MAAM,CAAC8C,cAAP,CAAsB/B,KAAtB,EAA6B6B,KAA7B,EAAoCtB,MAApC;AACA,UAAI3B,KAAJ;;AAEA,UAAIK,MAAM,YAAYa,WAAtB,EAAmC;AACjC;AACAO,QAAAA,MAAM,CAACX,IAAP,CAAYa,MAAM,CAACyB,kBAAnB;AACA3B,QAAAA,MAAM,CAAC4B,SAAP;AACA5B,QAAAA,MAAM,CAAC6B,YAAP,CAAoBjD,MAAM,CAACkD,WAA3B;AACA9B,QAAAA,MAAM,CAAC+B,KAAP,CAAanD,MAAM,CAACmD,KAApB;AACA/B,QAAAA,MAAM,CAACoB,QAAP,CAAgB,CAAhB,IAAqB,CAArB;AACApB,QAAAA,MAAM,CAACoB,QAAP,CAAgB,CAAhB,IAAqB,CAArB;AACApB,QAAAA,MAAM,CAACoB,QAAP,CAAgB,EAAhB,IAAsB,CAAtB;AACApB,QAAAA,MAAM,CAACoB,QAAP,CAAgB,EAAhB,IAAsB,CAAtB;AACA7C,QAAAA,KAAK,GAAG8C,kBAAkB,CAACrB,MAAD,CAA1B;AACD,OAXD,MAWO;AACLzB,QAAAA,KAAK,GAAG8C,kBAAkB,CAACzC,MAAM,CAACkD,WAAR,CAA1B;AACD;;AAED,UAAI3D,OAAO,GAAGS,MAAM,CAACT,OAArB;AACA,UAAI6D,YAAY,GAAG/B,KAAK,CAACG,OAAN,CAAc6B,GAAd,CAAkBrD,MAAlB,CAAnB;;AAEA,UAAIoD,YAAY,KAAKE,SAAjB,IAA8BF,YAAY,CAACzD,KAAb,KAAuBA,KAAzD,EAAgE;AAC9DJ,QAAAA,OAAO,CAACI,KAAR,CAAc4D,SAAd,GAA0B5D,KAA1B;AACA,YAAI6D,UAAU,GAAG;AACf7D,UAAAA,KAAK,EAAEA;AADQ,SAAjB;AAGA0B,QAAAA,KAAK,CAACG,OAAN,CAAciC,GAAd,CAAkBzD,MAAlB,EAA0BwD,UAA1B;AACD;;AAEDjE,MAAAA,OAAO,CAACI,KAAR,CAAc+D,OAAd,GAAwB1D,MAAM,CAAC2D,OAAP,GAAiB,EAAjB,GAAsB,MAA9C;;AAEA,UAAIpE,OAAO,CAACW,UAAR,KAAuB0B,aAA3B,EAA0C;AACxCA,QAAAA,aAAa,CAACE,WAAd,CAA0BvC,OAA1B;AACD;;AAEDS,MAAAA,MAAM,CAAC4D,aAAP,CAAqB7C,KAArB,EAA4B6B,KAA5B,EAAmCtB,MAAnC;AACD;;AAED,SAAK,IAAIuC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAG9D,MAAM,CAAC+D,QAAP,CAAgBC,MAApC,EAA4CH,CAAC,GAAGC,CAAhD,EAAmDD,CAAC,EAApD,EAAwD;AACtDlB,MAAAA,YAAY,CAAC3C,MAAM,CAAC+D,QAAP,CAAgBF,CAAhB,CAAD,EAAqBjB,KAArB,EAA4BtB,MAA5B,CAAZ;AACD;AACF;;AAED,OAAK2C,MAAL,GAAc,UAAUrB,KAAV,EAAiBtB,MAAjB,EAAyB;AACrC,QAAIC,GAAG,GAAGD,MAAM,CAAC4C,gBAAP,CAAwB1B,QAAxB,CAAiC,CAAjC,IAAsCrB,WAAhD;;AAEA,QAAIE,KAAK,CAACC,MAAN,CAAaC,GAAb,KAAqBA,GAAzB,EAA8B;AAC5BG,MAAAA,UAAU,CAAC/B,KAAX,CAAiBwE,WAAjB,GAA+B7C,MAAM,CAAC8C,mBAAP,GAA6B7C,GAAG,GAAG,IAAnC,GAA0C,EAAzE;AACAF,MAAAA,KAAK,CAACC,MAAN,CAAaC,GAAb,GAAmBA,GAAnB;AACD;;AAED,QAAIqB,KAAK,CAACyB,UAAN,KAAqB,IAAzB,EAA+BzB,KAAK,CAAC0B,iBAAN;AAC/B,QAAIhD,MAAM,CAACiD,MAAP,KAAkB,IAAtB,EAA4BjD,MAAM,CAACgD,iBAAP;;AAE5B,QAAIhD,MAAM,CAACkD,oBAAX,EAAiC;AAC/B,UAAIC,EAAE,GAAG,EAAEnD,MAAM,CAACoD,KAAP,GAAepD,MAAM,CAACqD,IAAxB,IAAgC,CAAzC;AACA,UAAIC,EAAE,GAAG,CAACtD,MAAM,CAACuD,GAAP,GAAavD,MAAM,CAACwD,MAArB,IAA+B,CAAxC;AACD;;AAED,QAAIjC,eAAe,GAAGvB,MAAM,CAACkD,oBAAP,GAA8B,WAAWjD,GAAX,GAAiB,GAAjB,GAAuB,YAAvB,GAAsCY,OAAO,CAACsC,EAAD,CAA7C,GAAoD,KAApD,GAA4DtC,OAAO,CAACyC,EAAD,CAAnE,GAA0E,KAA1E,GAAkFrC,kBAAkB,CAACjB,MAAM,CAACyB,kBAAR,CAAlI,GAAgK,gBAAgBxB,GAAhB,GAAsB,KAAtB,GAA8BgB,kBAAkB,CAACjB,MAAM,CAACyB,kBAAR,CAAtO;AACA,QAAIpD,KAAK,GAAGkD,eAAe,GAAG,YAAlB,GAAiC3B,UAAjC,GAA8C,KAA9C,GAAsDC,WAAtD,GAAoE,KAAhF;;AAEA,QAAIE,KAAK,CAACC,MAAN,CAAa3B,KAAb,KAAuBA,KAA3B,EAAkC;AAChCiC,MAAAA,aAAa,CAACjC,KAAd,CAAoB4D,SAApB,GAAgC5D,KAAhC;AACA0B,MAAAA,KAAK,CAACC,MAAN,CAAa3B,KAAb,GAAqBA,KAArB;AACD;;AAEDgD,IAAAA,YAAY,CAACC,KAAD,EAAQA,KAAR,EAAetB,MAAf,CAAZ;AACD,GAzBD;AA0BD,CA/HD;;AAiIA,SAAShC,WAAT,EAAsBwB,aAAtB,EAAqCD,WAArC","sourcesContent":["import { Object3D, Matrix4 } from 'three';\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nvar CSS3DObject = function (element) {\n  Object3D.call(this);\n  this.element = element || document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.element.style.pointerEvents = 'auto';\n  this.addEventListener('removed', function () {\n    this.traverse(function (object) {\n      if (object.element instanceof Element && object.element.parentNode !== null) {\n        object.element.parentNode.removeChild(object.element);\n      }\n    });\n  });\n};\n\nCSS3DObject.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: CSS3DObject,\n  copy: function (source, recursive) {\n    Object3D.prototype.copy.call(this, source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n});\n\nvar CSS3DSprite = function (element) {\n  CSS3DObject.call(this, element);\n};\n\nCSS3DSprite.prototype = Object.create(CSS3DObject.prototype);\nCSS3DSprite.prototype.constructor = CSS3DSprite; //\n\nvar CSS3DRenderer = function () {\n  var _this = this;\n\n  var _width, _height;\n\n  var _widthHalf, _heightHalf;\n\n  var matrix = new Matrix4();\n  var cache = {\n    camera: {\n      fov: 0,\n      style: ''\n    },\n    objects: new WeakMap()\n  };\n  var domElement = document.createElement('div');\n  domElement.style.overflow = 'hidden';\n  this.domElement = domElement;\n  var cameraElement = document.createElement('div');\n  cameraElement.style.transformStyle = 'preserve-3d';\n  cameraElement.style.pointerEvents = 'none';\n  domElement.appendChild(cameraElement);\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height) {\n    _width = width;\n    _height = height;\n    _widthHalf = _width / 2;\n    _heightHalf = _height / 2;\n    domElement.style.width = width + 'px';\n    domElement.style.height = height + 'px';\n    cameraElement.style.width = width + 'px';\n    cameraElement.style.height = height + 'px';\n  };\n\n  function epsilon(value) {\n    return Math.abs(value) < 1e-10 ? 0 : value;\n  }\n\n  function getCameraCSSMatrix(matrix) {\n    var elements = matrix.elements;\n    return 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(-elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(elements[6]) + ',' + epsilon(elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(-elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(-elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n  }\n\n  function getObjectCSSMatrix(matrix) {\n    var elements = matrix.elements;\n    var matrix3d = 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(-elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(-elements[6]) + ',' + epsilon(-elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n    return 'translate(-50%,-50%)' + matrix3d;\n  }\n\n  function renderObject(object, scene, camera, cameraCSSMatrix) {\n    if (object instanceof CSS3DObject) {\n      object.onBeforeRender(_this, scene, camera);\n      var style;\n\n      if (object instanceof CSS3DSprite) {\n        // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n        matrix.copy(camera.matrixWorldInverse);\n        matrix.transpose();\n        matrix.copyPosition(object.matrixWorld);\n        matrix.scale(object.scale);\n        matrix.elements[3] = 0;\n        matrix.elements[7] = 0;\n        matrix.elements[11] = 0;\n        matrix.elements[15] = 1;\n        style = getObjectCSSMatrix(matrix);\n      } else {\n        style = getObjectCSSMatrix(object.matrixWorld);\n      }\n\n      var element = object.element;\n      var cachedObject = cache.objects.get(object);\n\n      if (cachedObject === undefined || cachedObject.style !== style) {\n        element.style.transform = style;\n        var objectData = {\n          style: style\n        };\n        cache.objects.set(object, objectData);\n      }\n\n      element.style.display = object.visible ? '' : 'none';\n\n      if (element.parentNode !== cameraElement) {\n        cameraElement.appendChild(element);\n      }\n\n      object.onAfterRender(_this, scene, camera);\n    }\n\n    for (let i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera);\n    }\n  }\n\n  this.render = function (scene, camera) {\n    var fov = camera.projectionMatrix.elements[5] * _heightHalf;\n\n    if (cache.camera.fov !== fov) {\n      domElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\n      cache.camera.fov = fov;\n    }\n\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    if (camera.isOrthographicCamera) {\n      var tx = -(camera.right + camera.left) / 2;\n      var ty = (camera.top + camera.bottom) / 2;\n    }\n\n    var cameraCSSMatrix = camera.isOrthographicCamera ? 'scale(' + fov + ')' + 'translate(' + epsilon(tx) + 'px,' + epsilon(ty) + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse) : 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse);\n    var style = cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n    if (cache.camera.style !== style) {\n      cameraElement.style.transform = style;\n      cache.camera.style = style;\n    }\n\n    renderObject(scene, scene, camera);\n  };\n};\n\nexport { CSS3DObject, CSS3DRenderer, CSS3DSprite };\n"]},"metadata":{},"sourceType":"module"}