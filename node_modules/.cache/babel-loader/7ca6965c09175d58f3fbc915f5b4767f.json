{"ast":null,"code":"import { Object3D, Box3, AnimationMixer, TextureLoader, UVMapping, sRGBEncoding, MeshLambertMaterial, Mesh } from 'three';\nimport { MD2Loader } from '../loaders/MD2Loader.js';\n\nvar MD2Character = function MD2Character() {\n  var scope = this;\n  this.scale = 1;\n  this.animationFPS = 6;\n  this.root = new Object3D();\n  this.meshBody = null;\n  this.meshWeapon = null;\n  this.skinsBody = [];\n  this.skinsWeapon = [];\n  this.weapons = [];\n  this.activeAnimation = null;\n  this.mixer = null;\n\n  this.onLoadComplete = function () {};\n\n  this.loadCounter = 0;\n\n  this.loadParts = function (config) {\n    this.loadCounter = config.weapons.length * 2 + config.skins.length + 1;\n    var weaponsTextures = [];\n\n    for (var i = 0; i < config.weapons.length; i++) {\n      weaponsTextures[i] = config.weapons[i][1];\n    } // SKINS\n\n\n    this.skinsBody = loadTextures(config.baseUrl + 'skins/', config.skins);\n    this.skinsWeapon = loadTextures(config.baseUrl + 'skins/', weaponsTextures); // BODY\n\n    var loader = new MD2Loader();\n    loader.load(config.baseUrl + config.body, function (geo) {\n      var boundingBox = new Box3();\n      boundingBox.setFromBufferAttribute(geo.attributes.position);\n      scope.root.position.y = -scope.scale * boundingBox.min.y;\n      var mesh = createPart(geo, scope.skinsBody[0]);\n      mesh.scale.set(scope.scale, scope.scale, scope.scale);\n      scope.root.add(mesh);\n      scope.meshBody = mesh;\n      scope.meshBody.clipOffset = 0;\n      scope.activeAnimationClipName = mesh.geometry.animations[0].name;\n      scope.mixer = new AnimationMixer(mesh);\n      checkLoadingComplete();\n    }); // WEAPONS\n\n    var generateCallback = function generateCallback(index, name) {\n      return function (geo) {\n        var mesh = createPart(geo, scope.skinsWeapon[index]);\n        mesh.scale.set(scope.scale, scope.scale, scope.scale);\n        mesh.visible = false;\n        mesh.name = name;\n        scope.root.add(mesh);\n        scope.weapons[index] = mesh;\n        scope.meshWeapon = mesh;\n        checkLoadingComplete();\n      };\n    };\n\n    for (var _i = 0; _i < config.weapons.length; _i++) {\n      loader.load(config.baseUrl + config.weapons[_i][0], generateCallback(_i, config.weapons[_i][0]));\n    }\n  };\n\n  this.setPlaybackRate = function (rate) {\n    if (rate !== 0) {\n      this.mixer.timeScale = 1 / rate;\n    } else {\n      this.mixer.timeScale = 0;\n    }\n  };\n\n  this.setWireframe = function (wireframeEnabled) {\n    if (wireframeEnabled) {\n      if (this.meshBody) this.meshBody.material = this.meshBody.materialWireframe;\n      if (this.meshWeapon) this.meshWeapon.material = this.meshWeapon.materialWireframe;\n    } else {\n      if (this.meshBody) this.meshBody.material = this.meshBody.materialTexture;\n      if (this.meshWeapon) this.meshWeapon.material = this.meshWeapon.materialTexture;\n    }\n  };\n\n  this.setSkin = function (index) {\n    if (this.meshBody && this.meshBody.material.wireframe === false) {\n      this.meshBody.material.map = this.skinsBody[index];\n    }\n  };\n\n  this.setWeapon = function (index) {\n    for (var i = 0; i < this.weapons.length; i++) {\n      this.weapons[i].visible = false;\n    }\n\n    var activeWeapon = this.weapons[index];\n\n    if (activeWeapon) {\n      activeWeapon.visible = true;\n      this.meshWeapon = activeWeapon;\n      scope.syncWeaponAnimation();\n    }\n  };\n\n  this.setAnimation = function (clipName) {\n    if (this.meshBody) {\n      if (this.meshBody.activeAction) {\n        this.meshBody.activeAction.stop();\n        this.meshBody.activeAction = null;\n      }\n\n      var action = this.mixer.clipAction(clipName, this.meshBody);\n\n      if (action) {\n        this.meshBody.activeAction = action.play();\n      }\n    }\n\n    scope.activeClipName = clipName;\n    scope.syncWeaponAnimation();\n  };\n\n  this.syncWeaponAnimation = function () {\n    var clipName = scope.activeClipName;\n\n    if (scope.meshWeapon) {\n      if (this.meshWeapon.activeAction) {\n        this.meshWeapon.activeAction.stop();\n        this.meshWeapon.activeAction = null;\n      }\n\n      var action = this.mixer.clipAction(clipName, this.meshWeapon);\n\n      if (action) {\n        this.meshWeapon.activeAction = action.syncWith(this.meshBody.activeAction).play();\n      }\n    }\n  };\n\n  this.update = function (delta) {\n    if (this.mixer) this.mixer.update(delta);\n  };\n\n  function loadTextures(baseUrl, textureUrls) {\n    var textureLoader = new TextureLoader();\n    var textures = [];\n\n    for (var i = 0; i < textureUrls.length; i++) {\n      textures[i] = textureLoader.load(baseUrl + textureUrls[i], checkLoadingComplete);\n      textures[i].mapping = UVMapping;\n      textures[i].name = textureUrls[i];\n      textures[i].encoding = sRGBEncoding;\n    }\n\n    return textures;\n  }\n\n  function createPart(geometry, skinMap) {\n    var materialWireframe = new MeshLambertMaterial({\n      color: 0xffaa00,\n      wireframe: true,\n      morphTargets: true,\n      morphNormals: true\n    });\n    var materialTexture = new MeshLambertMaterial({\n      color: 0xffffff,\n      wireframe: false,\n      map: skinMap,\n      morphTargets: true,\n      morphNormals: true\n    }); //\n\n    var mesh = new Mesh(geometry, materialTexture);\n    mesh.rotation.y = -Math.PI / 2;\n    mesh.castShadow = true;\n    mesh.receiveShadow = true; //\n\n    mesh.materialTexture = materialTexture;\n    mesh.materialWireframe = materialWireframe;\n    return mesh;\n  }\n\n  function checkLoadingComplete() {\n    scope.loadCounter -= 1;\n    if (scope.loadCounter === 0) scope.onLoadComplete();\n  }\n};\n\nexport { MD2Character };","map":{"version":3,"sources":["/Projects/arrayftw/node_modules/three-stdlib/misc/MD2Character.js"],"names":["Object3D","Box3","AnimationMixer","TextureLoader","UVMapping","sRGBEncoding","MeshLambertMaterial","Mesh","MD2Loader","MD2Character","scope","scale","animationFPS","root","meshBody","meshWeapon","skinsBody","skinsWeapon","weapons","activeAnimation","mixer","onLoadComplete","loadCounter","loadParts","config","length","skins","weaponsTextures","i","loadTextures","baseUrl","loader","load","body","geo","boundingBox","setFromBufferAttribute","attributes","position","y","min","mesh","createPart","set","add","clipOffset","activeAnimationClipName","geometry","animations","name","checkLoadingComplete","generateCallback","index","visible","setPlaybackRate","rate","timeScale","setWireframe","wireframeEnabled","material","materialWireframe","materialTexture","setSkin","wireframe","map","setWeapon","activeWeapon","syncWeaponAnimation","setAnimation","clipName","activeAction","stop","action","clipAction","play","activeClipName","syncWith","update","delta","textureUrls","textureLoader","textures","mapping","encoding","skinMap","color","morphTargets","morphNormals","rotation","Math","PI","castShadow","receiveShadow"],"mappings":"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","sourcesContent":["import { Object3D, Box3, AnimationMixer, TextureLoader, UVMapping, sRGBEncoding, MeshLambertMaterial, Mesh } from 'three';\nimport { MD2Loader } from '../loaders/MD2Loader.js';\n\nvar MD2Character = function () {\n  var scope = this;\n  this.scale = 1;\n  this.animationFPS = 6;\n  this.root = new Object3D();\n  this.meshBody = null;\n  this.meshWeapon = null;\n  this.skinsBody = [];\n  this.skinsWeapon = [];\n  this.weapons = [];\n  this.activeAnimation = null;\n  this.mixer = null;\n\n  this.onLoadComplete = function () {};\n\n  this.loadCounter = 0;\n\n  this.loadParts = function (config) {\n    this.loadCounter = config.weapons.length * 2 + config.skins.length + 1;\n    var weaponsTextures = [];\n\n    for (let i = 0; i < config.weapons.length; i++) weaponsTextures[i] = config.weapons[i][1]; // SKINS\n\n\n    this.skinsBody = loadTextures(config.baseUrl + 'skins/', config.skins);\n    this.skinsWeapon = loadTextures(config.baseUrl + 'skins/', weaponsTextures); // BODY\n\n    var loader = new MD2Loader();\n    loader.load(config.baseUrl + config.body, function (geo) {\n      var boundingBox = new Box3();\n      boundingBox.setFromBufferAttribute(geo.attributes.position);\n      scope.root.position.y = -scope.scale * boundingBox.min.y;\n      var mesh = createPart(geo, scope.skinsBody[0]);\n      mesh.scale.set(scope.scale, scope.scale, scope.scale);\n      scope.root.add(mesh);\n      scope.meshBody = mesh;\n      scope.meshBody.clipOffset = 0;\n      scope.activeAnimationClipName = mesh.geometry.animations[0].name;\n      scope.mixer = new AnimationMixer(mesh);\n      checkLoadingComplete();\n    }); // WEAPONS\n\n    var generateCallback = function (index, name) {\n      return function (geo) {\n        var mesh = createPart(geo, scope.skinsWeapon[index]);\n        mesh.scale.set(scope.scale, scope.scale, scope.scale);\n        mesh.visible = false;\n        mesh.name = name;\n        scope.root.add(mesh);\n        scope.weapons[index] = mesh;\n        scope.meshWeapon = mesh;\n        checkLoadingComplete();\n      };\n    };\n\n    for (let i = 0; i < config.weapons.length; i++) {\n      loader.load(config.baseUrl + config.weapons[i][0], generateCallback(i, config.weapons[i][0]));\n    }\n  };\n\n  this.setPlaybackRate = function (rate) {\n    if (rate !== 0) {\n      this.mixer.timeScale = 1 / rate;\n    } else {\n      this.mixer.timeScale = 0;\n    }\n  };\n\n  this.setWireframe = function (wireframeEnabled) {\n    if (wireframeEnabled) {\n      if (this.meshBody) this.meshBody.material = this.meshBody.materialWireframe;\n      if (this.meshWeapon) this.meshWeapon.material = this.meshWeapon.materialWireframe;\n    } else {\n      if (this.meshBody) this.meshBody.material = this.meshBody.materialTexture;\n      if (this.meshWeapon) this.meshWeapon.material = this.meshWeapon.materialTexture;\n    }\n  };\n\n  this.setSkin = function (index) {\n    if (this.meshBody && this.meshBody.material.wireframe === false) {\n      this.meshBody.material.map = this.skinsBody[index];\n    }\n  };\n\n  this.setWeapon = function (index) {\n    for (let i = 0; i < this.weapons.length; i++) this.weapons[i].visible = false;\n\n    var activeWeapon = this.weapons[index];\n\n    if (activeWeapon) {\n      activeWeapon.visible = true;\n      this.meshWeapon = activeWeapon;\n      scope.syncWeaponAnimation();\n    }\n  };\n\n  this.setAnimation = function (clipName) {\n    if (this.meshBody) {\n      if (this.meshBody.activeAction) {\n        this.meshBody.activeAction.stop();\n        this.meshBody.activeAction = null;\n      }\n\n      var action = this.mixer.clipAction(clipName, this.meshBody);\n\n      if (action) {\n        this.meshBody.activeAction = action.play();\n      }\n    }\n\n    scope.activeClipName = clipName;\n    scope.syncWeaponAnimation();\n  };\n\n  this.syncWeaponAnimation = function () {\n    var clipName = scope.activeClipName;\n\n    if (scope.meshWeapon) {\n      if (this.meshWeapon.activeAction) {\n        this.meshWeapon.activeAction.stop();\n        this.meshWeapon.activeAction = null;\n      }\n\n      var action = this.mixer.clipAction(clipName, this.meshWeapon);\n\n      if (action) {\n        this.meshWeapon.activeAction = action.syncWith(this.meshBody.activeAction).play();\n      }\n    }\n  };\n\n  this.update = function (delta) {\n    if (this.mixer) this.mixer.update(delta);\n  };\n\n  function loadTextures(baseUrl, textureUrls) {\n    var textureLoader = new TextureLoader();\n    var textures = [];\n\n    for (let i = 0; i < textureUrls.length; i++) {\n      textures[i] = textureLoader.load(baseUrl + textureUrls[i], checkLoadingComplete);\n      textures[i].mapping = UVMapping;\n      textures[i].name = textureUrls[i];\n      textures[i].encoding = sRGBEncoding;\n    }\n\n    return textures;\n  }\n\n  function createPart(geometry, skinMap) {\n    var materialWireframe = new MeshLambertMaterial({\n      color: 0xffaa00,\n      wireframe: true,\n      morphTargets: true,\n      morphNormals: true\n    });\n    var materialTexture = new MeshLambertMaterial({\n      color: 0xffffff,\n      wireframe: false,\n      map: skinMap,\n      morphTargets: true,\n      morphNormals: true\n    }); //\n\n    var mesh = new Mesh(geometry, materialTexture);\n    mesh.rotation.y = -Math.PI / 2;\n    mesh.castShadow = true;\n    mesh.receiveShadow = true; //\n\n    mesh.materialTexture = materialTexture;\n    mesh.materialWireframe = materialWireframe;\n    return mesh;\n  }\n\n  function checkLoadingComplete() {\n    scope.loadCounter -= 1;\n    if (scope.loadCounter === 0) scope.onLoadComplete();\n  }\n};\n\nexport { MD2Character };\n"]},"metadata":{},"sourceType":"module"}