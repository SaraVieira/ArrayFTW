"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r=require("../core/NodeBuilder.cjs.js"),s=require("../materials/NodeMaterial.cjs.js"),t=require("./TextureNode.cjs.js");function o(r,o,i,a){a=a||{},this.input=i,this.clear=void 0===a.clear||a.clear,this.renderTarget=new e.WebGLRenderTarget(r,o,a),this.material=new s.NodeMaterial,this.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,t.TextureNode.call(this,this.renderTarget.texture)}require("../core/NodeUniform.cjs.js"),require("../core/NodeUtils.cjs.js"),require("../core/NodeLib.cjs.js"),require("../core/FunctionNode.cjs.js"),require("../core/TempNode.cjs.js"),require("../core/Node.cjs.js"),require("../core/ConstNode.cjs.js"),require("../core/StructNode.cjs.js"),require("./Vector2Node.cjs.js"),require("../core/InputNode.cjs.js"),require("./Vector3Node.cjs.js"),require("./Vector4Node.cjs.js"),require("./CubeTextureNode.cjs.js"),require("../accessors/ReflectNode.cjs.js"),require("../accessors/PositionNode.cjs.js"),require("../accessors/NormalNode.cjs.js"),require("../utils/ColorSpaceNode.cjs.js"),require("./FloatNode.cjs.js"),require("../core/ExpressionNode.cjs.js"),require("../misc/TextureCubeNode.cjs.js"),require("../misc/TextureCubeUVNode.cjs.js"),require("../core/FunctionCallNode.cjs.js"),require("../math/OperatorNode.cjs.js"),require("../math/MathNode.cjs.js"),require("../accessors/UVNode.cjs.js"),require("./ColorNode.cjs.js"),require("../materials/nodes/RawNode.cjs.js"),o.prototype=Object.create(t.TextureNode.prototype),o.prototype.constructor=o,o.prototype.nodeType="RTT",o.prototype.build=function(e,s,o){var i=new r.NodeBuilder;return i.nodes=e.nodes,i.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:i}),t.TextureNode.prototype.build.call(this,e,s,o)},o.prototype.updateFramesaveTo=function(r){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var t=new s.NodeMaterial;t.fragment.value=this,t.build();var o=new e.Scene,i=new e.Mesh(new e.PlaneGeometry(2,2),t);i.frustumCulled=!1,o.add(i),this.saveToScene=o,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,r.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&r.renderer.clear(),r.renderer.render(this.saveToScene,this.camera)},o.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},o.prototype.copy=function(e){return t.TextureNode.prototype.copy.call(this,e),this.saveTo=e.saveTo,this},o.prototype.toJSON=function(e){var r=this.getJSONNode(e);return r||(r=t.TextureNode.prototype.toJSON.call(this,e),this.saveTo&&(r.saveTo=this.saveTo.toJSON(e).uuid)),r},exports.RTTNode=o;
