"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../core/TempNode.cjs.js"),t=require("./PositionNode.cjs.js"),r=require("./NormalNode.cjs.js");function o(t){e.TempNode.call(this,"v3"),this.scope=t||o.CUBE}require("three"),require("../core/Node.cjs.js"),require("../core/NodeLib.cjs.js"),o.CUBE="cube",o.SPHERE="sphere",o.VECTOR="vector",o.prototype=Object.create(e.TempNode.prototype),o.prototype.constructor=o,o.prototype.nodeType="Reflect",o.prototype.getUnique=function(e){return!e.context.viewNormal},o.prototype.getType=function(){switch(this.scope){case o.SPHERE:return"v2"}return this.type},o.prototype.generate=function(e,c){var i=this.getUnique(e);if(e.isShader("fragment")){var s;switch(this.scope){case o.VECTOR:var n=new r.NormalNode(r.NormalNode.VIEW),a=e.context.roughness,d=n.build(e,"v3"),p=new t.PositionNode(t.PositionNode.VIEW).build(e,"v3"),u=a?a.build(e,"f"):void 0,l="reflect( -normalize( "+p+" ), "+d+" )";u&&(l="normalize( mix( "+l+", "+d+", "+u+" * "+u+" ) )");var v="inverseTransformDirection( "+l+", viewMatrix )";i?(e.addNodeCode("vec3 reflectVec = "+v+";"),s="reflectVec"):s=v;break;case o.CUBE:v="vec3( -"+(N=new o(o.VECTOR).build(e,"v3"))+".x, "+N+".yz )";i?(e.addNodeCode("vec3 reflectCubeVec = "+v+";"),s="reflectCubeVec"):s=v;break;case o.SPHERE:var N;v="normalize( ( viewMatrix * vec4( "+(N=new o(o.VECTOR).build(e,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode("vec2 reflectSphereVec = "+v+";"),s="reflectSphereVec"):s=v}return e.format(s,this.getType(e),c)}return console.warn("THREE.ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,c)},o.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},exports.ReflectNode=o;
