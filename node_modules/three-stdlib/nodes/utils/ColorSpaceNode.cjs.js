"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n,o,a,t,r,i,c,u,v,l,L,p,s,R=require("three"),m=require("../core/TempNode.cjs.js"),d=require("../core/ConstNode.cjs.js"),T=require("../inputs/FloatNode.cjs.js"),g=require("../core/FunctionNode.cjs.js"),G=require("../core/ExpressionNode.cjs.js");function _(e,n){m.TempNode.call(this,"v4"),this.input=e,this.method=n||_.LINEAR_TO_LINEAR}require("../core/Node.cjs.js"),require("../core/InputNode.cjs.js"),require("../core/NodeLib.cjs.js"),_.Nodes=(e=new g.FunctionNode(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),n=new g.FunctionNode(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),o=new g.FunctionNode(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),a=new g.FunctionNode(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),t=new g.FunctionNode(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),r=new g.FunctionNode(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),i=new g.FunctionNode(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),c=new g.FunctionNode(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),u=new g.FunctionNode(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),v=new g.FunctionNode(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),l=new g.FunctionNode(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),L=new d.ConstNode("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),p=new g.FunctionNode(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[L]),s=new d.ConstNode("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:e,GammaToLinear:n,LinearToGamma:o,sRGBToLinear:a,LinearTosRGB:t,RGBEToLinear:r,LinearToRGBE:i,RGBMToLinear:c,LinearToRGBM:u,RGBDToLinear:v,LinearToRGBD:l,cLogLuvM:L,LinearToLogLuv:p,cLogLuvInverseM:s,LogLuvToLinear:new g.FunctionNode(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[s])}),_.LINEAR_TO_LINEAR="LinearToLinear",_.GAMMA_TO_LINEAR="GammaToLinear",_.LINEAR_TO_GAMMA="LinearToGamma",_.SRGB_TO_LINEAR="sRGBToLinear",_.LINEAR_TO_SRGB="LinearTosRGB",_.RGBE_TO_LINEAR="RGBEToLinear",_.LINEAR_TO_RGBE="LinearToRGBE",_.RGBM_TO_LINEAR="RGBMToLinear",_.LINEAR_TO_RGBM="LinearToRGBM",_.RGBD_TO_LINEAR="RGBDToLinear",_.LINEAR_TO_RGBD="LinearToRGBD",_.LINEAR_TO_LOG_LUV="LinearToLogLuv",_.LOG_LUV_TO_LINEAR="LogLuvToLinear",_.getEncodingComponents=function(e){switch(e){case R.LinearEncoding:return["Linear"];case R.sRGBEncoding:return["sRGB"];case R.RGBEEncoding:return["RGBE"];case R.RGBM7Encoding:return["RGBM",new T.FloatNode(7).setReadonly(!0)];case R.RGBM16Encoding:return["RGBM",new T.FloatNode(16).setReadonly(!0)];case R.RGBDEncoding:return["RGBD",new T.FloatNode(256).setReadonly(!0)];case R.GammaEncoding:return["Gamma",new G.ExpressionNode("float( GAMMA_FACTOR )","f")]}},_.prototype=Object.create(m.TempNode.prototype),_.prototype.constructor=_,_.prototype.nodeType="ColorSpace",_.prototype.hashProperties=["method"],_.prototype.generate=function(e,n){var o=this.input.build(e,"v4"),a=this.getType(e),t=_.Nodes[this.method],r=e.include(t);if(r===_.LINEAR_TO_LINEAR)return e.format(o,a,n);if(2===t.inputs.length){var i=this.factor.build(e,"f");return e.format(r+"( "+o+", "+i+" )",a,n)}return e.format(r+"( "+o+" )",a,n)},_.prototype.fromEncoding=function(e){var n=_.getEncodingComponents(e);this.method="LinearTo"+n[0],this.factor=n[1]},_.prototype.fromDecoding=function(e){var n=_.getEncodingComponents(e);this.method=n[0]+"ToLinear",this.factor=n[1]},_.prototype.copy=function(e){return m.TempNode.prototype.copy.call(this,e),this.input=e.input,this.method=e.method,this},_.prototype.toJSON=function(e){var n=this.getJSONNode(e);return n||((n=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,n.method=this.method),n},exports.ColorSpaceNode=_;
