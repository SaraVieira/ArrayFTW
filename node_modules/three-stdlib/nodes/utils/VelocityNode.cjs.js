"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e=require("../inputs/Vector3Node.cjs.js");function i(i,s){e.Vector3Node.call(this),this.params={},this.velocity=new t.Vector3,this.setTarget(i),this.setParams(s)}require("../core/InputNode.cjs.js"),require("../core/TempNode.cjs.js"),require("../core/Node.cjs.js"),require("../core/NodeUtils.cjs.js"),i.prototype=Object.create(e.Vector3Node.prototype),i.prototype.constructor=i,i.prototype.nodeType="Velocity",i.prototype.getReadonly=function(){return!1},i.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new t.Vector3,this.speed=new t.Vector3,this.springVelocity=new t.Vector3,this.lastVelocity=new t.Vector3}},i.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new t.Vector3),this.oldPosition=this.position.clone())},i.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new t.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},i.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),i=Math.pow(this.params.spring,e),s=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(s).multiplyScalar(1-i)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(i),this.moment.add(this.springVelocity),this.moment.multiplyScalar(s),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},i.prototype.copy=function(t){return e.Vector3Node.prototype.copy.call(this,t),t.target&&this.setTarget(t.target),this.setParams(t.params),this},i.prototype.toJSON=function(t){var i=e.Vector3Node.prototype.toJSON.call(this,t);return this.target&&(i.target=this.target.uuid),i.params=JSON.parse(JSON.stringify(this.params)),i},exports.VelocityNode=i;
