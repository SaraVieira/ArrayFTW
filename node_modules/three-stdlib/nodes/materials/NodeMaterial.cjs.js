"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=require("../core/NodeBuilder.cjs.js"),i=require("../inputs/ColorNode.cjs.js"),s=require("../accessors/PositionNode.cjs.js"),r=require("./nodes/RawNode.cjs.js");function o(t,o){e.ShaderMaterial.call(this),this.vertex=t||new r.RawNode(new s.PositionNode(s.PositionNode.PROJECTION)),this.fragment=o||new r.RawNode(new i.ColorNode(16711680)),this.updaters=[]}require("../core/NodeUniform.cjs.js"),require("../core/NodeUtils.cjs.js"),require("../core/NodeLib.cjs.js"),require("../core/FunctionNode.cjs.js"),require("../core/TempNode.cjs.js"),require("../core/Node.cjs.js"),require("../core/ConstNode.cjs.js"),require("../core/StructNode.cjs.js"),require("../inputs/Vector2Node.cjs.js"),require("../core/InputNode.cjs.js"),require("../inputs/Vector3Node.cjs.js"),require("../inputs/Vector4Node.cjs.js"),require("../inputs/TextureNode.cjs.js"),require("../accessors/UVNode.cjs.js"),require("../utils/ColorSpaceNode.cjs.js"),require("../inputs/FloatNode.cjs.js"),require("../core/ExpressionNode.cjs.js"),require("../inputs/CubeTextureNode.cjs.js"),require("../accessors/ReflectNode.cjs.js"),require("../accessors/NormalNode.cjs.js"),require("../misc/TextureCubeNode.cjs.js"),require("../misc/TextureCubeUVNode.cjs.js"),require("../core/FunctionCallNode.cjs.js"),require("../math/OperatorNode.cjs.js"),require("../math/MathNode.cjs.js"),o.prototype=Object.create(e.ShaderMaterial.prototype),o.prototype.constructor=o,o.prototype.type="NodeMaterial",o.prototype.isNodeMaterial=!0,Object.defineProperties(o.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),o.prototype.onBeforeCompile=function(e,t){this.build({renderer:t}),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD},o.prototype.customProgramCacheKey=function(){return this.getHash()},o.prototype.getHash=function(){var e="{";return e+='"vertex":'+this.vertex.getHash()+",",e+='"fragment":'+this.fragment.getHash(),e+="}"},o.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},o.prototype.build=function(i){var s=(i=i||{}).builder||new t.NodeBuilder;return s.setMaterial(this,i.renderer),s.build(this.vertex,this.fragment),this.vertexShader=s.getCode("vertex"),this.fragmentShader=s.getCode("fragment"),this.defines=s.defines,this.uniforms=s.uniforms,this.extensions=s.extensions,this.updaters=s.updaters,this.fog=s.requires.fog,this.lights=s.requires.lights,this.transparent=s.requires.transparent||this.blending>e.NormalBlending,this},o.prototype.copy=function(e){var t=this.uuid;for(var i in e)this[i]=e[i];return this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},o.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var i={};i.uuid=this.uuid,i.type=this.type,t.materials[i.uuid]=i,""!==this.name&&(i.name=this.name),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==e.NormalBlending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==e.FrontSide&&(i.side=this.side),this.vertexColors!==e.NoColors&&(i.vertexColors=this.vertexColors),this.depthFunc!==e.LessEqualDepth&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.fog=this.fog,i.lights=this.lights,i.vertex=this.vertex.toJSON(t).uuid,i.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t},exports.NodeMaterial=o;
