"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),i=require("../../core/Node.cjs.js"),t=require("../../inputs/ColorNode.cjs.js"),s=require("../../inputs/FloatNode.cjs.js");function o(){i.Node.call(this),this.color=new t.ColorNode(15658734),this.specular=new t.ColorNode(1118481),this.shininess=new s.FloatNode(30)}require("../../core/InputNode.cjs.js"),require("../../core/TempNode.cjs.js"),require("../../core/NodeUtils.cjs.js"),o.prototype=Object.create(i.Node.prototype),o.prototype.constructor=o,o.prototype.nodeType="Phong",o.prototype.build=function(i){var t;if(i.define("PHONG"),i.requires.lights=!0,i.isShader("vertex")){var s=this.position?this.position.analyzeAndFlow(i,"v3",{cache:"position"}):void 0;i.mergeUniform(e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights])),i.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var o=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];s&&o.push(s.code,s.result?"transformed = "+s.result+";":""),o.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),t=o.join("\n")}else{this.mask&&this.mask.analyze(i),this.color.analyze(i,{slot:"color"}),this.specular.analyze(i),this.shininess.analyze(i),this.alpha&&this.alpha.analyze(i),this.normal&&this.normal.analyze(i),this.light&&this.light.analyze(i,{cache:"light"}),this.ao&&this.ao.analyze(i),this.ambient&&this.ambient.analyze(i),this.shadow&&this.shadow.analyze(i),this.emissive&&this.emissive.analyze(i,{slot:"emissive"}),this.environment&&this.environment.analyze(i,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(i);var n=this.mask?this.mask.flow(i,"b"):void 0,r=this.color.flow(i,"c",{slot:"color"}),l=this.specular.flow(i,"c"),h=this.shininess.flow(i,"f"),a=this.alpha?this.alpha.flow(i,"f"):void 0,d=this.normal?this.normal.flow(i,"v3"):void 0,u=this.light?this.light.flow(i,"v3",{cache:"light"}):void 0,c=this.ao?this.ao.flow(i,"f"):void 0,p=this.ambient?this.ambient.flow(i,"c"):void 0,m=this.shadow?this.shadow.flow(i,"c"):void 0,f=this.emissive?this.emissive.flow(i,"c",{slot:"emissive"}):void 0,g=this.environment?this.environment.flow(i,"c",{slot:"environment"}):void 0,v=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(i,"f"):void 0;i.requires.transparent=void 0!==a,i.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));o=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];n&&o.push(n.code,"if ( ! "+n.result+" ) discard;"),o.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",l.code,"\tvec3 specular = "+l.result+";",h.code,"\tfloat shininess = max( 0.0001, "+h.result+" );","\tfloat specularStrength = 1.0;"),a&&o.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),d&&o.push(d.code,"normal = "+d.result+";"),o.push("material.diffuseColor = "+(u?"vec3( 1.0 )":"diffuseColor")+";"),o.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u&&(o.push(u.code,"reflectedLight.directDiffuse = "+u.result+";"),o.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),c&&o.push(c.code,"reflectedLight.indirectDiffuse *= "+c.result+";"),p&&o.push(p.code,"reflectedLight.indirectDiffuse += "+p.result+";"),m&&o.push(m.code,"reflectedLight.directDiffuse *= "+m.result+";","reflectedLight.directSpecular *= "+m.result+";"),f&&o.push(f.code,"reflectedLight.directDiffuse += "+f.result+";"),o.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),g&&(o.push(g.code),v?o.push(v.code,"outgoingLight = mix( outgoingLight, "+g.result+", "+v.result+" );"):o.push("outgoingLight = "+g.result+";")),a?o.push("gl_FragColor = vec4( outgoingLight, "+a.result+" );"):o.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),o.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),t=o.join("\n")}return t},o.prototype.copy=function(e){return i.Node.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.specular=e.specular,this.shininess=e.shininess,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.environmentAlpha&&(this.environmentAlpha=e.environmentAlpha),this},o.prototype.toJSON=function(e){var i=this.getJSONNode(e);return i||(i=this.createJSONNode(e),this.position&&(i.position=this.position.toJSON(e).uuid),i.color=this.color.toJSON(e).uuid,i.specular=this.specular.toJSON(e).uuid,i.shininess=this.shininess.toJSON(e).uuid,this.mask&&(i.mask=this.mask.toJSON(e).uuid),this.alpha&&(i.alpha=this.alpha.toJSON(e).uuid),this.normal&&(i.normal=this.normal.toJSON(e).uuid),this.light&&(i.light=this.light.toJSON(e).uuid),this.ao&&(i.ao=this.ao.toJSON(e).uuid),this.ambient&&(i.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(i.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(i.emissive=this.emissive.toJSON(e).uuid),this.environment&&(i.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(i.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),i},exports.PhongNode=o;
