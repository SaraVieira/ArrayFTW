"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),o=require("../../core/Node.cjs.js"),i=require("../../inputs/ColorNode.cjs.js");function t(){o.Node.call(this),this.color=new i.ColorNode(15658734),this.spherical=!0}require("../../core/InputNode.cjs.js"),require("../../core/TempNode.cjs.js"),require("../../core/NodeUtils.cjs.js"),t.prototype=Object.create(o.Node.prototype),t.prototype.constructor=t,t.prototype.nodeType="Sprite",t.prototype.build=function(o){if(o.define("SPRITE"),o.requires.lights=!1,o.requires.transparent=void 0!==this.alpha,o.isShader("vertex")){var i=this.position?this.position.analyzeAndFlow(o,"v3",{cache:"position"}):void 0;o.mergeUniform(e.UniformsUtils.merge([e.UniformsLib.fog])),o.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),l=["#include <clipping_planes_fragment>","#include <begin_vertex>"],i&&l.push(i.code,i.result?"transformed = "+i.result+";":""),l.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||l.push("modelMtx[1][1] = 1.0;"),l.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&l.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),l.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{o.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),o.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(o),this.alpha&&this.alpha.analyze(o),this.color.analyze(o,{slot:"color"});var t=this.mask?this.mask.flow(o,"b"):void 0,s=this.alpha?this.alpha.flow(o,"f"):void 0,r=this.color.flow(o,"c",{slot:"color"}),l=[];t&&l.push(t.code,"if ( ! "+t.result+" ) discard;"),s?l.push(s.code,"#ifdef ALPHATEST","if ( "+s.result+" <= ALPHATEST ) discard;","#endif",r.code,"gl_FragColor = vec4( "+r.result+", "+s.result+" );"):l.push(r.code,"gl_FragColor = vec4( "+r.result+", 1.0 );"),l.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return l.join("\n")},t.prototype.copy=function(e){return o.Node.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,void 0!==e.spherical&&(this.spherical=e.spherical),e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),this},t.prototype.toJSON=function(e){var o=this.getJSONNode(e);return o||(o=this.createJSONNode(e),this.position&&(o.position=this.position.toJSON(e).uuid),o.color=this.color.toJSON(e).uuid,!1===this.spherical&&(o.spherical=!1),this.mask&&(o.mask=this.mask.toJSON(e).uuid),this.alpha&&(o.alpha=this.alpha.toJSON(e).uuid)),o},exports.SpriteNode=t;
