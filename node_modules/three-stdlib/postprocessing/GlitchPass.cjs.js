"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e=require("./Pass.cjs.js"),r=require("../shaders/DigitalGlitch.cjs.js");require("@babel/runtime/helpers/createClass"),require("@babel/runtime/helpers/defineProperty");var i=function(i){void 0===r.DigitalGlitch&&console.error("THREE.GlitchPass relies on DigitalGlitch");var a=r.DigitalGlitch;this.uniforms=t.UniformsUtils.clone(a.uniforms),null==i&&(i=64),this.uniforms.tDisp.value=this.generateHeightmap(i),this.material=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.fsQuad=new e.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()};i.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:i,render:function(e,r,i){this.uniforms.tDiffuse.value=i.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=t.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=t.MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=t.MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=t.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=t.MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=t.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=t.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=t.MathUtils.randFloat(0,1),this.uniforms.seed_x.value=t.MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=t.MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=t.MathUtils.randInt(120,240)},generateHeightmap:function(e){for(var r=new Float32Array(e*e*3),i=e*e,a=0;a<i;a++){var s=t.MathUtils.randFloat(0,1);r[3*a+0]=s,r[3*a+1]=s,r[3*a+2]=s}return new t.DataTexture(r,e,e,t.RGBFormat,t.FloatType)}}),exports.GlitchPass=i;
