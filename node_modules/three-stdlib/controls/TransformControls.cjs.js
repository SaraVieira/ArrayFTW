"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/assertThisInitialized"),t=require("@babel/runtime/helpers/inheritsLoose"),n=require("@babel/runtime/helpers/defineProperty"),a=require("three");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e),i=o(t),l=o(n),u=function(e){function t(t,n){var o;o=e.call(this)||this,l.default(r.default(o),"isTransformControls",!0),l.default(r.default(o),"visible",!1),l.default(r.default(o),"domElement",void 0),l.default(r.default(o),"raycaster",new a.Raycaster),l.default(r.default(o),"gizmo",void 0),l.default(r.default(o),"plane",void 0),l.default(r.default(o),"tempVector",new a.Vector3),l.default(r.default(o),"tempVector2",new a.Vector3),l.default(r.default(o),"tempQuaternion",new a.Quaternion),l.default(r.default(o),"unit",{X:new a.Vector3(1,0,0),Y:new a.Vector3(0,1,0),Z:new a.Vector3(0,0,1)}),l.default(r.default(o),"pointStart",new a.Vector3),l.default(r.default(o),"pointEnd",new a.Vector3),l.default(r.default(o),"offset",new a.Vector3),l.default(r.default(o),"rotationAxis",new a.Vector3),l.default(r.default(o),"startNorm",new a.Vector3),l.default(r.default(o),"endNorm",new a.Vector3),l.default(r.default(o),"rotationAngle",0),l.default(r.default(o),"cameraPosition",new a.Vector3),l.default(r.default(o),"cameraQuaternion",new a.Quaternion),l.default(r.default(o),"cameraScale",new a.Vector3),l.default(r.default(o),"parentPosition",new a.Vector3),l.default(r.default(o),"parentQuaternion",new a.Quaternion),l.default(r.default(o),"parentQuaternionInv",new a.Quaternion),l.default(r.default(o),"parentScale",new a.Vector3),l.default(r.default(o),"worldPositionStart",new a.Vector3),l.default(r.default(o),"worldQuaternionStart",new a.Quaternion),l.default(r.default(o),"worldScaleStart",new a.Vector3),l.default(r.default(o),"worldPosition",new a.Vector3),l.default(r.default(o),"worldQuaternion",new a.Quaternion),l.default(r.default(o),"worldQuaternionInv",new a.Quaternion),l.default(r.default(o),"worldScale",new a.Vector3),l.default(r.default(o),"eye",new a.Vector3),l.default(r.default(o),"positionStart",new a.Vector3),l.default(r.default(o),"quaternionStart",new a.Quaternion),l.default(r.default(o),"scaleStart",new a.Vector3),l.default(r.default(o),"camera",void 0),l.default(r.default(o),"object",void 0),l.default(r.default(o),"enabled",!0),l.default(r.default(o),"axis",null),l.default(r.default(o),"mode","translate"),l.default(r.default(o),"translationSnap",null),l.default(r.default(o),"rotationSnap",null),l.default(r.default(o),"scaleSnap",null),l.default(r.default(o),"space","world"),l.default(r.default(o),"size",1),l.default(r.default(o),"dragging",!1),l.default(r.default(o),"showX",!0),l.default(r.default(o),"showY",!0),l.default(r.default(o),"showZ",!0),l.default(r.default(o),"changeEvent",{type:"change"}),l.default(r.default(o),"mouseDownEvent",{type:"mouseDown"}),l.default(r.default(o),"mouseUpEvent",{type:"mouseUp",mode:o.mode}),l.default(r.default(o),"objectChangeEvent",{type:"objectChange"}),l.default(r.default(o),"intersectObjectWithRay",(function(e,t,n){for(var a=t.intersectObject(e,!0),o=0;o<a.length;o++)if(a[o].object.visible||n)return a[o];return!1})),l.default(r.default(o),"attach",(function(e){return o.object=e,o.visible=!0,r.default(o)})),l.default(r.default(o),"detach",(function(){return o.object=void 0,o.visible=!1,o.axis=null,r.default(o)})),l.default(r.default(o),"updateMatrixWorld",(function(){void 0!==o.object&&(o.object.updateMatrixWorld(),null===o.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):o.object.parent.matrixWorld.decompose(o.parentPosition,o.parentQuaternion,o.parentScale),o.object.matrixWorld.decompose(o.worldPosition,o.worldQuaternion,o.worldScale),o.parentQuaternionInv.copy(o.parentQuaternion).invert(),o.worldQuaternionInv.copy(o.worldQuaternion).invert()),o.camera.updateMatrixWorld(),o.camera.matrixWorld.decompose(o.cameraPosition,o.cameraQuaternion,o.cameraScale),o.eye.copy(o.cameraPosition).sub(o.worldPosition).normalize(),e.prototype.updateMatrixWorld.call(r.default(o))})),l.default(r.default(o),"pointerHover",(function(e){if(void 0!==o.object&&!0!==o.dragging){o.raycaster.setFromCamera(e,o.camera);var t=o.intersectObjectWithRay(o.gizmo.picker[o.mode],o.raycaster);o.axis=t?t.object.name:null}})),l.default(r.default(o),"pointerDown",(function(e){if(void 0!==o.object&&!0!==o.dragging&&0===e.button&&null!==o.axis){o.raycaster.setFromCamera(e,o.camera);var t=o.intersectObjectWithRay(o.plane,o.raycaster,!0);if(t){var n=o.space;if("scale"===o.mode?n="local":"E"!==o.axis&&"XYZE"!==o.axis&&"XYZ"!==o.axis||(n="world"),"local"===n&&"rotate"===o.mode){var a=o.rotationSnap;"X"===o.axis&&a&&(o.object.rotation.x=Math.round(o.object.rotation.x/a)*a),"Y"===o.axis&&a&&(o.object.rotation.y=Math.round(o.object.rotation.y/a)*a),"Z"===o.axis&&a&&(o.object.rotation.z=Math.round(o.object.rotation.z/a)*a)}o.object.updateMatrixWorld(),o.object.parent&&o.object.parent.updateMatrixWorld(),o.positionStart.copy(o.object.position),o.quaternionStart.copy(o.object.quaternion),o.scaleStart.copy(o.object.scale),o.object.matrixWorld.decompose(o.worldPositionStart,o.worldQuaternionStart,o.worldScaleStart),o.pointStart.copy(t.point).sub(o.worldPositionStart)}o.dragging=!0,o.mouseDownEvent.type=o.mode,o.dispatchEvent(o.mouseDownEvent)}})),l.default(r.default(o),"pointerMove",(function(e){var t=o.axis,n=o.mode,a=o.object,r=o.space;if("scale"===n?r="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(r="world"),void 0!==a&&null!==t&&!1!==o.dragging&&-1===e.button){o.raycaster.setFromCamera(e,o.camera);var i=o.intersectObjectWithRay(o.plane,o.raycaster,!0);if(i){if(o.pointEnd.copy(i.point).sub(o.worldPositionStart),"translate"===n)o.offset.copy(o.pointEnd).sub(o.pointStart),"local"===r&&"XYZ"!==t&&o.offset.applyQuaternion(o.worldQuaternionInv),-1===t.indexOf("X")&&(o.offset.x=0),-1===t.indexOf("Y")&&(o.offset.y=0),-1===t.indexOf("Z")&&(o.offset.z=0),"local"===r&&"XYZ"!==t?o.offset.applyQuaternion(o.quaternionStart).divide(o.parentScale):o.offset.applyQuaternion(o.parentQuaternionInv).divide(o.parentScale),a.position.copy(o.offset).add(o.positionStart),o.translationSnap&&("local"===r&&(a.position.applyQuaternion(o.tempQuaternion.copy(o.quaternionStart).invert()),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/o.translationSnap)*o.translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/o.translationSnap)*o.translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/o.translationSnap)*o.translationSnap),a.position.applyQuaternion(o.quaternionStart)),"world"===r&&(a.parent&&a.position.add(o.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/o.translationSnap)*o.translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/o.translationSnap)*o.translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/o.translationSnap)*o.translationSnap),a.parent&&a.position.sub(o.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var l=o.pointEnd.length()/o.pointStart.length();o.pointEnd.dot(o.pointStart)<0&&(l*=-1),o.tempVector2.set(l,l,l)}else o.tempVector.copy(o.pointStart),o.tempVector2.copy(o.pointEnd),o.tempVector.applyQuaternion(o.worldQuaternionInv),o.tempVector2.applyQuaternion(o.worldQuaternionInv),o.tempVector2.divide(o.tempVector),-1===t.search("X")&&(o.tempVector2.x=1),-1===t.search("Y")&&(o.tempVector2.y=1),-1===t.search("Z")&&(o.tempVector2.z=1);a.scale.copy(o.scaleStart).multiply(o.tempVector2),o.scaleSnap&&o.object&&(-1!==t.search("X")&&(o.object.scale.x=Math.round(a.scale.x/o.scaleSnap)*o.scaleSnap||o.scaleSnap),-1!==t.search("Y")&&(a.scale.y=Math.round(a.scale.y/o.scaleSnap)*o.scaleSnap||o.scaleSnap),-1!==t.search("Z")&&(a.scale.z=Math.round(a.scale.z/o.scaleSnap)*o.scaleSnap||o.scaleSnap))}else if("rotate"===n){o.offset.copy(o.pointEnd).sub(o.pointStart);var u=20/o.worldPosition.distanceTo(o.tempVector.setFromMatrixPosition(o.camera.matrixWorld));"E"===t?(o.rotationAxis.copy(o.eye),o.rotationAngle=o.pointEnd.angleTo(o.pointStart),o.startNorm.copy(o.pointStart).normalize(),o.endNorm.copy(o.pointEnd).normalize(),o.rotationAngle*=o.endNorm.cross(o.startNorm).dot(o.eye)<0?1:-1):"XYZE"===t?(o.rotationAxis.copy(o.offset).cross(o.eye).normalize(),o.rotationAngle=o.offset.dot(o.tempVector.copy(o.rotationAxis).cross(o.eye))*u):"X"!==t&&"Y"!==t&&"Z"!==t||(o.rotationAxis.copy(o.unit[t]),o.tempVector.copy(o.unit[t]),"local"===r&&o.tempVector.applyQuaternion(o.worldQuaternion),o.rotationAngle=o.offset.dot(o.tempVector.cross(o.eye).normalize())*u),o.rotationSnap&&(o.rotationAngle=Math.round(o.rotationAngle/o.rotationSnap)*o.rotationSnap),"local"===r&&"E"!==t&&"XYZE"!==t?(a.quaternion.copy(o.quaternionStart),a.quaternion.multiply(o.tempQuaternion.setFromAxisAngle(o.rotationAxis,o.rotationAngle)).normalize()):(o.rotationAxis.applyQuaternion(o.parentQuaternionInv),a.quaternion.copy(o.tempQuaternion.setFromAxisAngle(o.rotationAxis,o.rotationAngle)),a.quaternion.multiply(o.quaternionStart).normalize())}o.dispatchEvent(o.changeEvent),o.dispatchEvent(o.objectChangeEvent)}}})),l.default(r.default(o),"pointerUp",(function(e){0===e.button&&(o.dragging&&null!==o.axis&&(o.mouseUpEvent.mode=o.mode,o.dispatchEvent(o.mouseUpEvent)),o.dragging=!1,o.axis=null)})),l.default(r.default(o),"getPointer",(function(e){var t;if(o.domElement&&null!==(t=o.domElement.ownerDocument)&&void 0!==t&&t.pointerLockElement)return{x:0,y:0,button:e.button};var n,a=e.changedTouches?e.changedTouches[0]:e,r=null===(n=o.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(a.clientX-r.left)/r.width*2-1,y:-(a.clientY-r.top)/r.height*2+1,button:e.button}})),l.default(r.default(o),"onPointerHover",(function(e){if(o.enabled)switch(e.pointerType){case"mouse":case"pen":o.pointerHover(o.getPointer(e))}})),l.default(r.default(o),"onPointerDown",(function(e){var t;o.enabled&&(o.domElement.style.touchAction="none",null===(t=o.domElement.ownerDocument)||void 0===t||t.addEventListener("pointermove",o.onPointerMove),o.pointerHover(o.getPointer(e)),o.pointerDown(o.getPointer(e)))})),l.default(r.default(o),"onPointerMove",(function(e){o.enabled&&o.pointerMove(o.getPointer(e))})),l.default(r.default(o),"onPointerUp",(function(e){var t;o.enabled&&(o.domElement.style.touchAction="",null===(t=o.domElement.ownerDocument)||void 0===t||t.removeEventListener("pointermove",o.onPointerMove),o.pointerUp(o.getPointer(e)))})),l.default(r.default(o),"getMode",(function(){return o.mode})),l.default(r.default(o),"setMode",(function(e){o.mode=e})),l.default(r.default(o),"setTranslationSnap",(function(e){o.translationSnap=e})),l.default(r.default(o),"setRotationSnap",(function(e){o.rotationSnap=e})),l.default(r.default(o),"setScaleSnap",(function(e){o.scaleSnap=e})),l.default(r.default(o),"setSize",(function(e){o.size=e})),l.default(r.default(o),"setSpace",(function(e){o.space=e})),l.default(r.default(o),"update",(function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")})),l.default(r.default(o),"dispose",(function(){var e,t;o.domElement.removeEventListener("pointerdown",o.onPointerDown),o.domElement.removeEventListener("pointermove",o.onPointerHover),null===(e=o.domElement.ownerDocument)||void 0===e||e.removeEventListener("pointermove",o.onPointerMove),null===(t=o.domElement.ownerDocument)||void 0===t||t.removeEventListener("pointerup",o.onPointerUp),o.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))})),void 0===n&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),o.domElement=document),o.domElement=n,o.camera=t,o.gizmo=new d,o.add(o.gizmo),o.plane=new s,o.add(o.plane);var i=function(e,t){var n=t;Object.defineProperty(r.default(o),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),o[e]=t,o.plane[e]=t,o.gizmo[e]=t};return i("camera",o.camera),i("object",o.object),i("enabled",o.enabled),i("axis",o.axis),i("mode",o.mode),i("translationSnap",o.translationSnap),i("rotationSnap",o.rotationSnap),i("scaleSnap",o.scaleSnap),i("space",o.space),i("size",o.size),i("dragging",o.dragging),i("showX",o.showX),i("showY",o.showY),i("showZ",o.showZ),i("worldPosition",o.worldPosition),i("worldPositionStart",o.worldPositionStart),i("worldQuaternion",o.worldQuaternion),i("worldQuaternionStart",o.worldQuaternionStart),i("cameraPosition",o.cameraPosition),i("cameraQuaternion",o.cameraQuaternion),i("pointStart",o.pointStart),i("pointEnd",o.pointEnd),i("rotationAxis",o.rotationAxis),i("rotationAngle",o.rotationAngle),i("eye",o.eye),n.addEventListener("pointerdown",o.onPointerDown),n.addEventListener("pointermove",o.onPointerHover),o.domElement.ownerDocument.addEventListener("pointerup",o.onPointerUp),o}return i.default(t,e),t}(a.Object3D),d=function(e){function t(){var t;t=e.call(this)||this,l.default(r.default(t),"isTransformControlsGizmo",!0),l.default(r.default(t),"type","TransformControlsGizmo"),l.default(r.default(t),"tempVector",new a.Vector3(0,0,0)),l.default(r.default(t),"tempEuler",new a.Euler),l.default(r.default(t),"alignVector",new a.Vector3(0,1,0)),l.default(r.default(t),"zeroVector",new a.Vector3(0,0,0)),l.default(r.default(t),"lookAtMatrix",new a.Matrix4),l.default(r.default(t),"tempQuaternion",new a.Quaternion),l.default(r.default(t),"tempQuaternion2",new a.Quaternion),l.default(r.default(t),"identityQuaternion",new a.Quaternion),l.default(r.default(t),"unitX",new a.Vector3(1,0,0)),l.default(r.default(t),"unitY",new a.Vector3(0,1,0)),l.default(r.default(t),"unitZ",new a.Vector3(0,0,1)),l.default(r.default(t),"gizmo",void 0),l.default(r.default(t),"picker",void 0),l.default(r.default(t),"helper",void 0),l.default(r.default(t),"rotationAxis",new a.Vector3),l.default(r.default(t),"cameraPosition",new a.Vector3),l.default(r.default(t),"worldPositionStart",new a.Vector3),l.default(r.default(t),"worldQuaternionStart",new a.Quaternion),l.default(r.default(t),"worldPosition",new a.Vector3),l.default(r.default(t),"worldQuaternion",new a.Quaternion),l.default(r.default(t),"eye",new a.Vector3),l.default(r.default(t),"camera",null),l.default(r.default(t),"enabled",!0),l.default(r.default(t),"axis",null),l.default(r.default(t),"mode","translate"),l.default(r.default(t),"space","world"),l.default(r.default(t),"size",1),l.default(r.default(t),"dragging",!1),l.default(r.default(t),"showX",!0),l.default(r.default(t),"showY",!0),l.default(r.default(t),"showZ",!0),l.default(r.default(t),"updateMatrixWorld",(function(){var n=t.space;"scale"===t.mode&&(n="local");var o="local"===n?t.worldQuaternion:t.identityQuaternion;t.gizmo.translate.visible="translate"===t.mode,t.gizmo.rotate.visible="rotate"===t.mode,t.gizmo.scale.visible="scale"===t.mode,t.helper.translate.visible="translate"===t.mode,t.helper.rotate.visible="rotate"===t.mode,t.helper.scale.visible="scale"===t.mode;var i=[];i=(i=(i=i.concat(t.picker[t.mode].children)).concat(t.gizmo[t.mode].children)).concat(t.helper[t.mode].children);for(var l=function(e){var n=i[e];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(t.worldPosition);var r=void 0;if(r=t.camera.isOrthographicCamera?(t.camera.top-t.camera.bottom)/t.camera.zoom:t.worldPosition.distanceTo(t.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*t.camera.fov/360)/t.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*t.size/7),"helper"===n.tag)return n.visible=!1,"AXIS"===n.name?(n.position.copy(t.worldPositionStart),n.visible=!!t.axis,"X"===t.axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,0,0)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t.eye))>.9&&(n.visible=!1)),"Y"===t.axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t.eye))>.9&&(n.visible=!1)),"Z"===t.axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t.eye))>.9&&(n.visible=!1)),"XYZE"===t.axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,Math.PI/2,0)),t.alignVector.copy(t.rotationAxis),n.quaternion.setFromRotationMatrix(t.lookAtMatrix.lookAt(t.zeroVector,t.alignVector,t.unitY)),n.quaternion.multiply(t.tempQuaternion),n.visible=t.dragging),"E"===t.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(t.worldPositionStart),n.visible=t.dragging):"END"===n.name?(n.position.copy(t.worldPosition),n.visible=t.dragging):"DELTA"===n.name?(n.position.copy(t.worldPositionStart),n.quaternion.copy(t.worldQuaternionStart),t.tempVector.set(1e-10,1e-10,1e-10).add(t.worldPositionStart).sub(t.worldPosition).multiplyScalar(-1),t.tempVector.applyQuaternion(t.worldQuaternionStart.clone().invert()),n.scale.copy(t.tempVector),n.visible=t.dragging):(n.quaternion.copy(o),t.dragging?n.position.copy(t.worldPositionStart):n.position.copy(t.worldPosition),t.axis&&(n.visible=-1!==t.axis.search(n.name))),"continue";if(n.quaternion.copy(o),"translate"===t.mode||"scale"===t.mode){var l=.99;"X"!==n.name&&"XYZX"!==n.name||Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t.eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t.eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t.eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===t.mode&&(t.tempQuaternion2.copy(o),t.alignVector.copy(t.eye).applyQuaternion(t.tempQuaternion.copy(o).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(t.lookAtMatrix.lookAt(t.eye,t.zeroVector,t.unitY)),"X"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitX,Math.atan2(-t.alignVector.y,t.alignVector.z)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)),"Y"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitY,Math.atan2(t.alignVector.x,t.alignVector.z)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)),"Z"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitZ,Math.atan2(t.alignVector.y,t.alignVector.x)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)));n.visible=n.visible&&(-1===n.name.indexOf("X")||t.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||t.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||t.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||t.showX&&t.showY&&t.showZ),n.material.opacity=n.material.opacity||n.material.opacity,n.material.color=n.material.color||n.material.color.clone(),n.material.color.copy(n.material.color),n.material.opacity=n.material.opacity,t.enabled?t.axis&&(n.name===t.axis||t.axis.split("").some((function(e){return n.name===e}))?(n.material.opacity=1,n.material.color.lerp(new a.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new a.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new a.Color(1,1,1),.5))},u=0;u<i.length;u++)l(u);e.prototype.updateMatrixWorld.call(r.default(t))}));var n=new a.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:a.DoubleSide,fog:!1,toneMapped:!1}),o=new a.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),i=n.clone();i.opacity=.15;var u=n.clone();u.opacity=.33;var d=n.clone();d.color.set(16711680);var s=n.clone();s.color.set(65280);var c=n.clone();c.color.set(255);var p=n.clone();p.opacity=.25;var f=p.clone();f.color.set(16776960);var m=p.clone();m.color.set(65535);var w=p.clone();w.color.set(16711935),n.clone().color.set(16776960);var h=o.clone();h.color.set(16711680);var y=o.clone();y.color.set(65280);var v=o.clone();v.color.set(255);var M=o.clone();M.color.set(65535);var b=o.clone();b.color.set(16711935);var g=o.clone();g.color.set(16776960);var Q=o.clone();Q.color.set(7895160);var P=g.clone();P.opacity=.25;var x=new a.CylinderGeometry(0,.05,.2,12,1,!1),V=new a.BoxGeometry(.125,.125,.125),S=new a.BufferGeometry;S.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,0,0],3));var E,Y=function(e,t){for(var n=new a.BufferGeometry,o=[],r=0;r<=64*t;++r)o.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return n.setAttribute("position",new a.Float32BufferAttribute(o,3)),n},X={X:[[new a.Mesh(x,d),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new a.Mesh(x,d),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new a.Line(S,h)]],Y:[[new a.Mesh(x,s),[0,1,0],null,null,"fwd"],[new a.Mesh(x,s),[0,1,0],[Math.PI,0,0],null,"bwd"],[new a.Line(S,y),null,[0,0,Math.PI/2]]],Z:[[new a.Mesh(x,c),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new a.Mesh(x,c),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new a.Line(S,v),null,[0,-Math.PI/2,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.1,0),p.clone()),[0,0,0],[0,0,0]]],XY:[[new a.Mesh(new a.PlaneGeometry(.295,.295),f.clone()),[.15,.15,0]],[new a.Line(S,g),[.18,.3,0],null,[.125,1,1]],[new a.Line(S,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a.Mesh(new a.PlaneGeometry(.295,.295),m.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new a.Line(S,M),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new a.Line(S,M),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a.Mesh(new a.PlaneGeometry(.295,.295),w.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new a.Line(S,b),[.18,0,.3],null,[.125,1,1]],[new a.Line(S,b),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},Z={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.2,0),i)]],XY:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},I={START:[[new a.Mesh(new a.OctahedronGeometry(.01,2),u),null,null,null,"helper"]],END:[[new a.Mesh(new a.OctahedronGeometry(.01,2),u),null,null,null,"helper"]],DELTA:[[new a.Line((E=new a.BufferGeometry,E.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,1,1],3)),E),u),null,null,null,"helper"]],X:[[new a.Line(S,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(S,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(S,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={X:[[new a.Line(Y(1,.5),h)],[new a.Mesh(new a.OctahedronGeometry(.04,0),d),[0,0,.99],null,[1,3,1]]],Y:[[new a.Line(Y(1,.5),y),null,[0,0,-Math.PI/2]],[new a.Mesh(new a.OctahedronGeometry(.04,0),s),[0,0,.99],null,[3,1,1]]],Z:[[new a.Line(Y(1,.5),v),null,[0,Math.PI/2,0]],[new a.Mesh(new a.OctahedronGeometry(.04,0),c),[.99,0,0],null,[1,3,1]]],E:[[new a.Line(Y(1.25,1),P),null,[0,Math.PI/2,0]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),P),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),P),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),P),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),P),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new a.Line(Y(1,1),Q),null,[0,Math.PI/2,0]]]},z={AXIS:[[new a.Line(S,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},j={X:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a.Mesh(new a.TorusGeometry(1.25,.1,2,24),i)]],XYZE:[[new a.Mesh(new a.SphereGeometry(.7,10,8),i)]]},L={X:[[new a.Mesh(V,d),[.8,0,0],[0,0,-Math.PI/2]],[new a.Line(S,h),null,null,[.8,1,1]]],Y:[[new a.Mesh(V,s),[0,.8,0]],[new a.Line(S,y),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new a.Mesh(V,c),[0,0,.8],[Math.PI/2,0,0]],[new a.Line(S,v),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new a.Mesh(V,f),[.85,.85,0],null,[2,2,.2]],[new a.Line(S,g),[.855,.98,0],null,[.125,1,1]],[new a.Line(S,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a.Mesh(V,m),[0,.85,.85],null,[.2,2,2]],[new a.Line(S,M),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new a.Line(S,M),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a.Mesh(V,w),[.85,0,.85],null,[2,.2,2]],[new a.Line(S,b),[.855,0,.98],null,[.125,1,1]],[new a.Line(S,b),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[1.1,0,0]]],XYZY:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[0,1.1,0]]],XYZZ:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[0,0,1.1]]]},G={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new a.Mesh(V,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new a.Mesh(V,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new a.Mesh(V,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[0,0,1.1]]]},T={X:[[new a.Line(S,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(S,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(S,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C=function(e){var t=new a.Object3D;for(var n in e)for(var o=e[n].length;o--;){var r=e[n][o][0].clone(),i=e[n][o][1],l=e[n][o][2],u=e[n][o][3],d=e[n][o][4];r.name=n,r.tag=d,i&&r.position.set(i[0],i[1],i[2]),l&&r.rotation.set(l[0],l[1],l[2]),u&&r.scale.set(u[0],u[1],u[2]),r.updateMatrix();var s=r.geometry.clone();s.applyMatrix4(r.matrix),r.geometry=s,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t};return t.gizmo={},t.picker={},t.helper={},t.add(t.gizmo.translate=C(X)),t.add(t.gizmo.rotate=C(A)),t.add(t.gizmo.scale=C(L)),t.add(t.picker.translate=C(Z)),t.add(t.picker.rotate=C(j)),t.add(t.picker.scale=C(G)),t.add(t.helper.translate=C(I)),t.add(t.helper.rotate=C(z)),t.add(t.helper.scale=C(T)),t.picker.translate.visible=!1,t.picker.rotate.visible=!1,t.picker.scale.visible=!1,t}return i.default(t,e),t}(a.Object3D),s=function(e){function t(){var t;return t=e.call(this,new a.PlaneGeometry(1e5,1e5,2,2),new a.MeshBasicMaterial({visible:!1,wireframe:!0,side:a.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))||this,l.default(r.default(t),"isTransformControlsPlane",!0),l.default(r.default(t),"type","TransformControlsPlane"),l.default(r.default(t),"unitX",new a.Vector3(1,0,0)),l.default(r.default(t),"unitY",new a.Vector3(0,1,0)),l.default(r.default(t),"unitZ",new a.Vector3(0,0,1)),l.default(r.default(t),"tempVector",new a.Vector3),l.default(r.default(t),"dirVector",new a.Vector3),l.default(r.default(t),"alignVector",new a.Vector3),l.default(r.default(t),"tempMatrix",new a.Matrix4),l.default(r.default(t),"identityQuaternion",new a.Quaternion),l.default(r.default(t),"cameraQuaternion",new a.Quaternion),l.default(r.default(t),"worldPosition",new a.Vector3),l.default(r.default(t),"worldQuaternion",new a.Quaternion),l.default(r.default(t),"eye",new a.Vector3),l.default(r.default(t),"axis",null),l.default(r.default(t),"mode","translate"),l.default(r.default(t),"space","world"),l.default(r.default(t),"updateMatrixWorld",(function(){var n=t.space;switch(t.position.copy(t.worldPosition),"scale"===t.mode&&(n="local"),t.unitX.set(1,0,0).applyQuaternion("local"===n?t.worldQuaternion:t.identityQuaternion),t.unitY.set(0,1,0).applyQuaternion("local"===n?t.worldQuaternion:t.identityQuaternion),t.unitZ.set(0,0,1).applyQuaternion("local"===n?t.worldQuaternion:t.identityQuaternion),t.alignVector.copy(t.unitY),t.mode){case"translate":case"scale":switch(t.axis){case"X":t.alignVector.copy(t.eye).cross(t.unitX),t.dirVector.copy(t.unitX).cross(t.alignVector);break;case"Y":t.alignVector.copy(t.eye).cross(t.unitY),t.dirVector.copy(t.unitY).cross(t.alignVector);break;case"Z":t.alignVector.copy(t.eye).cross(t.unitZ),t.dirVector.copy(t.unitZ).cross(t.alignVector);break;case"XY":t.dirVector.copy(t.unitZ);break;case"YZ":t.dirVector.copy(t.unitX);break;case"XZ":t.alignVector.copy(t.unitZ),t.dirVector.copy(t.unitY);break;case"XYZ":case"E":t.dirVector.set(0,0,0)}break;case"rotate":default:t.dirVector.set(0,0,0)}0===t.dirVector.length()?t.quaternion.copy(t.cameraQuaternion):(t.tempMatrix.lookAt(t.tempVector.set(0,0,0),t.dirVector,t.alignVector),t.quaternion.setFromRotationMatrix(t.tempMatrix)),e.prototype.updateMatrixWorld.call(r.default(t))})),t}return i.default(t,e),t}(a.Mesh);exports.TransformControls=u,exports.TransformControlsGizmo=d,exports.TransformControlsPlane=s;
