"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/assertThisInitialized"),t=require("@babel/runtime/helpers/inheritsLoose"),o=require("@babel/runtime/helpers/defineProperty"),n=require("three");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=a(e),c=a(t),u=a(o),d=function(e){function t(t,o){var a;return a=e.call(this)||this,u.default(r.default(a),"enabled",!0),u.default(r.default(a),"screen",{left:0,top:0,width:0,height:0}),u.default(r.default(a),"rotateSpeed",1),u.default(r.default(a),"zoomSpeed",1.2),u.default(r.default(a),"panSpeed",.3),u.default(r.default(a),"noRotate",!1),u.default(r.default(a),"noZoom",!1),u.default(r.default(a),"noPan",!1),u.default(r.default(a),"staticMoving",!1),u.default(r.default(a),"dynamicDampingFactor",.2),u.default(r.default(a),"minDistance",0),u.default(r.default(a),"maxDistance",1/0),u.default(r.default(a),"keys",[65,83,68]),u.default(r.default(a),"mouseButtons",{LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.DOLLY,RIGHT:n.MOUSE.PAN}),u.default(r.default(a),"object",void 0),u.default(r.default(a),"domElement",void 0),u.default(r.default(a),"target",new n.Vector3),u.default(r.default(a),"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),u.default(r.default(a),"EPS",1e-6),u.default(r.default(a),"lastPosition",new n.Vector3),u.default(r.default(a),"lastZoom",1),u.default(r.default(a),"_state",a.STATE.NONE),u.default(r.default(a),"_keyState",a.STATE.NONE),u.default(r.default(a),"_eye",new n.Vector3),u.default(r.default(a),"_movePrev",new n.Vector2),u.default(r.default(a),"_moveCurr",new n.Vector2),u.default(r.default(a),"_lastAxis",new n.Vector3),u.default(r.default(a),"_lastAngle",0),u.default(r.default(a),"_zoomStart",new n.Vector2),u.default(r.default(a),"_zoomEnd",new n.Vector2),u.default(r.default(a),"_touchZoomDistanceStart",0),u.default(r.default(a),"_touchZoomDistanceEnd",0),u.default(r.default(a),"_panStart",new n.Vector2),u.default(r.default(a),"_panEnd",new n.Vector2),u.default(r.default(a),"target0",void 0),u.default(r.default(a),"position0",void 0),u.default(r.default(a),"up0",void 0),u.default(r.default(a),"zoom0",void 0),u.default(r.default(a),"changeEvent",{type:"change"}),u.default(r.default(a),"startEvent",{type:"start"}),u.default(r.default(a),"endEvent",{type:"end"}),u.default(r.default(a),"onScreenVector",new n.Vector2),u.default(r.default(a),"getMouseOnScreen",(function(e,t){return a.onScreenVector.set((e-a.screen.left)/a.screen.width,(t-a.screen.top)/a.screen.height),a.onScreenVector})),u.default(r.default(a),"onCircleVector",new n.Vector2),u.default(r.default(a),"getMouseOnCircle",(function(e,t){return a.onCircleVector.set((e-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-t))/a.screen.width),a.onCircleVector})),u.default(r.default(a),"axis",new n.Vector3),u.default(r.default(a),"quaternion",new n.Quaternion),u.default(r.default(a),"eyeDirection",new n.Vector3),u.default(r.default(a),"objectUpDirection",new n.Vector3),u.default(r.default(a),"objectSidewaysDirection",new n.Vector3),u.default(r.default(a),"moveDirection",new n.Vector3),u.default(r.default(a),"angle",0),u.default(r.default(a),"rotateCamera",(function(){a.moveDirection.set(a._moveCurr.x-a._movePrev.x,a._moveCurr.y-a._movePrev.y,0),a.angle=a.moveDirection.length(),a.angle?(a._eye.copy(a.object.position).sub(a.target),a.eyeDirection.copy(a._eye).normalize(),a.objectUpDirection.copy(a.object.up).normalize(),a.objectSidewaysDirection.crossVectors(a.objectUpDirection,a.eyeDirection).normalize(),a.objectUpDirection.setLength(a._moveCurr.y-a._movePrev.y),a.objectSidewaysDirection.setLength(a._moveCurr.x-a._movePrev.x),a.moveDirection.copy(a.objectUpDirection.add(a.objectSidewaysDirection)),a.axis.crossVectors(a.moveDirection,a._eye).normalize(),a.angle*=a.rotateSpeed,a.quaternion.setFromAxisAngle(a.axis,a.angle),a._eye.applyQuaternion(a.quaternion),a.object.up.applyQuaternion(a.quaternion),a._lastAxis.copy(a.axis),a._lastAngle=a.angle):!a.staticMoving&&a._lastAngle&&(a._lastAngle*=Math.sqrt(1-a.dynamicDampingFactor),a._eye.copy(a.object.position).sub(a.target),a.quaternion.setFromAxisAngle(a._lastAxis,a._lastAngle),a._eye.applyQuaternion(a.quaternion),a.object.up.applyQuaternion(a.quaternion)),a._movePrev.copy(a._moveCurr)})),u.default(r.default(a),"zoomCamera",(function(){var e;a._state===a.STATE.TOUCH_ZOOM_PAN?(e=a._touchZoomDistanceStart/a._touchZoomDistanceEnd,a._touchZoomDistanceStart=a._touchZoomDistanceEnd,a.object.isPerspectiveCamera?a._eye.multiplyScalar(e):a.object.isOrthographicCamera?(a.object.zoom*=e,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(a._zoomEnd.y-a._zoomStart.y)*a.zoomSpeed)&&e>0&&(a.object.isPerspectiveCamera?a._eye.multiplyScalar(e):a.object.isOrthographicCamera?(a.object.zoom/=e,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),a.staticMoving?a._zoomStart.copy(a._zoomEnd):a._zoomStart.y+=(a._zoomEnd.y-a._zoomStart.y)*a.dynamicDampingFactor)})),u.default(r.default(a),"mouseChange",new n.Vector2),u.default(r.default(a),"objectUp",new n.Vector3),u.default(r.default(a),"pan",new n.Vector3),u.default(r.default(a),"panCamera",(function(){if(a.mouseChange.copy(a._panEnd).sub(a._panStart),a.mouseChange.lengthSq()){if(a.object.isOrthographicCamera){var e=a.object,t=(e.right-e.left)/a.object.zoom/a.domElement.clientWidth,o=(e.top-e.bottom)/a.object.zoom/a.domElement.clientWidth;a.mouseChange.x*=t,a.mouseChange.y*=o}a.mouseChange.multiplyScalar(a._eye.length()*a.panSpeed),a.pan.copy(a._eye).cross(a.object.up).setLength(a.mouseChange.x),a.pan.add(a.objectUp.copy(a.object.up).setLength(a.mouseChange.y)),a.object.position.add(a.pan),a.target.add(a.pan),a.staticMoving?a._panStart.copy(a._panEnd):a._panStart.add(a.mouseChange.subVectors(a._panEnd,a._panStart).multiplyScalar(a.dynamicDampingFactor))}})),u.default(r.default(a),"checkDistances",(function(){a.noZoom&&a.noPan||(a._eye.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,a._eye.setLength(a.maxDistance)),a._zoomStart.copy(a._zoomEnd)),a._eye.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,a._eye.setLength(a.minDistance)),a._zoomStart.copy(a._zoomEnd)))})),u.default(r.default(a),"handleResize",(function(){var e=a.domElement.getBoundingClientRect(),t=a.domElement.ownerDocument.documentElement;a.screen.left=e.left+window.pageXOffset-t.clientLeft,a.screen.top=e.top+window.pageYOffset-t.clientTop,a.screen.width=e.width,a.screen.height=e.height})),u.default(r.default(a),"update",(function(){a._eye.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,a._eye),a.object.isPerspectiveCamera?(a.checkDistances(),a.object.lookAt(a.target),a.lastPosition.distanceToSquared(a.object.position)>a.EPS&&(a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position))):a.object.isOrthographicCamera?(a.object.lookAt(a.target),(a.lastPosition.distanceToSquared(a.object.position)>a.EPS||a.lastZoom!==a.object.zoom)&&(a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position),a.lastZoom=a.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")})),u.default(r.default(a),"reset",(function(){a._state=a.STATE.NONE,a._keyState=a.STATE.NONE,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a._eye.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position),a.lastZoom=a.object.zoom})),u.default(r.default(a),"keydown",(function(e){!1!==a.enabled&&(window.removeEventListener("keydown",a.keydown),a._keyState===a.STATE.NONE&&(e.keyCode!==a.keys[a.STATE.ROTATE]||a.noRotate?e.keyCode!==a.keys[a.STATE.ZOOM]||a.noZoom?e.keyCode!==a.keys[a.STATE.PAN]||a.noPan||(a._keyState=a.STATE.PAN):a._keyState=a.STATE.ZOOM:a._keyState=a.STATE.ROTATE))})),u.default(r.default(a),"onPointerDown",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseDown(e)}})),u.default(r.default(a),"onPointerMove",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseMove(e)}})),u.default(r.default(a),"onPointerUp",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseUp(e)}})),u.default(r.default(a),"keyup",(function(){!1!==a.enabled&&(a._keyState=a.STATE.NONE,window.addEventListener("keydown",a.keydown))})),u.default(r.default(a),"onMouseDown",(function(e){if(e.preventDefault(),a._state===a.STATE.NONE)switch(e.button){case a.mouseButtons.LEFT:a._state=a.STATE.ROTATE;break;case a.mouseButtons.MIDDLE:a._state=a.STATE.ZOOM;break;case a.mouseButtons.RIGHT:a._state=a.STATE.PAN;break;default:a._state=a.STATE.NONE}var t=a._keyState!==a.STATE.NONE?a._keyState:a._state;t!==a.STATE.ROTATE||a.noRotate?t!==a.STATE.ZOOM||a.noZoom?t!==a.STATE.PAN||a.noPan||(a._panStart.copy(a.getMouseOnScreen(e.pageX,e.pageY)),a._panEnd.copy(a._panStart)):(a._zoomStart.copy(a.getMouseOnScreen(e.pageX,e.pageY)),a._zoomEnd.copy(a._zoomStart)):(a._moveCurr.copy(a.getMouseOnCircle(e.pageX,e.pageY)),a._movePrev.copy(a._moveCurr)),a.domElement.ownerDocument.addEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.addEventListener("pointerup",a.onPointerUp),a.dispatchEvent(a.startEvent)})),u.default(r.default(a),"onMouseMove",(function(e){if(!1!==a.enabled){e.preventDefault();var t=a._keyState!==a.STATE.NONE?a._keyState:a._state;t!==a.STATE.ROTATE||a.noRotate?t!==a.STATE.ZOOM||a.noZoom?t!==a.STATE.PAN||a.noPan||a._panEnd.copy(a.getMouseOnScreen(e.pageX,e.pageY)):a._zoomEnd.copy(a.getMouseOnScreen(e.pageX,e.pageY)):(a._movePrev.copy(a._moveCurr),a._moveCurr.copy(a.getMouseOnCircle(e.pageX,e.pageY)))}})),u.default(r.default(a),"onMouseUp",(function(e){!1!==a.enabled&&(e.preventDefault(),a._state=a.STATE.NONE,a.domElement.ownerDocument.removeEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.removeEventListener("pointerup",a.onPointerUp),a.dispatchEvent(a.endEvent))})),u.default(r.default(a),"mousewheel",(function(e){if(!1!==a.enabled&&!0!==a.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:a._zoomStart.y-=.025*e.deltaY;break;case 1:a._zoomStart.y-=.01*e.deltaY;break;default:a._zoomStart.y-=25e-5*e.deltaY}a.dispatchEvent(a.startEvent),a.dispatchEvent(a.endEvent)}})),u.default(r.default(a),"touchstart",(function(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:a._state=a.STATE.TOUCH_ROTATE,a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),a._movePrev.copy(a._moveCurr);break;default:a._state=a.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;a._touchZoomDistanceEnd=a._touchZoomDistanceStart=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;a._panStart.copy(a.getMouseOnScreen(n,r)),a._panEnd.copy(a._panStart)}a.dispatchEvent(a.startEvent)}})),u.default(r.default(a),"touchmove",(function(e){if(!1!==a.enabled)switch(e.preventDefault(),e.touches.length){case 1:a._movePrev.copy(a._moveCurr),a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;a._touchZoomDistanceEnd=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;a._panEnd.copy(a.getMouseOnScreen(n,r))}})),u.default(r.default(a),"touchend",(function(e){if(!1!==a.enabled){switch(e.touches.length){case 0:a._state=a.STATE.NONE;break;case 1:a._state=a.STATE.TOUCH_ROTATE,a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),a._movePrev.copy(a._moveCurr)}a.dispatchEvent(a.endEvent)}})),u.default(r.default(a),"contextmenu",(function(e){!1!==a.enabled&&e.preventDefault()})),u.default(r.default(a),"dispose",(function(){a.domElement.removeEventListener("contextmenu",a.contextmenu),a.domElement.removeEventListener("pointerdown",a.onPointerDown),a.domElement.removeEventListener("wheel",a.mousewheel),a.domElement.removeEventListener("touchstart",a.touchstart),a.domElement.removeEventListener("touchend",a.touchend),a.domElement.removeEventListener("touchmove",a.touchmove),a.domElement.ownerDocument.removeEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.removeEventListener("pointerup",a.onPointerUp),window.removeEventListener("keydown",a.keydown),window.removeEventListener("keyup",a.keyup)})),void 0===o&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),a.object=t,a.domElement=o,a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.up0=a.object.up.clone(),a.zoom0=a.object.zoom,a.domElement.addEventListener("contextmenu",a.contextmenu),a.domElement.addEventListener("pointerdown",a.onPointerDown),a.domElement.addEventListener("wheel",a.mousewheel),a.domElement.addEventListener("touchstart",a.touchstart),a.domElement.addEventListener("touchend",a.touchend),a.domElement.addEventListener("touchmove",a.touchmove),a.domElement.ownerDocument.addEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.addEventListener("pointerup",a.onPointerUp),window.addEventListener("keydown",a.keydown),window.addEventListener("keyup",a.keyup),a.handleResize(),a.update(),a}return c.default(t,e),t}(n.EventDispatcher);exports.TrackballControls=d;
