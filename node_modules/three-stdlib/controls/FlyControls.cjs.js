"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/assertThisInitialized"),t=require("@babel/runtime/helpers/inheritsLoose"),o=require("@babel/runtime/helpers/defineProperty"),a=require("three");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),u=n(t),d=n(o);function i(e){e.preventDefault()}var m=function(e){function t(t,o){var n;return n=e.call(this)||this,d.default(r.default(n),"object",void 0),d.default(r.default(n),"domElement",void 0),d.default(r.default(n),"movementSpeed",1),d.default(r.default(n),"rollSpeed",.005),d.default(r.default(n),"dragToLook",!1),d.default(r.default(n),"autoForward",!1),d.default(r.default(n),"changeEvent",{type:"change"}),d.default(r.default(n),"EPS",1e-6),d.default(r.default(n),"tmpQuaternion",new a.Quaternion),d.default(r.default(n),"mouseStatus",0),d.default(r.default(n),"movementSpeedMultiplier",1),d.default(r.default(n),"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),d.default(r.default(n),"moveVector",new a.Vector3(0,0,0)),d.default(r.default(n),"rotationVector",new a.Vector3(0,0,0)),d.default(r.default(n),"keydown",(function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":n.movementSpeedMultiplier=.1;break;case"KeyW":n.moveState.forward=1;break;case"KeyS":n.moveState.back=1;break;case"KeyA":n.moveState.left=1;break;case"KeyD":n.moveState.right=1;break;case"KeyR":n.moveState.up=1;break;case"KeyF":n.moveState.down=1;break;case"ArrowUp":n.moveState.pitchUp=1;break;case"ArrowDown":n.moveState.pitchDown=1;break;case"ArrowLeft":n.moveState.yawLeft=1;break;case"ArrowRight":n.moveState.yawRight=1;break;case"KeyQ":n.moveState.rollLeft=1;break;case"KeyE":n.moveState.rollRight=1}n.updateMovementVector(),n.updateRotationVector()}})),d.default(r.default(n),"keyup",(function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":n.movementSpeedMultiplier=1;break;case"KeyW":n.moveState.forward=0;break;case"KeyS":n.moveState.back=0;break;case"KeyA":n.moveState.left=0;break;case"KeyD":n.moveState.right=0;break;case"KeyR":n.moveState.up=0;break;case"KeyF":n.moveState.down=0;break;case"ArrowUp":n.moveState.pitchUp=0;break;case"ArrowDown":n.moveState.pitchDown=0;break;case"ArrowLeft":n.moveState.yawLeft=0;break;case"ArrowRight":n.moveState.yawRight=0;break;case"KeyQ":n.moveState.rollLeft=0;break;case"KeyE":n.moveState.rollRight=0}n.updateMovementVector(),n.updateRotationVector()})),d.default(r.default(n),"mousedown",(function(e){if(n.domElement===document||n.domElement instanceof Document||n.domElement.focus(),e.preventDefault(),n.dragToLook)n.mouseStatus++;else{switch(e.button){case 0:n.moveState.forward=1;break;case 2:n.moveState.back=1}n.updateMovementVector()}})),d.default(r.default(n),"mousemove",(function(e){if(!n.dragToLook||n.mouseStatus>0){var t=n.getContainerDimensions(),o=t.size[0]/2,a=t.size[1]/2;n.moveState.yawLeft=-(e.pageX-t.offset[0]-o)/o,n.moveState.pitchDown=(e.pageY-t.offset[1]-a)/a,n.updateRotationVector()}})),d.default(r.default(n),"mouseup",(function(e){if(e.preventDefault(),n.dragToLook)n.mouseStatus--,n.moveState.yawLeft=n.moveState.pitchDown=0;else{switch(e.button){case 0:n.moveState.forward=0;break;case 2:n.moveState.back=0}n.updateMovementVector()}n.updateRotationVector()})),d.default(r.default(n),"lastQuaternion",new a.Quaternion),d.default(r.default(n),"lastPosition",new a.Vector3),d.default(r.default(n),"update",(function(e){var t=e*n.movementSpeed,o=e*n.rollSpeed;n.object.translateX(n.moveVector.x*t),n.object.translateY(n.moveVector.y*t),n.object.translateZ(n.moveVector.z*t),n.tmpQuaternion.set(n.rotationVector.x*o,n.rotationVector.y*o,n.rotationVector.z*o,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(n.lastPosition.distanceToSquared(n.object.position)>n.EPS||8*(1-n.lastQuaternion.dot(n.object.quaternion))>n.EPS)&&(n.dispatchEvent(n.changeEvent),n.lastQuaternion.copy(n.object.quaternion),n.lastPosition.copy(n.object.position))})),d.default(r.default(n),"updateMovementVector",(function(){var e=n.moveState.forward||n.autoForward&&!n.moveState.back?1:0;n.moveVector.x=-n.moveState.left+n.moveState.right,n.moveVector.y=-n.moveState.down+n.moveState.up,n.moveVector.z=-e+n.moveState.back})),d.default(r.default(n),"updateRotationVector",(function(){n.rotationVector.x=-n.moveState.pitchDown+n.moveState.pitchUp,n.rotationVector.y=-n.moveState.yawRight+n.moveState.yawLeft,n.rotationVector.z=-n.moveState.rollRight+n.moveState.rollLeft})),d.default(r.default(n),"getContainerDimensions",(function(){return n.domElement==document||n.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[n.domElement.offsetWidth,n.domElement.offsetHeight],offset:[n.domElement.offsetLeft,n.domElement.offsetTop]}})),d.default(r.default(n),"dispose",(function(){n.domElement.removeEventListener("contextmenu",i),n.domElement.removeEventListener("mousemove",n.mousemove),n.domElement.removeEventListener("mousedown",n.mousedown),n.domElement.removeEventListener("mouseup",n.mouseup),window.removeEventListener("keydown",n.keydown),window.removeEventListener("keyup",n.keyup)})),void 0===o&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),o=document),n.object=t,n.domElement=o,!o||o instanceof Document||o.setAttribute("tabindex",-1),n.domElement.addEventListener("contextmenu",i),n.domElement.addEventListener("mousemove",n.mousemove),n.domElement.addEventListener("mousedown",n.mousedown),n.domElement.addEventListener("mouseup",n.mouseup),window.addEventListener("keydown",n.keydown),window.addEventListener("keyup",n.keyup),n.updateMovementVector(),n.updateRotationVector(),n}return u.default(t,e),t}(a.EventDispatcher);exports.FlyControls=m;
