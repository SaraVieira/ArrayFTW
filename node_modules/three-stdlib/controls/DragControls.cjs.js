"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/assertThisInitialized"),t=require("@babel/runtime/helpers/inheritsLoose"),n=require("@babel/runtime/helpers/defineProperty"),o=require("three");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(e),s=r(t),i=r(n),l=function(e){function t(t,n,r){var s;return s=e.call(this)||this,i.default(a.default(s),"enabled",!0),i.default(a.default(s),"transformGroup",!1),i.default(a.default(s),"_objects",void 0),i.default(a.default(s),"_camera",void 0),i.default(a.default(s),"_domElement",void 0),i.default(a.default(s),"_plane",new o.Plane),i.default(a.default(s),"_raycaster",new o.Raycaster),i.default(a.default(s),"_mouse",new o.Vector2),i.default(a.default(s),"_offset",new o.Vector3),i.default(a.default(s),"_intersection",new o.Vector3),i.default(a.default(s),"_worldPosition",new o.Vector3),i.default(a.default(s),"_inverseMatrix",new o.Matrix4),i.default(a.default(s),"_intersections",[]),i.default(a.default(s),"_selected",null),i.default(a.default(s),"_hovered",null),i.default(a.default(s),"activate",(function(){s._domElement.addEventListener("pointermove",s.onPointerMove),s._domElement.addEventListener("pointerdown",s.onPointerDown),s._domElement.addEventListener("pointerup",s.onPointerCancel),s._domElement.addEventListener("pointerleave",s.onPointerCancel),s._domElement.addEventListener("touchmove",s.onTouchMove),s._domElement.addEventListener("touchstart",s.onTouchStart),s._domElement.addEventListener("touchend",s.onTouchEnd)})),i.default(a.default(s),"deactivate",(function(){s._domElement.removeEventListener("pointermove",s.onPointerMove),s._domElement.removeEventListener("pointerdown",s.onPointerDown),s._domElement.removeEventListener("pointerup",s.onPointerCancel),s._domElement.removeEventListener("pointerleave",s.onPointerCancel),s._domElement.removeEventListener("touchmove",s.onTouchMove),s._domElement.removeEventListener("touchstart",s.onTouchStart),s._domElement.removeEventListener("touchend",s.onTouchEnd),s._domElement.style.cursor=""})),i.default(a.default(s),"dispose",(function(){return s.deactivate()})),i.default(a.default(s),"getObjects",(function(){return s._objects})),i.default(a.default(s),"onMouseMove",(function(e){var t=s._domElement.getBoundingClientRect();if(s._mouse.x=(e.clientX-t.left)/t.width*2-1,s._mouse.y=-(e.clientY-t.top)/t.height*2+1,s._raycaster.setFromCamera(s._mouse,s._camera),s._selected&&s.enabled)return s._raycaster.ray.intersectPlane(s._plane,s._intersection)&&s._selected.position.copy(s._intersection.sub(s._offset).applyMatrix4(s._inverseMatrix)),void s.dispatchEvent({type:"drag",object:s._selected});if(s._intersections.length=0,s._raycaster.setFromCamera(s._mouse,s._camera),s._raycaster.intersectObjects(s._objects,!0,s._intersections),s._intersections.length>0){var n=s._intersections[0].object;s._plane.setFromNormalAndCoplanarPoint(s._camera.getWorldDirection(s._plane.normal),s._worldPosition.setFromMatrixPosition(n.matrixWorld)),s._hovered!==n&&(s.dispatchEvent({type:"hoveron",object:n}),s._domElement.style.cursor="pointer",s._hovered=n)}else null!==s._hovered&&(s.dispatchEvent({type:"hoveroff",object:s._hovered}),s._domElement.style.cursor="auto",s._hovered=null)})),i.default(a.default(s),"onMouseDown",(function(e){e.preventDefault(),s._intersections.length=0,s._raycaster.setFromCamera(s._mouse,s._camera),s._raycaster.intersectObjects(s._objects,!0,s._intersections),s._intersections.length>0&&(s._selected=!0===s.transformGroup?s._objects[0]:s._intersections[0].object,s._raycaster.ray.intersectPlane(s._plane,s._intersection)&&s._selected.parent&&(s._inverseMatrix.copy(s._selected.parent.matrixWorld).invert(),s._offset.copy(s._intersection).sub(s._worldPosition.setFromMatrixPosition(s._selected.matrixWorld))),s._domElement.style.cursor="move",s.dispatchEvent({type:"dragstart",object:s._selected}))})),i.default(a.default(s),"onMouseCancel",(function(e){e.preventDefault(),s._selected&&(s.dispatchEvent({type:"dragend",object:s._selected}),s._selected=null),s._domElement.style.cursor=s._hovered?"pointer":"auto"})),i.default(a.default(s),"onPointerMove",(function(e){switch(e.preventDefault(),e.pointerType){case"mouse":case"pen":s.onMouseMove(e)}})),i.default(a.default(s),"onPointerDown",(function(e){switch(e.preventDefault(),e.pointerType){case"mouse":case"pen":s.onMouseDown(e)}})),i.default(a.default(s),"onPointerCancel",(function(e){switch(e.preventDefault(),e.pointerType){case"mouse":case"pen":s.onMouseCancel(e)}})),i.default(a.default(s),"onTouchMove",(function(e){e.preventDefault();var t=e.changedTouches[0],n=s._domElement.getBoundingClientRect();if(s._mouse.x=(t.clientX-n.left)/n.width*2-1,s._mouse.y=-(t.clientY-n.top)/n.height*2+1,s._raycaster.setFromCamera(s._mouse,s._camera),s._selected&&s.enabled)return s._raycaster.ray.intersectPlane(s._plane,s._intersection)&&s._selected.position.copy(s._intersection.sub(s._offset).applyMatrix4(s._inverseMatrix)),void s.dispatchEvent({type:"drag",object:s._selected})})),i.default(a.default(s),"onTouchStart",(function(e){e.preventDefault();var t=e.changedTouches[0],n=s._domElement.getBoundingClientRect();s._mouse.x=(t.clientX-n.left)/n.width*2-1,s._mouse.y=-(t.clientY-n.top)/n.height*2+1,s._intersections.length=0,s._raycaster.setFromCamera(s._mouse,s._camera),s._raycaster.intersectObjects(s._objects,!0,s._intersections),s._intersections.length>0&&(s._selected=!0===s.transformGroup?s._objects[0]:s._intersections[0].object,s._plane.setFromNormalAndCoplanarPoint(s._camera.getWorldDirection(s._plane.normal),s._worldPosition.setFromMatrixPosition(s._selected.matrixWorld)),s._raycaster.ray.intersectPlane(s._plane,s._intersection)&&s._selected.parent&&(s._inverseMatrix.copy(s._selected.parent.matrixWorld).invert(),s._offset.copy(s._intersection).sub(s._worldPosition.setFromMatrixPosition(s._selected.matrixWorld))),s._domElement.style.cursor="move",s.dispatchEvent({type:"dragstart",object:s._selected}))})),i.default(a.default(s),"onTouchEnd",(function(e){e.preventDefault(),s._selected&&(s.dispatchEvent({type:"dragend",object:s._selected}),s._selected=null),s._domElement.style.cursor="auto"})),s._objects=t,s._camera=n,s._domElement=r,s.activate(),s}return s.default(t,e),t}(o.EventDispatcher);exports.DragControls=l;
