"use strict";var e=function(){function e(e){this.buffers=new WeakMap,this.device=e}var t=e.prototype;return t.get=function(e){return this.buffers.get(e)},t.remove=function(e){var t=this.buffers.get(e);t&&(t.buffer.destroy(),this.buffers.delete(e))},t.update=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=null);var f=this.buffers.get(e);void 0===f?(null===r&&(r=!0===t?GPUBufferUsage.INDEX:GPUBufferUsage.VERTEX),f=this._createBuffer(e,r),this.buffers.set(e,f)):r&&r!==f.usage?(f.buffer.destroy(),f=this._createBuffer(e,r),this.buffers.set(e,f)):f.version<e.version&&(this._writeBuffer(f.buffer,e),f.version=e.version)},t._createBuffer=function(e,t){var r=e.array,f=r.byteLength+(4-r.byteLength%4)%4,u=this.device.createBuffer({size:f,usage:t|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new r.constructor(u.getMappedRange()).set(r),u.unmap(),e.onUploadCallback(),{version:e.version,buffer:u,usage:t}},t._writeBuffer=function(e,t){var r=t.array,f=t.updateRange;-1===f.count?this.device.queue.writeBuffer(e,0,r,0):(this.device.queue.writeBuffer(e,0,r,f.offset*r.BYTES_PER_ELEMENT,f.count*r.BYTES_PER_ELEMENT),f.count=-1)},e}();module.exports=e;
