"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),i=require("./Projector.cjs.js"),t=function(i){e.Object3D.call(this),this.node=i};(t.prototype=Object.create(e.Object3D.prototype)).constructor=t;exports.SVGObject=t,exports.SVGRenderer=function(){var o,r,n,s,a,c,l,p,d,h,f,u,S,y=this,m=new i.Projector,x=document.createElementNS("http://www.w3.org/2000/svg","svg"),v=new e.Box2,g=new e.Box2,w=new e.Color,b=new e.Color,M=new e.Color,z=new e.Color,C=new e.Color,j=new e.Color,k=new e.Vector3,L=new e.Vector3,P=new e.Vector3,B=new e.Matrix3,R=new e.Matrix4,E=new e.Matrix4,A=[],V=0,W=1,F=null;function G(){for(V=0;x.childNodes.length>0;)x.removeChild(x.childNodes[0])}function O(e){return null!==F?e.toFixed(F):e}function N(e,i,t){var o=i.scale.x*c,r=i.scale.y*l;t.isPointsMaterial&&(o*=t.size,r*=t.size);var n="M"+O(e.x-.5*o)+","+O(e.y-.5*r)+"h"+O(o)+"v"+O(r)+"h"+O(-o)+"z",s="";(t.isSpriteMaterial||t.isPointsMaterial)&&(s="fill:"+t.color.getStyle()+";fill-opacity:"+t.opacity),T(s,n)}function D(e,i,t,o){var r="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(i.positionScreen.x)+","+O(i.positionScreen.y);if(o.isLineBasicMaterial){var n="fill:none;stroke:"+o.color.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(n=n+";stroke-dasharray:"+o.dashSize+","+o.gapSize),T(n,r)}}function q(e,i,t,o,r){y.info.render.vertices+=3,y.info.render.faces++;var s="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(i.positionScreen.x)+","+O(i.positionScreen.y)+"L"+O(t.positionScreen.x)+","+O(t.positionScreen.y)+"z";r.isMeshBasicMaterial?(w.copy(r.color),r.vertexColors&&w.multiply(o.color)):r.isMeshLambertMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial?(b.copy(r.color),r.vertexColors&&b.multiply(o.color),w.copy(M),L.copy(e.positionWorld).add(i.positionWorld).add(t.positionWorld).divideScalar(3),function(e,i,t,o){for(var r=0,n=e.length;r<n;r++){var s=e[r],a=s.color;if(s.isDirectionalLight){var c=k.setFromMatrixPosition(s.matrixWorld).normalize();if((l=t.dot(c))<=0)continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}else if(s.isPointLight){var l;if(c=k.setFromMatrixPosition(s.matrixWorld),(l=t.dot(k.subVectors(c,i).normalize()))<=0)continue;if(0==(l*=0==s.distance?1:1-Math.min(i.distanceTo(c)/s.distance,1)))continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}}}(n,L,o.normalModel,w),w.multiply(b).add(r.emissive)):r.isMeshNormalMaterial&&(P.copy(o.normalModel).applyMatrix3(B).normalize(),w.setRGB(P.x,P.y,P.z).multiplyScalar(.5).addScalar(.5)),T(r.wireframe?"fill:none;stroke:"+w.getStyle()+";stroke-opacity:"+r.opacity+";stroke-width:"+r.wireframeLinewidth+";stroke-linecap:"+r.wireframeLinecap+";stroke-linejoin:"+r.wireframeLinejoin:"fill:"+w.getStyle()+";fill-opacity:"+r.opacity,s)}function I(e,i,t){var o,r=i.x-e.x,n=i.y-e.y,s=r*r+n*n;0!==s&&(r*=o=t/Math.sqrt(s),n*=o,i.x+=r,i.y+=n,e.x-=r,e.y-=n)}function T(e,i){S===e?u+=i:(_(),S=e,u=i)}function _(){u&&((f=function(e){if(null==A[e])return A[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==W&&A[e].setAttribute("shape-rendering","crispEdges"),A[e];return A[e]}(V++)).setAttribute("d",u),f.setAttribute("style",S),x.appendChild(f)),u="",S=""}this.domElement=x,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":W=1;break;case"low":W=0}},this.setClearColor=function(e){j.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,i){c=(s=e)/2,l=(a=i)/2,x.setAttribute("viewBox",-c+" "+-l+" "+s+" "+a),x.setAttribute("width",s),x.setAttribute("height",a),v.min.set(-c,-l),v.max.set(c,l)},this.getSize=function(){return{width:s,height:a}},this.setPrecision=function(e){F=e},this.clear=function(){G(),x.style.backgroundColor=j.getStyle()},this.render=function(s,a){if(a instanceof e.Camera!=!1){var f=s.background;f&&f.isColor?(G(),x.style.backgroundColor=f.getStyle()):!0===this.autoClear&&this.clear(),y.info.render.vertices=0,y.info.render.faces=0,R.copy(a.matrixWorldInverse),E.multiplyMatrices(a.projectionMatrix,R),o=m.projectScene(s,a,this.sortObjects,this.sortElements),r=o.elements,n=o.lights,B.getNormalMatrix(a.matrixWorldInverse),function(e){M.setRGB(0,0,0),z.setRGB(0,0,0),C.setRGB(0,0,0);for(var i=0,t=e.length;i<t;i++){var o=e[i],r=o.color;o.isAmbientLight?(M.r+=r.r,M.g+=r.g,M.b+=r.b):o.isDirectionalLight?(z.r+=r.r,z.g+=r.g,z.b+=r.b):o.isPointLight&&(C.r+=r.r,C.g+=r.g,C.b+=r.b)}}(n),u="",S="";for(var w=0,b=r.length;w<b;w++){var j=r[w],L=j.material;if(void 0!==L&&0!==L.opacity)if(g.makeEmpty(),j instanceof i.RenderableSprite)(p=j).x*=c,p.y*=-l,N(p,j,L);else if(j instanceof i.RenderableLine)p=j.v1,d=j.v2,p.positionScreen.x*=c,p.positionScreen.y*=-l,d.positionScreen.x*=c,d.positionScreen.y*=-l,g.setFromPoints([p.positionScreen,d.positionScreen]),!0===v.intersectsBox(g)&&D(p,d,j,L);else if(j instanceof i.RenderableFace){if(p=j.v1,d=j.v2,h=j.v3,p.positionScreen.z<-1||p.positionScreen.z>1)continue;if(d.positionScreen.z<-1||d.positionScreen.z>1)continue;if(h.positionScreen.z<-1||h.positionScreen.z>1)continue;p.positionScreen.x*=c,p.positionScreen.y*=-l,d.positionScreen.x*=c,d.positionScreen.y*=-l,h.positionScreen.x*=c,h.positionScreen.y*=-l,this.overdraw>0&&(I(p.positionScreen,d.positionScreen,this.overdraw),I(d.positionScreen,h.positionScreen,this.overdraw),I(h.positionScreen,p.positionScreen,this.overdraw)),g.setFromPoints([p.positionScreen,d.positionScreen,h.positionScreen]),!0===v.intersectsBox(g)&&q(p,d,h,j,L)}}_(),s.traverseVisible((function(e){if(e instanceof t){if(k.setFromMatrixPosition(e.matrixWorld),k.applyMatrix4(E),k.z<-1||k.z>1)return;var i=k.x*c,o=-k.y*l,r=e.node;r.setAttribute("transform","translate("+i+","+o+")"),x.appendChild(r)}}))}else console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.")}};
