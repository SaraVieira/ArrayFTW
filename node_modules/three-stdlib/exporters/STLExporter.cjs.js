"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=function(){};t.prototype={constructor:t,parse:function(t,r){void 0===r&&(r={});var o,n=void 0!==r.binary&&r.binary,i=[],a=0;t.traverse((function(e){if(e.isMesh){var t=e.geometry;if(!0!==t.isBufferGeometry)throw new Error("THREE.STLExporter: Geometry is not of type THREE.BufferGeometry.");var r=t.index,o=t.getAttribute("position");a+=null!==r?r.count/3:o.count/3,i.push({object3d:e,geometry:t})}}));var s=80;if(!0===n){var f=new ArrayBuffer(2*a+3*a*4*4+80+4);(o=new DataView(f)).setUint32(s,a,!0),s+=4}else o="",o+="solid exported\n";for(var u=new e.Vector3,c=new e.Vector3,l=new e.Vector3,p=new e.Vector3,y=new e.Vector3,d=new e.Vector3,x=0,m=i.length;x<m;x++){var b=i[x].object3d,v=i[x].geometry,w=v.index,g=v.getAttribute("position");if(null!==w)for(var V=0;V<w.count;V+=3){T(w.getX(V+0),w.getX(V+1),w.getX(V+2),g,b)}else for(var E=0;E<g.count;E+=3){T(E+0,E+1,E+2,g,b)}}return!1===n&&(o+="endsolid exported\n"),o;function T(e,t,r,i,a){u.fromBufferAttribute(i,e),c.fromBufferAttribute(i,t),l.fromBufferAttribute(i,r),!0===a.isSkinnedMesh&&(a.boneTransform(e,u),a.boneTransform(t,c),a.boneTransform(r,l)),u.applyMatrix4(a.matrixWorld),c.applyMatrix4(a.matrixWorld),l.applyMatrix4(a.matrixWorld),function(e,t,r){p.subVectors(r,t),y.subVectors(e,t),p.cross(y).normalize(),d.copy(p).normalize(),!0===n?(o.setFloat32(s,d.x,!0),s+=4,o.setFloat32(s,d.y,!0),s+=4,o.setFloat32(s,d.z,!0),s+=4):(o+="\tfacet normal "+d.x+" "+d.y+" "+d.z+"\n",o+="\t\touter loop\n")}(u,c,l),h(u),h(c),h(l),!0===n?(o.setUint16(s,0,!0),s+=2):(o+="\t\tendloop\n",o+="\tendfacet\n")}function h(e){!0===n?(o.setFloat32(s,e.x,!0),s+=4,o.setFloat32(s,e.y,!0),s+=4,o.setFloat32(s,e.z,!0),s+=4):o+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n"}}},exports.STLExporter=t;
