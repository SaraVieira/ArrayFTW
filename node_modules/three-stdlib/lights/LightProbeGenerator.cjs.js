"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r={fromCubeTexture:function(r){for(var a,n,o,s=0,c=new e.Vector3,i=new e.Vector3,h=new e.Color,g=[0,0,0,0,0,0,0,0,0],b=new e.SphericalHarmonics3,d=b.coefficients,f=0;f<6;f++){var l=r.image[f],w=l.width,u=l.height,v=document.createElement("canvas");v.width=w,v.height=u;var m=v.getContext("2d");m.drawImage(l,0,0,w,u);for(var k=m.getImageData(0,0,w,u),p=k.data,x=k.width,y=2/x,P=0,G=p.length;P<G;P+=4){h.setRGB(p[P]/255,p[P+1]/255,p[P+2]/255),t(h,r.encoding);var L=P/4,M=(L%x+.5)*y-1,R=1-(Math.floor(L/x)+.5)*y;switch(f){case 0:c.set(-1,R,-M);break;case 1:c.set(1,R,M);break;case 2:c.set(-M,1,-R);break;case 3:c.set(-M,-1,R);break;case 4:c.set(-M,R,1);break;case 5:c.set(M,R,-1)}n=c.lengthSq(),s+=o=4/(Math.sqrt(n)*n),i.copy(c).normalize(),e.SphericalHarmonics3.getBasisAt(i,g);for(var S=0;S<9;S++)d[S].x+=g[S]*h.r*o,d[S].y+=g[S]*h.g*o,d[S].z+=g[S]*h.b*o}}a=4*Math.PI/s;for(var z=0;z<9;z++)d[z].x*=a,d[z].y*=a,d[z].z*=a;return new e.LightProbe(b)},fromCubeRenderTarget:function(r,a){for(var n,o,s,c=0,i=new e.Vector3,h=new e.Vector3,g=new e.Color,b=[0,0,0,0,0,0,0,0,0],d=new e.SphericalHarmonics3,f=d.coefficients,l=0;l<6;l++){var w=a.width,u=new Uint8Array(w*w*4);r.readRenderTargetPixels(a,0,0,w,w,u,l);for(var v=2/w,m=0,k=u.length;m<k;m+=4){g.setRGB(u[m]/255,u[m+1]/255,u[m+2]/255),t(g,a.texture.encoding);var p=m/4,x=(p%w+.5)*v-1,y=1-(Math.floor(p/w)+.5)*v;switch(l){case 0:i.set(1,y,-x);break;case 1:i.set(-1,y,x);break;case 2:i.set(x,1,-y);break;case 3:i.set(x,-1,y);break;case 4:i.set(x,y,1);break;case 5:i.set(-x,y,-1)}o=i.lengthSq(),c+=s=4/(Math.sqrt(o)*o),h.copy(i).normalize(),e.SphericalHarmonics3.getBasisAt(h,b);for(var P=0;P<9;P++)f[P].x+=b[P]*g.r*s,f[P].y+=b[P]*g.g*s,f[P].z+=b[P]*g.b*s}}n=4*Math.PI/c;for(var G=0;G<9;G++)f[G].x*=n,f[G].y*=n,f[G].z*=n;return new e.LightProbe(d)}},t=function(r,t){switch(t){case e.sRGBEncoding:r.convertSRGBToLinear();break;case e.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return r};exports.LightProbeGenerator=r;
