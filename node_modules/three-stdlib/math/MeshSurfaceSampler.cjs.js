"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e=function(){var e=new t.Triangle,r=new t.Vector3;function i(t){var e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}return i.prototype={constructor:i,setWeightAttribute:function(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this},build:function(){for(var t=this.positionAttribute,r=this.weightAttribute,i=new Float32Array(t.count/3),o=0;o<t.count;o+=3){var n=1;r&&(n=r.getX(o)+r.getX(o+1)+r.getX(o+2)),e.a.fromBufferAttribute(t,o),e.b.fromBufferAttribute(t,o+1),e.c.fromBufferAttribute(t,o+2),n*=e.getArea(),i[o/3]=n}this.distribution=new Float32Array(t.count/3);for(var u=0,s=0;s<i.length;s++)u+=i[s],this.distribution[s]=u;return this},setRandomGenerator:function(t){return this.randomFunction=t,this},sample:function(t,e,r){var i=this.distribution[this.distribution.length-1],o=this.binarySearch(this.randomFunction()*i);return this.sampleFace(o,t,e,r)},binarySearch:function(t){for(var e=this.distribution,r=0,i=e.length-1,o=-1;r<=i;){var n=Math.ceil((r+i)/2);if(0===n||e[n-1]<=t&&e[n]>t){o=n;break}t<e[n]?i=n-1:r=n+1}return o},sampleFace:function(t,i,o,n){var u=this.randomFunction(),s=this.randomFunction();return u+s>1&&(u=1-u,s=1-s),e.a.fromBufferAttribute(this.positionAttribute,3*t),e.b.fromBufferAttribute(this.positionAttribute,3*t+1),e.c.fromBufferAttribute(this.positionAttribute,3*t+2),i.set(0,0,0).addScaledVector(e.a,u).addScaledVector(e.b,s).addScaledVector(e.c,1-(u+s)),void 0!==o&&e.getNormal(o),void 0!==n&&void 0!==this.colorAttribute&&(e.a.fromBufferAttribute(this.colorAttribute,3*t),e.b.fromBufferAttribute(this.colorAttribute,3*t+1),e.c.fromBufferAttribute(this.colorAttribute,3*t+2),r.set(0,0,0).addScaledVector(e.a,u).addScaledVector(e.b,s).addScaledVector(e.c,1-(u+s)),n.r=r.x,n.g=r.y,n.b=r.z),this}},i}();exports.MeshSurfaceSampler=e;
