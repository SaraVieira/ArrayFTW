"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e={c:null,u:[new t.Vector3,new t.Vector3,new t.Vector3],e:[]},i={c:null,u:[new t.Vector3,new t.Vector3,new t.Vector3],e:[]},r=[[],[],[]],a=[[],[],[]],n=[],s=new t.Vector3,o=new t.Vector3,h=new t.Vector3,c=new t.Vector3,l=new t.Vector3,u=new t.Vector3,f=new t.Matrix3,S=new t.Box3,d=new t.Matrix4,z=new t.Matrix4,m=new t.Ray;function p(e,i,r){void 0===e&&(e=new t.Vector3),void 0===i&&(i=new t.Vector3),void 0===r&&(r=new t.Matrix3),this.center=e,this.halfSize=i,this.rotation=r}Object.assign(p.prototype,{set:function(t,e,i){return this.center=t,this.halfSize=e,this.rotation=i,this},copy:function(t){return this.center.copy(t.center),this.halfSize.copy(t.halfSize),this.rotation.copy(t.rotation),this},clone:function(){return(new this.constructor).copy(this)},getSize:function(t){return t.copy(this.halfSize).multiplyScalar(2)},clampPoint:function(e,i){var r=this.halfSize;c.subVectors(e,this.center),this.rotation.extractBasis(s,o,h),i.copy(this.center);var a=t.MathUtils.clamp(c.dot(s),-r.x,r.x);i.add(s.multiplyScalar(a));var n=t.MathUtils.clamp(c.dot(o),-r.y,r.y);i.add(o.multiplyScalar(n));var l=t.MathUtils.clamp(c.dot(h),-r.z,r.z);return i.add(h.multiplyScalar(l)),i},containsPoint:function(t){return c.subVectors(t,this.center),this.rotation.extractBasis(s,o,h),Math.abs(c.dot(s))<=this.halfSize.x&&Math.abs(c.dot(o))<=this.halfSize.y&&Math.abs(c.dot(h))<=this.halfSize.z},intersectsBox3:function(t){return this.intersectsOBB(y.fromBox3(t))},intersectsSphere:function(t){return this.clampPoint(t.center,u),u.distanceToSquared(t.center)<=t.radius*t.radius},intersectsOBB:function(t,s){void 0===s&&(s=Number.EPSILON),e.c=this.center,e.e[0]=this.halfSize.x,e.e[1]=this.halfSize.y,e.e[2]=this.halfSize.z,this.rotation.extractBasis(e.u[0],e.u[1],e.u[2]),i.c=t.center,i.e[0]=t.halfSize.x,i.e[1]=t.halfSize.y,i.e[2]=t.halfSize.z,t.rotation.extractBasis(i.u[0],i.u[1],i.u[2]);for(var o=0;o<3;o++)for(var h=0;h<3;h++)r[o][h]=e.u[o].dot(i.u[h]);c.subVectors(i.c,e.c),n[0]=c.dot(e.u[0]),n[1]=c.dot(e.u[1]),n[2]=c.dot(e.u[2]);for(var l=0;l<3;l++)for(var u=0;u<3;u++)a[l][u]=Math.abs(r[l][u])+s;for(var f,S,d=0;d<3;d++)if(f=e.e[d],S=i.e[0]*a[d][0]+i.e[1]*a[d][1]+i.e[2]*a[d][2],Math.abs(n[d])>f+S)return!1;for(var z=0;z<3;z++)if(f=e.e[0]*a[0][z]+e.e[1]*a[1][z]+e.e[2]*a[2][z],S=i.e[z],Math.abs(n[0]*r[0][z]+n[1]*r[1][z]+n[2]*r[2][z])>f+S)return!1;return f=e.e[1]*a[2][0]+e.e[2]*a[1][0],S=i.e[1]*a[0][2]+i.e[2]*a[0][1],!(Math.abs(n[2]*r[1][0]-n[1]*r[2][0])>f+S)&&(f=e.e[1]*a[2][1]+e.e[2]*a[1][1],S=i.e[0]*a[0][2]+i.e[2]*a[0][0],!(Math.abs(n[2]*r[1][1]-n[1]*r[2][1])>f+S)&&(f=e.e[1]*a[2][2]+e.e[2]*a[1][2],S=i.e[0]*a[0][1]+i.e[1]*a[0][0],!(Math.abs(n[2]*r[1][2]-n[1]*r[2][2])>f+S)&&(f=e.e[0]*a[2][0]+e.e[2]*a[0][0],S=i.e[1]*a[1][2]+i.e[2]*a[1][1],!(Math.abs(n[0]*r[2][0]-n[2]*r[0][0])>f+S)&&(f=e.e[0]*a[2][1]+e.e[2]*a[0][1],S=i.e[0]*a[1][2]+i.e[2]*a[1][0],!(Math.abs(n[0]*r[2][1]-n[2]*r[0][1])>f+S)&&(f=e.e[0]*a[2][2]+e.e[2]*a[0][2],S=i.e[0]*a[1][1]+i.e[1]*a[1][0],!(Math.abs(n[0]*r[2][2]-n[2]*r[0][2])>f+S)&&(f=e.e[0]*a[1][0]+e.e[1]*a[0][0],S=i.e[1]*a[2][2]+i.e[2]*a[2][1],!(Math.abs(n[1]*r[0][0]-n[0]*r[1][0])>f+S)&&(f=e.e[0]*a[1][1]+e.e[1]*a[0][1],S=i.e[0]*a[2][2]+i.e[2]*a[2][0],!(Math.abs(n[1]*r[0][1]-n[0]*r[1][1])>f+S)&&(f=e.e[0]*a[1][2]+e.e[1]*a[0][2],S=i.e[0]*a[2][1]+i.e[1]*a[2][0],!(Math.abs(n[1]*r[0][2]-n[0]*r[1][2])>f+S)))))))))},intersectsPlane:function(t){this.rotation.extractBasis(s,o,h);var e=this.halfSize.x*Math.abs(t.normal.dot(s))+this.halfSize.y*Math.abs(t.normal.dot(o))+this.halfSize.z*Math.abs(t.normal.dot(h)),i=t.normal.dot(this.center)-t.constant;return Math.abs(i)<=e},intersectRay:function(t,e){var i,r,a,n;return this.getSize(l),S.setFromCenterAndSize(c.set(0,0,0),l),i=d,r=this.rotation,a=i.elements,n=r.elements,a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=0,a[4]=n[3],a[5]=n[4],a[6]=n[5],a[7]=0,a[8]=n[6],a[9]=n[7],a[10]=n[8],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,d.setPosition(this.center),z.copy(d).invert(),m.copy(t).applyMatrix4(z),m.intersectBox(S,e)?e.applyMatrix4(d):null},intersectsRay:function(t){return null!==this.intersectRay(t,c)},fromBox3:function(t){return t.getCenter(this.center),t.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this},equals:function(t){return t.center.equals(this.center)&&t.halfSize.equals(this.halfSize)&&t.rotation.equals(this.rotation)},applyMatrix4:function(t){var e=t.elements,i=c.set(e[0],e[1],e[2]).length(),r=c.set(e[4],e[5],e[6]).length(),a=c.set(e[8],e[9],e[10]).length();t.determinant()<0&&(i=-i),f.setFromMatrix4(t);var n=1/i,s=1/r,o=1/a;return f.elements[0]*=n,f.elements[1]*=n,f.elements[2]*=n,f.elements[3]*=s,f.elements[4]*=s,f.elements[5]*=s,f.elements[6]*=o,f.elements[7]*=o,f.elements[8]*=o,this.rotation.multiply(f),this.halfSize.x*=i,this.halfSize.y*=r,this.halfSize.z*=a,c.setFromMatrixPosition(t),this.center.add(c),this}});var y=new p;exports.OBB=p;
