"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),a=function(a){e.Loader.call(this,a)};a.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:a,load:function(a,r,t,o){var i=this,s=new e.Texture,n=new e.FileLoader(this.manager);return n.setResponseType("arraybuffer"),n.setPath(this.path),n.setWithCredentials(this.withCredentials),n.load(a,(function(e){s.image=i.parse(e),s.needsUpdate=!0,void 0!==r&&r(s)}),t,o),s},parse:function(e){var a=0,r=1,t=2,o=3,i=9,s=10,n=11,c=48,l=4,d=0,h=1,p=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var u=new Uint8Array(e),g=0,_={id_length:u[g++],colormap_type:u[g++],image_type:u[g++],colormap_index:u[g++]|u[g++]<<8,colormap_length:u[g++]|u[g++]<<8,colormap_size:u[g++],origin:[u[g++]|u[g++]<<8,u[g++]|u[g++]<<8],width:u[g++]|u[g++]<<8,height:u[g++]|u[g++]<<8,pixel_size:u[g++],flags:u[g++]};!function(e){switch(e.image_type){case r:case i:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case t:case o:case s:case n:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case a:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(_),_.id_length+g>e.length&&console.error("THREE.TGALoader: No data."),g+=_.id_length;var v=!1,w=!1,m=!1;switch(_.image_type){case i:v=!0,w=!0;break;case r:w=!0;break;case s:v=!0;break;case t:break;case n:v=!0,m=!0;break;case o:m=!0}var y="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(_.width,_.height):document.createElement("canvas");y.width=_.width,y.height=_.height;var T=y.getContext("2d"),b=T.createImageData(_.width,_.height),E=function(e,a,r,t,o){var i,s,n,c;if(s=r.pixel_size>>3,n=r.width*r.height*s,a&&(c=o.subarray(t,t+=r.colormap_length*(r.colormap_size>>3))),e){var l,d,h;i=new Uint8Array(n);for(var p=0,f=new Uint8Array(s);p<n;)if(d=1+(127&(l=o[t++])),128&l){for(h=0;h<s;++h)f[h]=o[t++];for(h=0;h<d;++h)i.set(f,p+h*s);p+=s*d}else{for(d*=s,h=0;h<d;++h)i[p+h]=o[t++];p+=d}}else i=o.subarray(t,t+=a?r.width*r.height:n);return{pixel_data:i,palettes:c}}(v,w,_,g,u);return function(e,a,r,t,o){var i,s,n,u,g,v;switch((_.flags&c)>>l){default:case p:i=0,n=1,g=a,s=0,u=1,v=r;break;case d:i=0,n=1,g=a,s=r-1,u=-1,v=-1;break;case f:i=a-1,n=-1,g=-1,s=0,u=1,v=r;break;case h:i=a-1,n=-1,g=-1,s=r-1,u=-1,v=-1}if(m)switch(_.pixel_size){case 8:!function(e,a,r,t,o,i,s,n){var c,l,d,h=0,p=_.width;for(d=a;d!==t;d+=r)for(l=o;l!==s;l+=i,h++)c=n[h],e[4*(l+p*d)+0]=c,e[4*(l+p*d)+1]=c,e[4*(l+p*d)+2]=c,e[4*(l+p*d)+3]=255}(e,s,u,v,i,n,g,t);break;case 16:!function(e,a,r,t,o,i,s,n){var c,l,d=0,h=_.width;for(l=a;l!==t;l+=r)for(c=o;c!==s;c+=i,d+=2)e[4*(c+h*l)+0]=n[d+0],e[4*(c+h*l)+1]=n[d+0],e[4*(c+h*l)+2]=n[d+0],e[4*(c+h*l)+3]=n[d+1]}(e,s,u,v,i,n,g,t);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(_.pixel_size){case 8:!function(e,a,r,t,o,i,s,n,c){var l,d,h,p=c,f=0,u=_.width;for(h=a;h!==t;h+=r)for(d=o;d!==s;d+=i,f++)l=n[f],e[4*(d+u*h)+3]=255,e[4*(d+u*h)+2]=p[3*l+0],e[4*(d+u*h)+1]=p[3*l+1],e[4*(d+u*h)+0]=p[3*l+2]}(e,s,u,v,i,n,g,t,o);break;case 16:!function(e,a,r,t,o,i,s,n){var c,l,d,h=0,p=_.width;for(d=a;d!==t;d+=r)for(l=o;l!==s;l+=i,h+=2)c=n[h+0]+(n[h+1]<<8),e[4*(l+p*d)+0]=(31744&c)>>7,e[4*(l+p*d)+1]=(992&c)>>2,e[4*(l+p*d)+2]=(31&c)>>3,e[4*(l+p*d)+3]=32768&c?0:255}(e,s,u,v,i,n,g,t);break;case 24:!function(e,a,r,t,o,i,s,n){var c,l,d=0,h=_.width;for(l=a;l!==t;l+=r)for(c=o;c!==s;c+=i,d+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=n[d+0],e[4*(c+h*l)+1]=n[d+1],e[4*(c+h*l)+0]=n[d+2]}(e,s,u,v,i,n,g,t);break;case 32:!function(e,a,r,t,o,i,s,n){var c,l,d=0,h=_.width;for(l=a;l!==t;l+=r)for(c=o;c!==s;c+=i,d+=4)e[4*(c+h*l)+2]=n[d+0],e[4*(c+h*l)+1]=n[d+1],e[4*(c+h*l)+0]=n[d+2],e[4*(c+h*l)+3]=n[d+3]}(e,s,u,v,i,n,g,t);break;default:console.error("THREE.TGALoader: Format not supported.")}}(b.data,_.width,_.height,E.pixel_data,E.palettes),T.putImageData(b,0,0),y}}),exports.TGALoader=a;
