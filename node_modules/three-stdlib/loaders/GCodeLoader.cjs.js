"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r=function(r){e.Loader.call(this,r),this.splitLayer=!1};r.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:r,load:function(r,t,a,i){var o=this,n=new e.FileLoader(o.manager);n.setPath(o.path),n.setRequestHeader(o.requestHeader),n.setWithCredentials(o.withCredentials),n.load(r,(function(e){try{t(o.parse(e))}catch(e){i?i(e):console.error(e),o.manager.itemError(r)}}),a,i)},parse:function(r){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},a=[],o=void 0,n=new e.LineBasicMaterial({color:16711680});n.name="path";var s=new e.LineBasicMaterial({color:65280});function l(e){o={vertex:[],pathVertex:[],z:e.z},a.push(o)}function u(e,r){return t.relative?r:r-e}function v(e,r){return t.relative?e+r:r}s.name="extruded";for(var p,d,f=r.replace(/;.+/g,"").split("\n"),h=0;h<f.length;h++){var x=f[h].split(" "),c=x[0].toUpperCase(),y={};if(x.splice(1).forEach((function(e){if(void 0!==e[0]){var r=e[0].toLowerCase(),t=parseFloat(e.substring(1));y[r]=t}})),"G0"===c||"G1"===c){var z={x:void 0!==y.x?v(t.x,y.x):t.x,y:void 0!==y.y?v(t.y,y.y):t.y,z:void 0!==y.z?v(t.z,y.z):t.z,e:void 0!==y.e?v(t.e,y.e):t.e,f:void 0!==y.f?v(t.f,y.f):t.f};u(t.e,z.e)>0&&(z.extruding=u(t.e,z.e)>0,null!=o&&z.z==o.z||l(z)),p=t,d=z,void 0===o&&l(p),z.extruding?(o.vertex.push(p.x,p.y,p.z),o.vertex.push(d.x,d.y,d.z)):(o.pathVertex.push(p.x,p.y,p.z),o.pathVertex.push(d.x,d.y,d.z)),t=z}else if("G2"===c||"G3"===c);else if("G90"===c)t.relative=!1;else if("G91"===c)t.relative=!0;else if("G92"===c){(z=t).x=void 0!==y.x?y.x:z.x,z.y=void 0!==y.y?y.y:z.y,z.z=void 0!==y.z?y.z:z.z,z.e=void 0!==y.e?y.e:z.e,t=z}}function g(r,t){var a=new e.BufferGeometry;a.setAttribute("position",new e.Float32BufferAttribute(r,3));var o=new e.LineSegments(a,t?s:n);o.name="layer"+i,m.add(o)}var m=new e.Group;if(m.name="gcode",this.splitLayer)for(var w=0;w<a.length;w++){g((C=a[w]).vertex,!0),g(C.pathVertex,!1)}else{for(var G=[],L=[],b=0;b<a.length;b++){for(var C,V=(C=a[b]).vertex,q=C.pathVertex,B=0;B<V.length;B++)G.push(V[B]);for(var E=0;E<q.length;E++)L.push(q[E])}g(G,!0),g(L,!1)}return m.quaternion.setFromEuler(new e.Euler(-Math.PI/2,0,0)),m}}),exports.GCodeLoader=r;
