"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=require("opentype.js"),o=function(t){e.Loader.call(this,t),this.reversed=!1};o.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:o,load:function(t,o,r,a){var n=this,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{o(n.parse(e))}catch(e){a?a(e):console.error(e),n.manager.itemError(t)}}),r,a)},parse:function(e){function o(e){var t,o=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],o.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var r=[];return o.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var o=e.length-1;o>0;o--){var a=e[o];t={type:a.type};void 0!==a.x2&&void 0!==a.y2?(t.x1=a.x2,t.y1=a.y2,t.x2=a.x1,t.y2=a.y1):void 0!==a.x1&&void 0!==a.y1&&(t.x1=a.x1,t.y1=a.y1),t.x=e[o-1].x,t.y=e[o-1].y,r.push(t)}})),r}return function(e,t){for(var r=Math.round,a={},n=1e5/(72*(e.unitsPerEm||2048)),i=e.encoding.cmap.glyphIndexMap,s=Object.keys(i),d=0;d<s.length;d++){var y=s[d],h=e.glyphs.glyphs[i[y]];if(void 0!==y){var c={ha:r(h.advanceWidth*n),x_min:r(h.xMin*n),x_max:r(h.xMax*n),o:""};t&&(h.path.commands=o(h.path.commands)),h.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),c.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(c.o+=r(e.x*n)+" "+r(e.y*n)+" "),void 0!==e.x1&&void 0!==e.y1&&(c.o+=r(e.x1*n)+" "+r(e.y1*n)+" "),void 0!==e.x2&&void 0!==e.y2&&(c.o+=r(e.x2*n)+" "+r(e.y2*n)+" ")})),a[String.fromCodePoint(h.unicode)]=c}}return{glyphs:a,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*n),descender:r(e.descender*n),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(t.parse(e),this.reversed)}}),exports.TTFLoader=o;
