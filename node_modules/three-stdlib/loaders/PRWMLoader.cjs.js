"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("three"),e=function(){var e=null;function t(){if(null===e){var r=new ArrayBuffer(2),t=new Uint8Array(r),n=new Uint16Array(r);t[0]=170,t[1]=187,e=43707===n[0]}return e}var n=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],a={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function i(r,e,n,i,o){var s,u=e.BYTES_PER_ELEMENT;if(o===t()||1===u)s=new e(r,n,i);else{var l=new DataView(r,n,i*u),f=a[e.name],d=!o,c=0;for(s=new e(i);c<i;c++)s[c]=l[f](c*u,d)}return s}function o(e){r.Loader.call(this,e)}return o.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:o,load:function(e,n,a,i){var o=this,s=new r.FileLoader(o.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),e=e.replace(/\*/g,t()?"be":"le"),s.load(e,(function(r){try{n(o.parse(r))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),a,i)},parse:function(e){var t,a,o=function(r){var e=new Uint8Array(r),t=e[0],a=e[1],o=!!(a>>7&1),s=a>>6&1,u=1==(a>>5&1),l=31&a,f=0,d=0;if(u?(f=(e[2]<<16)+(e[3]<<8)+e[4],d=(e[5]<<16)+(e[6]<<8)+e[7]):(f=e[2]+(e[3]<<8)+(e[4]<<16),d=e[5]+(e[6]<<8)+(e[7]<<16)),0===t)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==t)throw new Error("PRWM decoder: Unsupported format version: "+t);if(!o){if(0!==s)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==d)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var c,y,A,w,h,p,v,g,E=8,b={};for(g=0;g<l;g++){for(c="";E<e.length&&(y=e[E],E++,0!==y);)c+=String.fromCharCode(y);A=(a=e[E])>>7&1,w=1+(a>>4&3),E++,p=i(r,h=n[15&a],E=4*Math.ceil(E/4),w*f,u),E+=h.BYTES_PER_ELEMENT*w*f,b[c]={type:A,cardinality:w,values:p}}return E=4*Math.ceil(E/4),v=null,o&&(v=i(r,1===s?Uint32Array:Uint16Array,E,d,u)),{version:t,attributes:b,indices:v}}(e),s=Object.keys(o.attributes),u=new r.BufferGeometry;for(a=0;a<s.length;a++)t=o.attributes[s[a]],u.setAttribute(s[a],new r.BufferAttribute(t.values,t.cardinality,t.normalized));return null!==o.indices&&u.setIndex(new r.BufferAttribute(o.indices,1)),u}}),o.isBigEndianPlatform=function(){return t()},o}();exports.PRWMLoader=e;
