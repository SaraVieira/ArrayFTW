"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("three");exports.TubePainter=function(){var a=3e6,e=new r.BufferAttribute(new Float32Array(a),3);e.usage=r.DynamicDrawUsage;var t=new r.BufferAttribute(new Float32Array(a),3);t.usage=r.DynamicDrawUsage;var o=new r.BufferAttribute(new Float32Array(a),3);o.usage=r.DynamicDrawUsage;var n=new r.BufferGeometry;n.setAttribute("position",e),n.setAttribute("normal",t),n.setAttribute("color",o),n.drawRange.count=0;var y=new r.MeshStandardMaterial({vertexColors:!0}),u=new r.Mesh(n,y);u.frustumCulled=!1;var c=new r.Vector3,p=new r.Vector3,i=new r.Vector3,d=new r.Vector3,s=new r.Color(16777215),A=1;function l(a,y,u,l){if(0!==a.distanceToSquared(y)){for(var w=n.drawRange.count,f=function(a){for(var e=2*Math.PI,t=[],o=.01*a,n=0;n<10;n++){var y=n/10*e;t.push(new r.Vector3(Math.sin(y)*o,Math.cos(y)*o,0))}return t}(A),g=0,M=f.length;g<M;g++){var v=f[g],x=f[(g+1)%M];c.copy(v).applyMatrix4(l).add(y),p.copy(x).applyMatrix4(l).add(y),i.copy(x).applyMatrix4(u).add(a),d.copy(v).applyMatrix4(u).add(a),c.toArray(e.array,3*(w+0)),p.toArray(e.array,3*(w+1)),d.toArray(e.array,3*(w+2)),p.toArray(e.array,3*(w+3)),i.toArray(e.array,3*(w+4)),d.toArray(e.array,3*(w+5)),c.copy(v).applyMatrix4(l).normalize(),p.copy(x).applyMatrix4(l).normalize(),i.copy(x).applyMatrix4(u).normalize(),d.copy(v).applyMatrix4(u).normalize(),c.toArray(t.array,3*(w+0)),p.toArray(t.array,3*(w+1)),d.toArray(t.array,3*(w+2)),p.toArray(t.array,3*(w+3)),i.toArray(t.array,3*(w+4)),d.toArray(t.array,3*(w+5)),s.toArray(o.array,3*(w+0)),s.toArray(o.array,3*(w+1)),s.toArray(o.array,3*(w+2)),s.toArray(o.array,3*(w+3)),s.toArray(o.array,3*(w+4)),s.toArray(o.array,3*(w+5)),w+=6}n.drawRange.count=w}}var w=new r.Vector3(0,1,0),f=new r.Vector3,g=new r.Vector3,M=new r.Matrix4,v=new r.Matrix4,x=0;return{mesh:u,moveTo:function(r){f.copy(r),M.lookAt(g,f,w),g.copy(r),v.copy(M)},lineTo:function(r){f.copy(r),M.lookAt(g,f,w),l(f,g,M,v),g.copy(f),v.copy(M)},setSize:function(r){A=r},update:function(){var r=x,a=n.drawRange.count;r!==a&&(e.updateRange.offset=3*r,e.updateRange.count=3*(a-r),e.needsUpdate=!0,t.updateRange.offset=3*r,t.updateRange.count=3*(a-r),t.needsUpdate=!0,o.updateRange.offset=3*r,o.updateRange.count=3*(a-r),o.needsUpdate=!0,x=n.drawRange.count)}}};
