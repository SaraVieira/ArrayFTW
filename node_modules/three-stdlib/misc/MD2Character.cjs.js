"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),i=require("../loaders/MD2Loader.cjs.js");exports.MD2Character=function(){var t=this;function s(i,t){for(var s=new e.TextureLoader,a=[],n=0;n<t.length;n++)a[n]=s.load(i+t[n],o),a[n].mapping=e.UVMapping,a[n].name=t[n],a[n].encoding=e.sRGBEncoding;return a}function a(i,t){var s=new e.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),a=new e.MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),o=new e.Mesh(i,a);return o.rotation.y=-Math.PI/2,o.castShadow=!0,o.receiveShadow=!0,o.materialTexture=a,o.materialWireframe=s,o}function o(){t.loadCounter-=1,0===t.loadCounter&&t.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new e.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(n){this.loadCounter=2*n.weapons.length+n.skins.length+1;for(var h=[],r=0;r<n.weapons.length;r++)h[r]=n.weapons[r][1];this.skinsBody=s(n.baseUrl+"skins/",n.skins),this.skinsWeapon=s(n.baseUrl+"skins/",h);var m=new i.MD2Loader;m.load(n.baseUrl+n.body,(function(i){var s=new e.Box3;s.setFromBufferAttribute(i.attributes.position),t.root.position.y=-t.scale*s.min.y;var n=a(i,t.skinsBody[0]);n.scale.set(t.scale,t.scale,t.scale),t.root.add(n),t.meshBody=n,t.meshBody.clipOffset=0,t.activeAnimationClipName=n.geometry.animations[0].name,t.mixer=new e.AnimationMixer(n),o()}));for(var l=function(e,i){return function(s){var n=a(s,t.skinsWeapon[e]);n.scale.set(t.scale,t.scale,t.scale),n.visible=!1,n.name=i,t.root.add(n),t.weapons[e]=n,t.meshWeapon=n,o()}},c=0;c<n.weapons.length;c++)m.load(n.baseUrl+n.weapons[c][0],l(c,n.weapons[c][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var s=this.weapons[e];s&&(s.visible=!0,this.meshWeapon=s,t.syncWeaponAnimation())},this.setAnimation=function(e){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var i=this.mixer.clipAction(e,this.meshBody);i&&(this.meshBody.activeAction=i.play())}t.activeClipName=e,t.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var e=t.activeClipName;if(t.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var i=this.mixer.clipAction(e,this.meshWeapon);i&&(this.meshWeapon.activeAction=i.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}};
