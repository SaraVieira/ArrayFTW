"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-three/fiber"),r=require("@babel/runtime/helpers/extends"),n=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),o=require("three"),a=require("react-dom");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=i(r),u=i(n),l=new o.Vector3,c=new o.Vector3,f=new o.Vector3;function d(e,t,r){var n=l.setFromMatrixPosition(e.matrixWorld);n.project(t);var o=r.width/2,a=r.height/2;return[n.x*o+o,-n.y*a+a]}var m=function(e){return Math.abs(e)<1e-10?0:e};function p(e,t,r){void 0===r&&(r="");for(var n="matrix3d(",o=0;16!==o;o++)n+=m(t[o]*e.elements[o])+(15!==o?",":")");return r+n}var h,v=(h=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return p(e,h)}),x=function(e,t){return p(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},M=e.forwardRef((function(r,n){var i,p=r.children,h=r.eps,M=void 0===h?.001:h,y=r.style,b=r.className,g=r.prepend,w=r.center,P=r.fullscreen,W=r.portal,E=r.distanceFactor,T=r.sprite,F=void 0!==T&&T,R=r.transform,C=void 0!==R&&R,z=r.zIndexRange,I=void 0===z?[16777271,0]:z,q=r.calculatePosition,N=void 0===q?d:q,j=u.default(r,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","zIndexRange","calculatePosition"]),H=t.useThree((function(e){return e.gl})),L=t.useThree((function(e){return e.camera})),O=t.useThree((function(e){return e.scene})),V=t.useThree((function(e){return e.size})),S=e.useState((function(){return document.createElement("div")}))[0],_=e.useRef(null),k=e.useRef(0),A=e.useRef([0,0]),D=e.useRef(null),Z=e.useRef(null),B=null!=(i=null==W?void 0:W.current)?i:H.domElement.parentNode;e.useEffect((function(){if(_.current){if(O.updateMatrixWorld(),C)S.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=N(_.current,L,V);S.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return B&&(g?B.prepend(S):B.appendChild(S)),function(){B&&B.removeChild(S),a.unmountComponentAtNode(S)}}}),[B,C]);var G=e.useMemo((function(){return C?{position:"absolute",top:0,left:0,width:V.width,height:V.height,transformStyle:"preserve-3d",pointerEvents:"none"}:s.default({position:"absolute",transform:w?"translate3d(-50%,-50%,0)":"none"},P&&{top:-V.height/2,left:-V.width/2,width:V.width,height:V.height},y)}),[y,w,P,V,C]),J=e.useMemo((function(){return s.default({position:"absolute",pointerEvents:"auto"},y)}),[y]);return e.useLayoutEffect((function(){C?a.render(e.createElement("div",{ref:D,style:G},e.createElement("div",{ref:Z,style:J},e.createElement("div",{ref:n,className:b,children:p}))),S):a.render(e.createElement("div",{ref:n,style:G,className:b,children:p}),S)})),t.useFrame((function(){if(_.current){L.updateMatrixWorld();var e=C?A.current:N(_.current,L,V);if(C||Math.abs(k.current-L.zoom)>M||Math.abs(A.current[0]-e[0])>M||Math.abs(A.current[1]-e[1])>M){if(S.style.display=function(e,t){var r=l.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),o=r.sub(n),a=t.getWorldDirection(f);return o.angleTo(a)>Math.PI/2}(_.current,L)?"none":"block",S.style.zIndex=""+function(e,t,r){if(t instanceof o.PerspectiveCamera||t instanceof o.OrthographicCamera){var n=l.setFromMatrixPosition(e.matrixWorld),a=c.setFromMatrixPosition(t.matrixWorld),i=n.distanceTo(a),s=(r[1]-r[0])/(t.far-t.near),u=r[1]-s*t.far;return Math.round(s*i+u)}}(_.current,L,I),C){var t=V.width/2,r=V.height/2,n=L.projectionMatrix.elements[5]*r,a=L,i=a.isOrthographicCamera,s=a.top,u=a.left,d=a.bottom,p=a.right,h=v(L.matrixWorldInverse),y=i?"scale("+n+")translate("+m(-(p+u)/2)+"px,"+m((s+d)/2)+"px)":"translateZ("+n+"px)",b=_.current.matrixWorld;F&&((b=L.matrixWorldInverse.clone().transpose().copyPosition(b).scale(_.current.scale)).elements[3]=b.elements[7]=b.elements[11]=0,b.elements[15]=1),S.style.width=V.width+"px",S.style.height=V.height+"px",S.style.perspective=i?"":n+"px",D.current&&Z.current&&(D.current.style.transform=""+y+h+"translate("+t+"px,"+r+"px)",Z.current.style.transform=x(b,1/((E||10)/400)))}else{var g=void 0===E?1:function(e,t){if(t instanceof o.OrthographicCamera)return t.zoom;if(t instanceof o.PerspectiveCamera){var r=l.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,i=r.distanceTo(n);return 1/(2*Math.tan(a/2)*i)}return 1}(_.current,L)*E;S.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+g+")"}A.current=e,k.current=L.zoom}}})),e.createElement("group",s.default({},j,{ref:_}))})),y=e.forwardRef((function(t,r){return e.useEffect((function(){console.warn("The <HTML> component was renamed to <Html>")}),[]),e.createElement(M,s.default({},t,{ref:r}))}));exports.HTML=y,exports.Html=M;
