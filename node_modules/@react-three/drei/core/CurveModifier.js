import { forwardRef, useState, useRef, useImperativeHandle, useEffect, createElement, cloneElement, Children } from 'react';
import { Flow } from 'three-stdlib';

const CurveModifier = /*#__PURE__*/forwardRef(({
  children,
  curve
}, ref) => {
  const [object3D, setObj] = useState();
  const original = useRef();
  const modifier = useRef();
  useImperativeHandle(ref, () => ({
    moveAlongCurve: val => {
      var _modifier$current;

      (_modifier$current = modifier.current) == null ? void 0 : _modifier$current.moveAlongCurve(val);
    }
  }));
  useEffect(() => {
    if (!modifier.current && original.current && ref) {
      modifier.current = new Flow(original.current);
      setObj(modifier.current.object3D);
    }
  }, [children, ref]);
  useEffect(() => {
    if (original.current && curve) {
      var _modifier$current2;

      (_modifier$current2 = modifier.current) == null ? void 0 : _modifier$current2.updateCurve(0, curve);
    }
  }, [curve]);
  return object3D ? /*#__PURE__*/createElement("primitive", {
    object: object3D
  }) : /*#__PURE__*/cloneElement(Children.only(children), {
    ref: original
  });
});

export { CurveModifier };
