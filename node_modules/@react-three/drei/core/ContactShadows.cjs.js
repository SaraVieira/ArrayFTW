"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber"),t=require("@babel/runtime/helpers/extends"),a=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),n=require("three-stdlib"),u=require("three");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=i(t),l=i(a),d=e.forwardRef((function(t,a){var i=t.opacity,d=void 0===i?1:i,s=t.width,f=void 0===s?1:s,c=t.height,h=void 0===c?1:c,m=t.blur,p=void 0===m?1:m,g=t.far,v=void 0===g?10:g,b=t.resolution,M=void 0===b?256:b,w=l.default(t,["opacity","width","height","blur","far","resolution"]),T=r.useThree((function(e){return e.scene})),x=r.useThree((function(e){return e.gl})),y=e.useRef(),R=e.useMemo((function(){var e=new u.WebGLRenderTarget(M,M),r=new u.WebGLRenderTarget(M,M);r.texture.generateMipmaps=e.texture.generateMipmaps=!1;var t=new u.PlaneBufferGeometry(f,h).rotateX(Math.PI/2),a=new u.Mesh(t),i=new u.MeshDepthMaterial;i.depthTest=i.depthWrite=!1,i.onBeforeCompile=function(e){return e.fragmentShader=e.fragmentShader.replace("1.0 - fragCoordZ ), opacity );","0.0 ), ( 1.0 - fragCoordZ ) * 1.0 );")};var o=new u.ShaderMaterial(n.HorizontalBlurShader),l=new u.ShaderMaterial(n.VerticalBlurShader);return l.depthTest=o.depthTest=!1,[e,t,i,a,o,l,r]}),[M,f,h]),S=R[0],q=R[1],B=R[2],C=R[3],P=R[4],E=R[5],W=R[6];return r.useFrame((function(){if(y.current){var e=T.background;T.background=null,T.overrideMaterial=B,x.setRenderTarget(S),x.render(T,y.current),T.overrideMaterial=null,C.material=P,C.material.uniforms.tDiffuse.value=S.texture,P.uniforms.h.value=p/256,x.setRenderTarget(W),x.render(C,y.current),C.material=E,C.material.uniforms.tDiffuse.value=W.texture,E.uniforms.v.value=p/256,x.setRenderTarget(S),x.render(C,y.current),x.setRenderTarget(null),T.background=e}})),e.createElement("group",o.default({},w,{ref:a}),e.createElement("mesh",{geometry:q,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},e.createElement("meshBasicMaterial",{map:S.texture,transparent:!0,opacity:d})),e.createElement("orthographicCamera",{ref:y,args:[-f/2,f/2,h/2,-h/2,0,v]}))}));exports.ContactShadows=d;
