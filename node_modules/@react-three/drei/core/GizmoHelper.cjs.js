"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber");require("@babel/runtime/helpers/extends"),require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),require("react-merge-refs");var t=require("three"),n=require("./OrthographicCamera.cjs.js"),o=require("./useCamera.cjs.js"),a=e.createContext({}),i=2*Math.PI,u=new t.Object3D,c=new t.Matrix4,s=new t.Quaternion,l=new t.Quaternion,p=new t.Vector3,h=new t.Vector3,m=new t.Quaternion;exports.GizmoHelper=function(f){var d=f.alignment,w=void 0===d?"bottom-right":d,g=f.margin,q=void 0===g?[80,80]:g,v=f.onUpdate,x=f.onTarget,y=f.children,b=r.useThree((function(e){return e.size})),C=r.useThree((function(e){return e.camera})),j=r.useThree((function(e){return e.gl})),T=e.useRef(),P=e.useRef(null),R=e.useState((function(){return new t.Scene}))[0],M=e.useRef(!1),O=e.useRef(0),Q=e.useRef(new t.Vector3(0,0,0));r.useFrame((function(e,r){var t;P.current&&T.current&&(!function(e){if(M.current){var r=e*i;s.rotateTowards(l,r),C.position.set(0,0,1).applyQuaternion(s).multiplyScalar(O.current).add(Q.current),C.quaternion.rotateTowards(m,r),C.updateProjectionMatrix(),v&&v(),s.angleTo(l)<.01&&(M.current=!1)}}(r),c.copy(C.matrix).invert(),null==(t=T.current)||t.quaternion.setFromRotationMatrix(c),j.autoClear=!1,j.clearDepth(),j.render(R,P.current))}));var S={tweenCamera:function(e){M.current=!0,Q.current=x(),O.current=C.position.distanceTo(p),u.position.copy(p),u.lookAt(C.position),s.copy(u.quaternion),h.copy(e).multiplyScalar(O.current).add(p),u.lookAt(h),l.copy(u.quaternion)},raycast:o.useCamera(P)},k=q[0],z=q[1],D=w.endsWith("-left")?-b.width/2+k:b.width/2-k,E=w.startsWith("top-")?b.height/2-z:-b.height/2+z;return r.createPortal(e.createElement(a.Provider,{value:S},e.createElement(n.OrthographicCamera,{ref:P,makeDefault:!1,position:[0,0,100]}),e.createElement("group",{ref:T,position:[D,E,0]},y)),R)},exports.useGizmoContext=function(){return e.useContext(a)};
